webpackJsonp([2],{794:function(e,t,r){var n=r(795);e.exports=n},795:function(e,t,r){!function(t,r){e.exports=r()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var l=r[n]={exports:{},id:n,loaded:!1};return e[n].call(l.exports,l,l.exports,t),l.loaded=!0,l.exports}var r={};return t.m=e,t.c=r,t.p="/dist/",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){function n(e){return e&&e.__esModule?e:{"default":e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2),a=r(3),s=r(4),c=(r(5),r(6)),u=r(14),h=r(15),f=(n(h),r(8)),g=r(16);a.globals.canYoutube=!1,a.globals.canSetHTMLColors=!1;var d=function(){function e(){l(this,e)}return o(e,[{key:"start",value:function(e,t){this.node=e,s.globals.onWinGame||(s.globals.onWinGame=function(){}),s.globals.curlevel=0,s.globals.curlevelTarget=null,this._load(),(0,f.addListeners)(this.node),(0,g.addListeners)(this.node),(0,g.startGameLoop)(),(0,i.setCanvas)(this.node),(0,c.init)(),(0,u.compile)(["restart"],t)}},{key:"pause",value:function(){(0,g.stopGameLoop)(),(0,g.removeListeners)(this.node)}},{key:"resume",value:function(){(0,g.startGameLoop)(),(0,g.addListeners)(this.node)}},{key:"stop",value:function(){(0,f.removeListeners)(this.node),(0,g.removeListeners)(this.node),(0,g.stopGameLoop)(),s.globals.curlevel=0,s.globals.curlevelTarget=null}},{key:"setSaver",value:function(e){s.globals.stateSaver=e}},{key:"setLoader",value:function(e){this._loader=e}},{key:"setOnWinGame",value:function(e){s.globals.onWinGame=e}},{key:"_load",value:function(){var e=this._loader(),t=e.level,r=e.checkpoint;if(s.globals.curlevel=t,r){var n=[];for(var l in Object.getOwnPropertyNames(r.dat))n[l]=r.dat[l];r.dat=new Int32Array(n),s.globals.curlevelTarget=r}}},{key:"useDefaultSaveAndLoad",value:function(e){this.setSaver(function(t,r){var n=e,l=n+"_checkpoint";window.localStorage.setItem(n,t),r?window.localStorage.setItem(l,JSON.stringify(r)):window.localStorage.removeItem(l)}),this.setLoader(function(){var t=e,r=t+"_checkpoint",n=window.localStorage.getItem(t),l=window.localStorage.getItem(r),o=void 0;return l&&(o=JSON.parse(l)),{level:n,checkpoint:o}})}}]),e}();t["default"]=new d,e.exports=t["default"]},function(e,t){function r(e){l.canvas=e}function n(){return l.canvas.getContext("2d")}Object.defineProperty(t,"__esModule",{value:!0}),t.setCanvas=r,t.getCtx=n;var l={canvas:null,cellwidth:null,cellheight:null,magnification:null,xoffset:null,yoffset:null,x:0,y:0,canvasdict:{},lastDownTarget:null,forceRegenImages:!1};t.globals=l},function(e,t){function r(e){var t=document.createElement("div");t.innerHTML=e;var r=t.textContent||t.innerText||"";return r}function n(e){}function l(e){}function o(e,t){var n=document.getElementById("errormessage");e=r(e),n.innerHTML+=e+"<br>"}function i(e){var t=document.getElementById("errormessage");e=r(e),t.innerHTML+=e+"<br>"}function a(e){var t=document.getElementById("errormessage");e=r(e),t.innerHTML+=e+"<br>"}function s(){}function c(e){}Object.defineProperty(t,"__esModule",{value:!0}),t.stripTags=r,t.consolePrint=n,t.consoleCacheDump=l,t.consoleError=o,t.logErrorNoLine=i,t.logBetaMessage=a,t.clearInputHistory=s,t.pushInput=c;var u={canSetHTMLColors:!0,canDump:!1,canOpenEditor:!1,canYoutube:!0,IDE:!1};t.globals=u},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=!1,n=0,l=null,o=!1,i=!1,a=!1,s=!1,c=!1,u=!1,h=17,f=0,g=150,d=0,p=0,v=!1,m=!1,b=150,y=!1,_=[],w=[],x=!1,k={},C={width:5,height:5,layerCount:2,dat:[1,3,3,1,1,2,2,3,3,1,2,1,2,2,3,3,1,1,2,2,3,2,1,3,2,1,3,2,1,3,1,3,3,1,1,2,2,3,3,1,2,1,2,2,3,3,1,1,2,2],movementMask:[1,3,3,1,1,2,2,3,3,1,2,1,2,2,3,3,1,1,2,2,3,2,1,3,2,1,3,2,1,3,1,3,3,1,1,2,2,3,3,1,2,1,2,2,3,3,1,1,2,2],rigidGroupIndexMask:[],rigidMovementAppliedMask:[],bannedGroup:[],colCellContents:[],rowCellContents:[]},M=C,S={unitTesting:r,curlevel:n,curlevelTarget:l,levelEditorOpened:o,verbose_logging:i,throttle_movement:a,cache_console_messages:s,quittingTitleScreen:c,quittingMessageScreen:u,deltatime:h,timer:f,repeatinterval:g,autotick:d,autotickinterval:p,winning:v,againing:m,againinterval:b,norepeat_action:y,oldflickscreendat:_,keybuffer:w,messageselected:x,textImages:k,level:M};t.globals=S},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=["..................................","..................................","..................................","..................................","..................................",".............new game.............","..................................","...........#.continue.#...........","..................................",".arrow keys to move...............",".X to action......................",".Z to undo, R to restart..........",".................................."],n={title:"2D Whale World",attribution:"increpare",objectCount:2,metadata:[],levels:[],bgcolor:"#000000",fgcolor:"#FFFFFF"},l={titletemplate_select1:r,titleImage:[],titleWidth:r[0].length,titleHeight:r.length,textMode:!0,titleScreen:!0,titleMode:0,titleSelection:0,titleSelected:!1,introstate:n,state:n,messagetext:"",STRIDE_OBJ:1,STRIDE_MOV:1,zoomscreen:!1,flickscreen:!1,screenwidth:0,screenheight:0,matchCache:{}};t.globals=l},function(e,t,r){function n(){ae.globals.state=ae.globals.introstate,ue.globals.level=new D(0,5,5,2,null),ue.globals.level.objects=new Int32Array(0),l(),(0,ie.canvasResize)(),redraw()}function l(){if(ae.globals.titleMode=ue.globals.curlevel>0||null!==ue.globals.curlevelTarget?1:0,0===ae.globals.state.levels.length)return void(ae.globals.titleImage=de);var e="PuzzleScript Game";void 0!==ae.globals.state.metadata.title&&(e=ae.globals.state.metadata.title),0===ae.globals.titleMode?ae.globals.titleSelected?ae.globals.titleImage=o(be):ae.globals.titleImage=o(ve):0===ae.globals.titleSelection?ae.globals.titleSelected?ae.globals.titleImage=o(ye):ae.globals.titleImage=o(me):ae.globals.titleSelected?ae.globals.titleImage=o(_e):ae.globals.titleImage=o(ae.globals.titletemplate_select1);var t="noaction"in ae.globals.state.metadata,r="noundo"in ae.globals.state.metadata,n="norestart"in ae.globals.state.metadata;r&&n?ae.globals.titleImage[11]="..................................":r?ae.globals.titleImage[11]=".R to restart.....................":n&&(ae.globals.titleImage[11]=".Z to undo....................."),t&&(ae.globals.titleImage[10]="..................................");for(var l=0;l<ae.globals.titleImage.length;l++)ae.globals.titleImage[l]=ae.globals.titleImage[l].replace(/\./g," ");for(var a=ae.globals.titleImage[0].length,s=i(e,ae.globals.titleImage[0].length),l=0;l<s.length;l++){var c=s[l],u=c.length,h=(a-u)/2|0,f=ae.globals.titleImage[1+l];ae.globals.titleImage[1+l]=f.slice(0,h)+c+f.slice(h+c.length)}if(void 0!==ae.globals.state.metadata.author)for(var g="by "+ae.globals.state.metadata.author,d=i(g,ae.globals.titleImage[0].length),l=0;l<d.length;l++){var p=d[l]+" ";p.length>a&&(p=p.slice(0,a));var f=ae.globals.titleImage[3+l];ae.globals.titleImage[3+l]=f.slice(0,a-p.length)+p}}function o(e){if(!e)return e;var t,r=[Number,String,Boolean];if(r.forEach(function(r){e instanceof r&&(t=r(e))}),"undefined"==typeof t)if("[object Array]"===Object.prototype.toString.call(e))t=[],e.forEach(function(e,r,n){t[r]=o(e)});else if("object"==typeof e)if(e.nodeType&&"function"==typeof e.cloneNode)var t=e.cloneNode(!0);else if(e.prototype)t=e;else if(e instanceof Date)t=new Date(e);else{t={};for(var n in e)t[n]=o(e[n])}else t=e;return t}function i(e,t){t=t||75;var r=!0;if(!e)return e;var n=".{1,"+t+"}(\\s|$)"+(r?"|.{"+t+"}|.+$":"|\\S+?(\\s|$)");return e.match(RegExp(n,"g"))}function a(){ae.globals.titleMode=0,ae.globals.textMode=!0,ae.globals.titleImage=o(pe);for(var e=0;e<ae.globals.titleImage.length;e++)ae.globals.titleImage[e]=ae.globals.titleImage[e].replace(/\./g," ");var t,r=ae.globals.titleImage[0].length;if(""===ae.globals.messagetext){var n=ae.globals.state.levels[ue.globals.curlevel];t=n.message.trim()}else t=ae.globals.messagetext;we=i(t,ae.globals.titleImage[0].length);for(var e=0;e<we.length;e++){var l=we[e],a=5-(we.length/2|0)+e,s=l.length,c=(r-s)/2|0,u=ae.globals.titleImage[a];ae.globals.titleImage[a]=u.slice(0,c)+l+u.slice(c+l.length)}ue.globals.quittingMessageScreen&&(ae.globals.titleImage[10]=ae.globals.titleImage[9]),(0,ie.canvasResize)()}function s(e,t,r){return null==r&&(r=(Math.random()+Date.now()).toString()),xe=r,ge=new oe.RNG(xe),se.globals.forceRegenImages=!0,ae.globals.titleScreen=!1,ae.globals.titleMode=ue.globals.curlevel>0||null!==ue.globals.curlevelTarget?1:0,ae.globals.titleSelection=ue.globals.curlevel>0||null!==ue.globals.curlevelTarget?1:0,ae.globals.titleSelected=!1,ue.globals.againing=!1,void 0===t?void(0,ce.consolePrint)("Trying to access a GAME.level that doesn't exist.",!0):(void 0===t.message?(ae.globals.titleMode=0,ae.globals.textMode=!1,ue.globals.level=t.clone(),C(),Ce=[],le=x(),"run_rules_on_level_start"in e.metadata&&$(-1,!0)):(_(),a(),(0,ie.canvasResize)()),void(0,ce.clearInputHistory)())}function c(e,t,r,n){var l=r;ue.globals.curlevel=t,ue.globals.curlevelTarget=r,void 0===l.message&&(0===t,v()),s(e,e.levels[t],n),M(r),le=r}function u(e,t,r){var n=e.levels[t];ue.globals.curlevel=t,ue.globals.curlevelTarget=null,void 0===n.message&&(0===t,v()),s(e,n,r)}function h(){l(),(0,ie.canvasResize)()}function f(e){if(void 0!==ae.globals.state.sfx_Events[e]){var t=ae.globals.state.sfx_Events[e];(0,fe.playSound)(t)}}function g(){f("titlescreen")}function d(){f("startgame")}function p(){f("endgame")}function v(){f("startlevel")}function m(){f("endlevel")}function b(){f("undo")}function y(){f("restart")}function _(){f("showmessage")}function w(){f("closemessage")}function x(){var e={dat:new Int32Array(ue.globals.level.objects),width:ue.globals.level.width,height:ue.globals.level.height,oldflickscreendat:ue.globals.oldflickscreendat.concat([])};return e}function k(e,r,n){ue.globals.oldflickscreendat=[],ue.globals.timer=0,ue.globals.autotick=0,ue.globals.winning=!1,ue.globals.againing=!1,ue.globals.messageselected=!1,ae.globals.STRIDE_MOV=e.STRIDE_MOV,ae.globals.STRIDE_OBJ=e.STRIDE_OBJ,void 0===r&&(r=["restart"]),0===ae.globals.state.levels.length&&r.length>0&&"rebuild"===r[0]&&(r=["restart"]),void 0===n&&(n=null),ge=new oe.RNG(n),ae.globals.state=e,window.console.log("setting game state :D "),Ce=[],t.sprites=ke=[];for(var o in ae.globals.state.objects)if(ae.globals.state.objects.hasOwnProperty(o)){var i=ae.globals.state.objects[o],a={colors:i.colors,dat:i.spritematrix};ke[i.id]=a}switch(void 0!==ae.globals.state.metadata.realtime_interval?(ue.globals.autotick=0,ue.globals.autotickinterval=1e3*ae.globals.state.metadata.realtime_interval):(ue.globals.autotick=0,ue.globals.autotickinterval=0),void 0!==ae.globals.state.metadata.key_repeat_interval?ue.globals.repeatinterval=1e3*ae.globals.state.metadata.key_repeat_interval:ue.globals.repeatinterval=150,void 0!==ae.globals.state.metadata.again_interval?ue.globals.againinterval=1e3*ae.globals.state.metadata.again_interval:ue.globals.againinterval=150,ue.globals.throttle_movement&&0===ue.globals.autotickinterval&&logWarning("GAME.throttle_movement is designed for use in conjunction with realtime_interval. Using it in other situations makes games gross and unresponsive, broadly speaking.  Please don't."),ue.globals.norepeat_action=void 0!==ae.globals.state.metadata.norepeat_action,r[0]){case"restart":ue.globals.winning=!1,ue.globals.timer=0,ae.globals.titleScreen=!0,g(),ae.globals.textMode=!0,ae.globals.titleSelection=ue.globals.curlevel>0||null!==ue.globals.curlevelTarget?1:0,ae.globals.titleSelected=!1,ue.globals.quittingMessageScreen=!1,ue.globals.quittingTitleScreen=!1,ue.globals.messageselected=!1,ae.globals.titleMode=0,(ue.globals.curlevel>0||null!==ue.globals.curlevelTarget)&&(ae.globals.titleMode=1),l();break;case"rebuild":break;case"loadLevel":var s=r[1];ue.globals.curlevel=h,ue.globals.winning=!1,ue.globals.timer=0,ae.globals.titleScreen=!1,ae.globals.textMode=!1,ae.globals.titleSelection=ue.globals.curlevel>0||null!==ue.globals.curlevelTarget?1:0,ae.globals.titleSelected=!1,ue.globals.quittingMessageScreen=!1,ue.globals.quittingTitleScreen=!1,ue.globals.messageselected=!1,ae.globals.titleMode=0,u(ae.globals.state,s,n);break;case"levelline":for(var c=r[1],h=ae.globals.state.levels.length-1;h>=0;h--){var f=ae.globals.state.levels[h];if(f.lineNumber<=c+1){ue.globals.curlevel=h,ue.globals.winning=!1,ue.globals.timer=0,ae.globals.titleScreen=!1,ae.globals.textMode=!1,ae.globals.titleSelection=ue.globals.curlevel>0||null!==ue.globals.curlevelTarget?1:0,ae.globals.titleSelected=!1,ue.globals.quittingMessageScreen=!1,ue.globals.quittingTitleScreen=!1,ue.globals.messageselected=!1,ae.globals.titleMode=0,u(ae.globals.state,h);break}}}if("rebuild"!==r[0]&&(0,ce.clearInputHistory)(),(0,ie.canvasResize)(),ce.globals.canYoutube&&"youtube"in ae.globals.state.metadata){var d=ae.globals.state.metadata.youtube,p="https://youtube.googleapis.com/v/"+d+"?autoplay=1&loop=1&playlist="+d;ne=document.createElement("IFRAME"),ne.setAttribute("src",p),ne.style.visibility="hidden",ne.style.width="500px",ne.style.height="500px",ne.style.position="absolute",ne.style.top="-1000px",ne.style.left="-1000px",document.body.appendChild(ne)}}function C(){ue.globals.level.movements=new Int32Array(ue.globals.level.n_tiles*ae.globals.STRIDE_MOV),ue.globals.level.rigidMovementAppliedMask=[],ue.globals.level.rigidGroupIndexMask=[],ue.globals.level.rowCellContents=[],ue.globals.level.colCellContents=[],ue.globals.level.mapCellContents=new N(ae.globals.STRIDE_OBJ),Te=new N(ae.globals.STRIDE_MOV),t._o1=Re=new N(ae.globals.STRIDE_OBJ),t._o2=Oe=new N(ae.globals.STRIDE_OBJ),t._o2_5=Ae=new N(ae.globals.STRIDE_OBJ),t._o3=De=new N(ae.globals.STRIDE_OBJ),t._o4=Ne=new N(ae.globals.STRIDE_OBJ),t._o5=Be=new N(ae.globals.STRIDE_OBJ),t._o6=Pe=new N(ae.globals.STRIDE_OBJ),t._o7=Fe=new N(ae.globals.STRIDE_OBJ),t._o8=je=new N(ae.globals.STRIDE_OBJ),t._o9=He=new N(ae.globals.STRIDE_OBJ),t._o10=We=new N(ae.globals.STRIDE_OBJ),t._o11=ze=new N(ae.globals.STRIDE_OBJ),t._o12=qe=new N(ae.globals.STRIDE_OBJ),t._m1=Ge=new N(ae.globals.STRIDE_MOV),t._m2=Ve=new N(ae.globals.STRIDE_MOV),t._m3=Ue=new N(ae.globals.STRIDE_MOV);for(var e=0;e<ue.globals.level.height;e++)ue.globals.level.rowCellContents[e]=new N(ae.globals.STRIDE_OBJ);for(var e=0;e<ue.globals.level.width;e++)ue.globals.level.colCellContents[e]=new N(ae.globals.STRIDE_OBJ);for(var e=0;e<ue.globals.level.n_tiles;e++)ue.globals.level.rigidMovementAppliedMask[e]=new N(ae.globals.STRIDE_MOV),ue.globals.level.rigidGroupIndexMask[e]=new N(ae.globals.STRIDE_MOV)}function M(e){if(ue.globals.oldflickscreendat=e.oldflickscreendat.concat([]),ue.globals.level.objects=new Int32Array(e.dat),ue.globals.level.width!==e.width||ue.globals.level.height!==e.height)ue.globals.level.width=e.width,ue.globals.level.height=e.height,ue.globals.level.n_tiles=e.width*e.height,C();else{for(var t=0;t<ue.globals.level.n_tiles;t++)ue.globals.level.movements[t]=0,ue.globals.level.rigidMovementAppliedMask[t]=0,ue.globals.level.rigidGroupIndexMask[t]=0;for(var t=0;t<ue.globals.level.height;t++){var r=ue.globals.level.rowCellContents[t];r.setZero()}for(var t=0;t<ue.globals.level.width;t++){var n=ue.globals.level.colCellContents[t];n.setZero()}}ue.globals.againing=!1,ue.globals.level.commandQueue=[]}function S(e){e!==!0&&"norestart"in ae.globals.state.metadata||(e===!1&&Ce.push(x()),ue.globals.verbose_logging&&(0,ce.consolePrint)("--- restarting ---",!0),M(le),y(),"run_rules_on_level_start"in ae.globals.state.metadata&&$(-1,!0),ue.globals.level.commandQueue=[])}function E(e){if((ue.globals.levelEditorOpened||!("noundo"in ae.globals.state.metadata)||e===!0)&&(ue.globals.verbose_logging&&(0,ce.consolePrint)("--- undoing ---",!0),Ce.length>0)){var t=Ce[Ce.length-1];M(t),Ce=Ce.splice(0,Ce.length-1),e||b()}}function L(){for(var e=[],t=ae.globals.state.playerMask,r=0;r<ue.globals.level.n_tiles;r++)ue.globals.level.getCellInto(r,ze),t.anyBitsInCommon(ze)&&e.push(r);return e}function T(e){for(var t=[],r=0;r<ae.globals.state.objectCount;r++)if(e.get(r)){var n=ae.globals.state.idDict[r],l=ae.globals.state.objects[n];t.push(l.layer)}return t}function I(e,t,r){var n=ue.globals.level.getCell(e);n.iand(t);for(var l=T(n),o=ue.globals.level.getMovements(e),i=0;i<l.length;i++)o.ishiftor(r,5*l[i]);ue.globals.level.setMovements(e,o)}function R(e){for(var t=L(),r=0;r<t.length;r++){var n=t[r];I(n,ae.globals.state.playerMask,e)}return t}function O(e,t,r){var n=Me[r],l=n[0],o=n[1],i=e/ue.globals.level.height|0,a=e%ue.globals.level.height,s=ue.globals.level.width-1,c=ue.globals.level.height-1;if(0===i&&0>l||i===s&&l>0||0===a&&0>o||a===c&&o>0)return!1;var u=(e+n[1]+n[0]*ue.globals.level.height)%ue.globals.level.n_tiles,h=ae.globals.state.layerMasks[t],f=ue.globals.level.getCellInto(u,Fe),g=ue.globals.level.getCellInto(e,je);if(h.anyBitsInCommon(f)&&16!=r)return!1;for(var d=0;d<ae.globals.state.sfx_MovementMasks.length;d++){var p=ae.globals.state.sfx_MovementMasks[d],v=p.objectMask;if(v.anyBitsInCommon(g)){var m=ue.globals.level.getMovements(e),b=p.directionMask;m.anyBitsInCommon(b)&&-1===Ee.indexOf(p.seed)&&Ee.push(p.seed)}}var y=g.clone();g.iclear(h),y.iand(h),f.ior(y),ue.globals.level.setCell(e,g),ue.globals.level.setCell(u,f);var _=u/ue.globals.level.height|0,w=u%ue.globals.level.height;return ue.globals.level.colCellContents[_].ior(y),ue.globals.level.rowCellContents[w].ior(y),ue.globals.level.mapCellContents.ior(h),!0}function A(e){var t=ue.globals.level.getMovements(e);if(t.iszero())return!1;for(var r=!1,n=0;n<ue.globals.level.layerCount;n++){var l=t.getshiftor(31,5*n);if(0!==l){var o=O(e,n,l);o&&(t.ishiftclear(l,5*n),r=!0)}}return ue.globals.level.setMovements(e,t),r}function D(e,t,r,n,l){this.lineNumber=e,this.width=t,this.height=r,this.n_tiles=t*r,this.objects=l,this.layerCount=n,this.commandQueue=[]}function N(e){return this.data=new Int32Array(e),this}function B(e){this.direction=e[0],this.patterns=e[1],this.hasReplacements=e[2],this.lineNumber=e[3],this.isEllipsis=e[4],this.groupNumber=e[5],this.isRigid=e[6],this.commands=e[7],this.isRandom=e[8],this.cellRowMasks=e[9],this.cellRowMatches=[];for(var t=0;t<this.patterns.length;t++)this.cellRowMatches.push(this.generateCellRowMatchesFunction(this.patterns[t],this.isEllipsis[t]))}function P(e){this.objectsPresent=e[0],this.objectsMissing=e[1],this.anyObjectsPresent=e[2],this.movementsPresent=e[3],this.movementsMissing=e[4],this.matches=this.generateMatchFunction(ue.globals.level),this.replacement=e[5]}function F(e){this.objectsClear=e[0],this.objectsSet=e[1],this.movementsClear=e[2],this.movementsSet=e[3],this.movementsLayerMask=e[4],this.randomEntityMask=e[5],this.randomDirMask=e[6]}function j(e,t,r,n,l){void 0===l&&(l=0);var o=t[0];if(o.matches(ue.globals.level,r))for(var i=Me[e],a=i[0]*ue.globals.level.height,s=i[1],c=r,u=1;u<t.length;u+=1){c=(c+s+a)%ue.globals.level.n_tiles;var o=t[u];if(o===Ie){for(var h=l;n>h;h++){var f=c;f=(f+(s+a)*h+ue.globals.level.n_tiles)%ue.globals.level.n_tiles;for(var g=u+1;g<t.length&&(o=t[g],o.matches(ue.globals.level,f));g++)f=(f+s+a)%ue.globals.level.n_tiles;if(g>=t.length)return!0}break}if(!o.matches(ue.globals.level,c))break}return!1}function H(e,t,r,n){var l=t[0];if(l.matches(ue.globals.level,r)){for(var o=Me[e],i=o[0]*ue.globals.level.height,a=o[1],s=t.length,c=r,u=1;s>u&&(c=(c+a+i)%ue.globals.level.n_tiles,l=t[u],l===Ie&&(c=(c+(a+i)*n)%ue.globals.level.n_tiles),l.matches(ue.globals.level,c));u++);if(u>=t.length)return!0}return!1}function W(e,t,r,n){var l=[];if(!n.bitsSetInArray(ue.globals.level.mapCellContents.data))return l;var o=0,i=ue.globals.level.width,a=0,s=ue.globals.level.height,c=r.length;switch(e){case 1:a+=c-1;break;case 2:s-=c-1;break;case 4:o+=c-1;break;case 8:i-=c-1;break;default:window.console.log("EEEP "+e)}var u=e>2;if(u){for(var h=a;s>h;h++)if(n.bitsSetInArray(ue.globals.level.rowCellContents[h].data))for(var f=o;i>f;f++){var g=f*ue.globals.level.height+h;t(ue.globals.level,r,g)&&l.push(g)}}else for(var f=o;i>f;f++)if(n.bitsSetInArray(ue.globals.level.colCellContents[f].data))for(var h=a;s>h;h++){var g=f*ue.globals.level.height+h;t(ue.globals.level,r,g)&&l.push(g)}return l}function z(e,t,r,n){var l=[];if(!n.bitsSetInArray(ue.globals.level.mapCellContents.data))return l;var o=0,i=ue.globals.level.width,a=0,s=ue.globals.level.height,c=r.length-1;switch(e){case 1:a+=c-1;break;case 2:s-=c-1;break;case 4:o+=c-1;break;case 8:i-=c-1;break;default:window.console.log("EEEP2 "+e)}var u=e>2;if(u){for(var h=a;s>h;h++)if(n.bitsSetInArray(ue.globals.level.rowCellContents[h].data))for(var f=o;i>f;f++){var g,d=f*ue.globals.level.height+h;4===e?g=f-c+2:8===e?g=ue.globals.level.width-(f+c)+1:window.console.log("EEEP2 "+e),l.push.apply(l,t(ue.globals.level,r,d,g,0))}}else for(var f=o;i>f;f++)if(n.bitsSetInArray(ue.globals.level.colCellContents[f].data))for(var h=a;s>h;h++){var g,d=f*ue.globals.level.height+h;2===e?g=ue.globals.level.height-(h+c)+1:1===e?g=h-c+2:window.console.log("EEEP2 "+e),l.push.apply(l,t(ue.globals.level,r,d,g,0))}return l}function q(e){for(var t=[[]],r=0;r<e.length;r++){for(var n=e[r],l=[],o=0;o<n.length;o++)for(var i=n[o],a=0;a<t.length;a++){var s=t[a],c=s.concat([i]);l.push(c)}t=l}return t}function G(e){var t={ruleGroupIndex:e,objects:new Int32Array(ue.globals.level.objects),movements:new Int32Array(ue.globals.level.movements),rigidGroupIndexMask:ue.globals.level.rigidGroupIndexMask.concat([]),rigidMovementAppliedMask:ue.globals.level.rigidMovementAppliedMask.concat([]),bannedGroup:ue.globals.level.bannedGroup.concat([])};return Je[e]=t,t}function V(e){ue.globals.level.objects=new Int32Array(e.objects),ue.globals.level.movements=new Int32Array(e.movements),ue.globals.level.rigidGroupIndexMask=e.rigidGroupIndexMask.concat([]),ue.globals.level.rigidMovementAppliedMask=e.rigidMovementAppliedMask.concat([]),Ye=new N(ae.globals.STRIDE_OBJ),Ke=new N(ae.globals.STRIDE_OBJ)}function U(){ue.globals.keybuffer=[],ae.globals.textMode=!0,ae.globals.titleScreen=!1,ue.globals.quittingMessageScreen=!1,ue.globals.messageselected=!1,_(),a(),(0,ie.canvasResize)()}function J(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],l=n.findMatches();if(l.length>0)for(var o=q(l),i=0;i<o.length;i++){var a=o[i];t.push([r,a])}}if(0===t.length)return!1;var s=t[Math.floor(ge.uniform()*t.length)],r=s[0],n=e[r],c=Me[n.direction],a=s[1],u=!1,h=n.applyAt(c,a,u);return n.queueCommands(),h}function Y(e){if(e[0].isRandom)return J(e);for(var t=!1,r=!0,n=0;r;){if(n++,n>200){(0,he.logErrorCacheable)("Got caught looping lots in a rule group :O",e[0].lineNumber,!0);break}r=!1;for(var l=0;l<e.length;l++){var o=e[l];r=o.tryApply()||r}r&&(t=!0)}return t}function K(e,t,r,n){for(var l=r>0,o=0,i=r;i<e.length;){if(n&&n[i]);else{var a=e[i];l=Y(a)||l}if(l&&void 0!==t[i]){if(i=t[i],l=!1,o++,o>200){var a=e[i];(0,he.logErrorCacheable)("got caught in an endless startloop...endloop vortex, escaping!",a[0].lineNumber,!0);break}}else if(i++,i===e.length&&l&&void 0!==t[i]&&(i=t[i],l=!1,o++,o>200)){var a=e[i];(0,he.logErrorCacheable)("got caught in an endless startloop...endloop vortex, escaping!",a[0].lineNumber,!0);break}}}function X(e){for(var t=!0;t;){t=!1;for(var r=0;r<ue.globals.level.n_tiles;r++)t=A(r)||t}for(var n=!1,r=0;r<ue.globals.level.n_tiles;r++){var l=ue.globals.level.getCellInto(r,Pe),o=ue.globals.level.getMovements(r);if(!o.iszero()){var i=ue.globals.level.rigidMovementAppliedMask[r];if(0!==i&&(o.iand(i),!o.iszero()))for(var a=0;a<ue.globals.level.layerCount;a++){var s=o.getshiftor(31,5*a);if(0!==s){var c=ue.globals.level.rigidGroupIndexMask[r],u=c.getshiftor(31,5*a);u--;var h=ae.globals.state.rigidGroupIndex_to_GroupIndex[u];ue.globals.level.bannedGroup[h]=!0,n=!0;break}}for(var a=0;a<ae.globals.state.sfx_MovementFailureMasks.length;a++){var f=ae.globals.state.sfx_MovementFailureMasks[a],g=f.objectMask;if(g.anyBitsInCommon(l)){var d=f.directionMask;o.anyBitsInCommon(d)&&-1===Le.indexOf(f.seed)&&Le.push(f.seed)}}}for(var a=0;a<ae.globals.STRIDE_MOV;a++)ue.globals.level.movements[a+r*ae.globals.STRIDE_MOV]=0;ue.globals.level.rigidGroupIndexMask[r]=0,ue.globals.level.rigidMovementAppliedMask[r]=0}return n}function Q(){for(var e=0;e<ue.globals.level.mapCellContents.length;e++)ue.globals.level.mapCellContents[e]=0;for(var e=0;e<ue.globals.level.width;e++){var t=ue.globals.level.colCellContents[e];t.setZero()}for(var e=0;e<ue.globals.level.height;e++){var r=ue.globals.level.rowCellContents[e];r.setZero()}for(var e=0;e<ue.globals.level.width;e++)for(var n=0;n<ue.globals.level.height;n++){var l=n+e*ue.globals.level.height,o=ue.globals.level.getCellInto(l,He);ue.globals.level.mapCellContents.ior(o),ue.globals.level.rowCellContents[n].ior(o),ue.globals.level.colCellContents[e].ior(o)}}function $(e,t,r){ue.globals.againing=!1,ue.globals.verbose_logging&&(-1===e?(0,ce.consolePrint)("Turn starts with no input."):((0,ce.consolePrint)("======================="),(0,ce.consolePrint)("Turn starts with input of "+["up","left","down","right","action"][e]+".")));var n=x(),l=[];if(4>=e){if(e>=0){switch(e){case 0:e=parseInt("00001",2);break;case 1:e=parseInt("00100",2);break;case 2:e=parseInt("00010",2);break;case 3:e=parseInt("01000",2);break;case 4:e=parseInt("10000",2)}l=R(e)}var o=0;ue.globals.level.bannedGroup=[],Je=[],ue.globals.level.commandQueue=[];var i=0,a=!1,s=G();Ye=new N(ae.globals.STRIDE_OBJ),Ke=new N(ae.globals.STRIDE_OBJ),Ee=[],Le=[],Q();do{a=!1,o++,ue.globals.verbose_logging&&(0,ce.consolePrint)("applying rules"),K(ae.globals.state.rules,ae.globals.state.loopPoint,i,ue.globals.level.bannedGroup);var c=X();c?(a=!0,V(s),i=0):(ue.globals.verbose_logging&&(0,ce.consolePrint)("applying late rules"),K(ae.globals.state.lateRules,ae.globals.state.lateLoopPoint,0),i=0)}while(50>o&&a);if(o>=50&&(0,ce.consolePrint)("looped through 50 times, gave up.  too many loops!"),l.length>0&&void 0!==ae.globals.state.metadata.require_player_movement){for(var u=!1,o=0;o<l.length;o++){var h=l[o],g=ue.globals.level.getCell(h);if(ae.globals.state.playerMask.bitsClearInArray(g.data)){u=!0;break}}if(u===!1)return ue.globals.verbose_logging&&((0,ce.consolePrint)("require_player_movement set, but no player movement detected, so cancelling turn."),consoleCacheDump()),Ce.push(n),E(!0),!1}if(ue.globals.level.commandQueue.indexOf("cancel")>=0)return ue.globals.verbose_logging&&((0,ce.consolePrint)("CANCEL command executed, cancelling turn."),consoleCacheDump()),Ce.push(n),E(!0),!1;if(ue.globals.level.commandQueue.indexOf("restart")>=0)return ue.globals.verbose_logging&&((0,ce.consolePrint)("RESTART command executed, reverting to restart state."),consoleCacheDump()),Ce.push(n),S(!0),!0;if(r&&ue.globals.level.commandQueue.indexOf("win")>=0)return!0;for(var d=!1,o=0;o<ue.globals.level.objects.length;o++)if(ue.globals.level.objects[o]!==n.dat[o]){if(r)return ue.globals.verbose_logging&&consoleCacheDump(),Ce.push(n),E(!0),!0;-1!==e&&Ce.push(n),d=!0;break}if(r)return ue.globals.verbose_logging&&consoleCacheDump(),!1;for(var o=0;o<Le.length;o++)(0,fe.playSound)(Le[o]);for(var o=0;o<Ee.length;o++)(0,fe.playSound)(Ee[o]);for(var o=0;o<ae.globals.state.sfx_CreationMasks.length;o++){var p=ae.globals.state.sfx_CreationMasks[o];Ye.anyBitsInCommon(p.objectMask)&&(0,fe.playSound)(p.seed)}for(var o=0;o<ae.globals.state.sfx_DestructionMasks.length;o++){var p=ae.globals.state.sfx_DestructionMasks[o];Ke.anyBitsInCommon(p.objectMask)&&(0,fe.playSound)(p.seed)}for(var o=0;o<ue.globals.level.commandQueue.length;o++){var v=ue.globals.level.commandQueue[o];"f"===v.charAt(1)&&f(v),ue.globals.unitTesting===!1&&"message"===v&&U()}if(ae.globals.textMode!==!1||void 0!==t&&t!==!1||(ue.globals.verbose_logging&&(0,ce.consolePrint)("Checking win condition."),Z()),!ue.globals.winning&&(ue.globals.level.commandQueue.indexOf("checkpoint")>=0&&(ue.globals.verbose_logging&&(0,ce.consolePrint)("CHECKPOINT command executed, saving current state to the restart state."),le=x(),ue.globals.curlevelTarget=le,ue.globals.stateSaver(ue.globals.curlevel,le)),ue.globals.level.commandQueue.indexOf("again")>=0&&d)){var m=ue.globals.verbose_logging,b=ae.globals.messagetext;ue.globals.verbose_logging=!1,$(-1,!0,!0)?(ue.globals.verbose_logging=m,ue.globals.verbose_logging&&(0,ce.consolePrint)("AGAIN command executed, with changes detected - will execute another turn."),ue.globals.againing=!0,ue.globals.timer=0):(ue.globals.verbose_logging=m,ue.globals.verbose_logging&&(0,ce.consolePrint)("AGAIN command not executed, it wouldn't make any changes.")),ue.globals.verbose_logging=m,ae.globals.messagetext=b}ue.globals.level.commandQueue=[]}return ue.globals.verbose_logging&&consoleCacheDump(),ue.globals.winning&&(ue.globals.againing=!1),d}function Z(){if(!ue.globals.levelEditorOpened){if(ue.globals.level.commandQueue.indexOf("win")>=0)return(0,ce.consolePrint)("Win Condition Satisfied"),void ee();var e=!1;if(ae.globals.state.winconditions.length>0){for(var t=!0,r=0;r<ae.globals.state.winconditions.length;r++){var n=ae.globals.state.winconditions[r],l=n[1],o=n[2],i=!0;switch(n[0]){case-1:for(var a=0;a<ue.globals.level.n_tiles;a++){var s=ue.globals.level.getCellInto(a,We);if(!l.bitsClearInArray(s.data)&&!o.bitsClearInArray(s.data)){i=!1;break}}break;case 0:for(var c=!1,a=0;a<ue.globals.level.n_tiles;a++){var s=ue.globals.level.getCellInto(a,We);if(!l.bitsClearInArray(s.data)&&!o.bitsClearInArray(s.data)){c=!0;break}}c===!1&&(i=!1);break;case 1:for(var a=0;a<ue.globals.level.n_tiles;a++){var s=ue.globals.level.getCellInto(a,We);if(!l.bitsClearInArray(s.data)&&o.bitsClearInArray(s.data)){i=!1;break}}}i===!1&&(t=!1)}e=t}e&&((0,ce.consolePrint)("Win Condition Satisfied"),ee())}}function ee(){if(!ue.globals.winning){if(ue.globals.againing=!1,m(),ue.globals.unitTesting)return void te();ue.globals.winning=!0,ue.globals.timer=0}}function te(){ue.globals.keybuffer=[],ue.globals.againing=!1,ae.globals.messagetext="",ae.globals.titleScreen?(0===ae.globals.titleSelection&&(ue.globals.curlevel=0,ue.globals.curlevelTarget=null),null!==ue.globals.curlevelTarget?c(ae.globals.state,ue.globals.curlevel,ue.globals.curlevelTarget):u(ae.globals.state,ue.globals.curlevel)):ue.globals.curlevel<ae.globals.state.levels.length-1?(ue.globals.curlevel++,ae.globals.textMode=!1,ae.globals.titleScreen=!1,ue.globals.quittingMessageScreen=!1,ue.globals.messageselected=!1,null!==ue.globals.curlevelTarget?c(ae.globals.state,ue.globals.curlevel,ue.globals.curlevelTarget):u(ae.globals.state,ue.globals.curlevel)):(ue.globals.curlevel=0,ue.globals.curlevelTarget=null,re(),p(),ue.globals.onWinGame()),ue.globals.stateSaver(ue.globals.curlevel,ue.globals.curlevelTarget),(0,ie.canvasResize)(),(0,ce.clearInputHistory)()}function re(){ue.globals.againing=!1,ae.globals.messagetext="",ae.globals.titleScreen=!0,ae.globals.textMode=!0,ae.globals.titleSelection=ue.globals.curlevel>0||null!==ue.globals.curlevelTarget?1:0,l()}Object.defineProperty(t,"__esModule",{value:!0}),t.unloadGame=n,t.generateTitleScreen=l,t.deepClone=o,t.wordwrap=i,t.drawMessageScreen=a,t.loadLevelFromLevelDat=s,t.loadLevelFromStateTarget=c,t.loadLevelFromState=u,t.init=h,t.tryPlaySimpleSound=f,t.tryPlayTitleSound=g,t.tryPlayStartGameSound=d,t.tryPlayEndGameSound=p,t.tryPlayStartLevelSound=v,t.tryPlayEndLevelSound=m,t.tryPlayUndoSound=b,t.tryPlayRestartSound=y,t.tryPlayShowMessageSound=_,t.tryPlayCloseMessageSound=w,t.backupLevel=x,t.setGameState=k,t.RebuildLevelArrays=C,t.restoreLevel=M,t.DoRestart=S,t.DoUndo=E,t.getPlayerPositions=L,t.getLayersOfMask=T,t.moveEntitiesAtIndex=I,t.startMovement=R,t.repositionEntitiesOnLayer=O,t.repositionEntitiesAtCell=A,t.Level=D,t.BitVec=N,t.Rule=B,t.CellPattern=P,t.CellReplacement=F,t.DoesCellRowMatchWildCard=j,t.DoesCellRowMatch=H,t.matchCellRow=W,t.matchCellRowWildCard=z,t.generateTuples=q,
t.commitPreservationState=G,t.restorePreservationState=V,t.showTempMessage=U,t.applyRandomRuleGroup=J,t.applyRuleGroup=Y,t.applyRules=K,t.resolveMovements=X,t.calculateRowColMasks=Q,t.processInput=$,t.checkWin=Z,t.DoWin=ee,t.nextLevel=te,t.goToTitleScreen=re;var ne,le,oe=r(7),ie=r(8),ae=r(5),se=r(2),ce=r(3),ue=r(4),he=r(10),fe=r(13),ge=new oe.RNG,de=["..................................","..................................","..................................","......Puzzle Script Terminal......","..............v 1.0...............","..................................","..................................","..................................",".........insert cartridge.........","..................................","..................................","..................................",".................................."],pe=["..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..........X to continue...........","..................................",".................................."],ve=["..................................","..................................","..................................","..................................","..................................","..................................","..........#.start game.#..........","..................................","..................................",".arrow keys to move...............",".X to action......................",".Z to undo, R to restart..........",".................................."],me=["..................................","..................................","..................................","..................................","..................................","...........#.new game.#...........","..................................",".............continue.............","..................................",".arrow keys to move...............",".X to action......................",".Z to undo, R to restart..........",".................................."],be=["..................................","..................................","..................................","..................................","..................................","..................................","###########.start game.###########","..................................","..................................",".arrow keys to move...............",".X to action......................",".Z to undo, R to restart..........",".................................."],ye=["..................................","..................................","..................................","..................................","..................................","############.new game.############","..................................",".............continue.............","..................................",".arrow keys to move...............",".X to action......................",".Z to undo, R to restart..........",".................................."],_e=["..................................","..................................","..................................","..................................","..................................",".............new game.............","..................................","############.continue.############","..................................",".arrow keys to move...............",".X to action......................",".Z to undo, R to restart..........",".................................."],we=[],xe=0,ke=[{color:"#423563",dat:[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]]},{color:"#252342",dat:[[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,1,1,1,0],[0,1,0,1,0]]}],Ce=[],Me={1:[0,-1],2:[0,1],4:[-1,0],8:[1,0],15:[0,0],16:[0,0],3:[0,0]},Se={1:"up",2:"down",4:"left",8:"right",15:"?",16:"action",3:"no"},Ee=[],Le=[];D.prototype.clone=function(){var e=new D(this.lineNumber,this.width,this.height,this.layerCount,null);return e.objects=new Int32Array(this.objects),e},D.prototype.getCell=function(e){return new N(this.objects.subarray(e*ae.globals.STRIDE_OBJ,e*ae.globals.STRIDE_OBJ+ae.globals.STRIDE_OBJ))},D.prototype.getCellInto=function(e,t){for(var r=0;r<ae.globals.STRIDE_OBJ;r++)t.data[r]=this.objects[e*ae.globals.STRIDE_OBJ+r];return t},D.prototype.setCell=function(e,t){for(var r=0;r<t.data.length;++r)this.objects[e*ae.globals.STRIDE_OBJ+r]=t.data[r]};var Te;D.prototype.getMovements=function(e){for(var t=0;t<ae.globals.STRIDE_MOV;t++)Te.data[t]=this.movements[e*ae.globals.STRIDE_MOV+t];return Te},D.prototype.setMovements=function(e,t){for(var r=0;r<t.data.length;++r)this.movements[e*ae.globals.STRIDE_MOV+r]=t.data[r]};var Ie=["ellipsis"];N.prototype.cloneInto=function(e){for(var t=0;t<this.data.length;++t)e.data[t]=this.data[t];return e},N.prototype.clone=function(){return new N(this.data)},N.prototype.iand=function(e){for(var t=0;t<this.data.length;++t)this.data[t]&=e.data[t]},N.prototype.ior=function(e){for(var t=0;t<this.data.length;++t)this.data[t]|=e.data[t]},N.prototype.iclear=function(e){for(var t=0;t<this.data.length;++t)this.data[t]&=~e.data[t]},N.prototype.ibitset=function(e){this.data[e>>5]|=1<<(31&e)},N.prototype.ibitclear=function(e){this.data[e>>5]&=~(1<<(31&e))},N.prototype.get=function(e){return 0!==(this.data[e>>5]&1<<(31&e))},N.prototype.getshiftor=function(e,t){var r=31&t,n=this.data[t>>5]>>>r;return r&&(n|=this.data[(t>>5)+1]<<32-r),n&e},N.prototype.ishiftor=function(e,t){var r=31&t,n=e<<r;if(this.data[t>>5]|=n,r){var l=e>>32-r;this.data[(t>>5)+1]|=l}},N.prototype.ishiftclear=function(e,t){var r=31&t,n=e<<r;if(this.data[t>>5]&=~n,r){var l=e>>32-(31&t);this.data[(t>>5)+1]&=~l}},N.prototype.equals=function(e){if(this.data.length!==e.data.length)return!1;for(var t=0;t<this.data.length;++t)if(this.data[t]!==e.data[t])return!1;return!0},N.prototype.setZero=function(){for(var e=0;e<this.data.length;++e)this.data[e]=0},N.prototype.iszero=function(){for(var e=0;e<this.data.length;++e)if(this.data[e])return!1;return!0},N.prototype.bitsSetInArray=function(e){for(var t=0;t<this.data.length;++t)if((this.data[t]&e[t])!==this.data[t])return!1;return!0},N.prototype.bitsClearInArray=function(e){for(var t=0;t<this.data.length;++t)if(this.data[t]&e[t])return!1;return!0},N.prototype.anyBitsInCommon=function(e){return!this.bitsClearInArray(e.data)},B.prototype.generateCellRowMatchesFunction=function(e,t){if(0==t){for(var r=Me[this.direction],n=r[0],l=r[1],o=e.length,i="var d = "+l+"+"+n+"*GAME_dot_level.height;\n",a=1===ae.globals.STRIDE_OBJ?"":"*"+ae.globals.STRIDE_OBJ,s=0;s<ae.globals.STRIDE_OBJ;++s)i+="var cellObjects"+s+" = GAME_dot_level.objects[i"+a+(s?"+"+s:"")+"];\n";a=1===ae.globals.STRIDE_MOV?"":"*"+ae.globals.STRIDE_MOV;for(var s=0;s<ae.globals.STRIDE_MOV;++s)i+="var cellMovements"+s+" = GAME_dot_level.movements[i"+a+(s?"+"+s:"")+"];\n";i+="return "+e[0].generateMatchString("0_");for(var c=1;o>c;c++)i+="&&cellRow["+c+"].matches(GAME_dot_level, (i+"+c+"*d)%GAME_dot_level.n_tiles)";return i+=";",i in ae.globals.matchCache?ae.globals.matchCache[i]:ae.globals.matchCache[i]=new Function("GAME_dot_level","cellRow","i",i)}var r=Me[this.direction],n=r[0],l=r[1],o=e.length,i="var d = "+l+"+"+n+"*GAME_dot_level.height;\n";i+="var result = [];\n",i+="if(cellRow[0].matches(GAME_dot_level, i)";for(var c=1;e[c]!==Ie;c++)i+="&&cellRow["+c+"].matches(GAME_dot_level, (i+"+c+"*d)%GAME_dot_level.n_tiles)";for(c++,i+=") {\n",i+="	for (var k=kmin;k<kmax;k++) {\n",i+="		if(cellRow["+c+"].matches(GAME_dot_level,(i+d*(k+"+(c-1)+"))%GAME_dot_level.n_tiles)",c++;o>c;c++)i+="&&cellRow["+c+"].matches(GAME_dot_level,(i+d*(k+"+(c-1)+"))%GAME_dot_level.n_tiles)";return i+="){\n",i+="			result.push([i,k]);\n",i+="		}\n",i+="	}\n",i+="}\n",i+="return result;",i in ae.globals.matchCache?ae.globals.matchCache[i]:ae.globals.matchCache[i]=new Function("GAME_dot_level","cellRow","i","kmax","kmin",i)},B.prototype.toJSON=function(){return[this.direction,this.patterns,this.hasReplacements,this.lineNumber,this.isEllipsis,this.groupNumber,this.isRigid,this.commands,this.isRandom,this.cellRowMasks]},P.prototype.generateMatchString=function(){for(var e="(true",t=0;t<Math.max(ae.globals.STRIDE_OBJ,ae.globals.STRIDE_MOV);++t){var r="cellObjects"+t,n="cellMovements"+t,l=this.objectsPresent.data[t],o=this.objectsMissing.data[t],i=this.movementsPresent.data[t],a=this.movementsMissing.data[t];l&&(e+=l&l-1?"		&& (("+r+"&"+l+")==="+l+")\n":"		&& ("+r+"&"+l+")\n"),o&&(e+="		&& !("+r+"&"+o+")\n"),i&&(e+=i&i-1?"		&& (("+n+"&"+i+")==="+i+")\n":"		&& ("+n+"&"+i+")\n"),a&&(e+="		&& !("+n+"&"+a+")\n")}for(var s=0;s<this.anyObjectsPresent.length;s++){e+="		&& (0";for(var t=0;t<ae.globals.STRIDE_OBJ;++t){var c=this.anyObjectsPresent[s].data[t];c&&(e+="|(cellObjects"+t+"&"+c+")")}e+=")"}return e+="	)"},P.prototype.generateMatchFunction=function(){for(var e,t="",r=1===ae.globals.STRIDE_OBJ?"":"*"+ae.globals.STRIDE_OBJ,e=0;e<ae.globals.STRIDE_OBJ;++e)t+="	var cellObjects"+e+" = GAME_dot_level.objects[i"+r+(e?"+"+e:"")+"];\n";r=1===ae.globals.STRIDE_MOV?"":"*"+ae.globals.STRIDE_MOV;for(var e=0;e<ae.globals.STRIDE_MOV;++e)t+="	var cellMovements"+e+" = GAME_dot_level.movements[i"+r+(e?"+"+e:"")+"];\n";return t+="return "+this.generateMatchString()+";",t in ae.globals.matchCache?ae.globals.matchCache[t]:ae.globals.matchCache[t]=new Function("GAME_dot_level","i",t)},P.prototype.toJSON=function(){return[this.movementMask,this.cellMask,this.nonExistenceMask,this.moveNonExistenceMask,this.moveStationaryMask,this.randomDirOrEntityMask,this.movementsToRemove]};var Re,Oe,Ae,De,Ne,Be,Pe,Fe,je,He,We,ze,qe,Ge,Ve,Ue;P.prototype.replace=function(e,t){var r=this.replacement;if(null===r)return!1;var n=r.randomEntityMask,l=r.randomDirMask,o=r.objectsSet.cloneInto(Re),i=r.objectsClear.cloneInto(Oe),a=r.movementsSet.cloneInto(Ge),s=r.movementsClear.cloneInto(Ve);if(s.ior(r.movementsLayerMask),!n.iszero()){for(var c=[],u=0;u<32*ae.globals.STRIDE_OBJ;u++)n.get(u)&&c.push(u);var h=c[Math.floor(ge.uniform()*c.length)],f=ae.globals.state.idDict[h],g=ae.globals.state.objects[f];o.ibitset(h),i.ior(ae.globals.state.layerMasks[g.layer]),s.ishiftor(31,5*g.layer)}if(!l.iszero())for(var d=0;d<ue.globals.level.layerCount;d++)if(l.get(5*d)){var p=Math.floor(4*ge.uniform());a.ibitset(p+5*d)}var v=ue.globals.level.getCellInto(t,Ae),m=ue.globals.level.getMovements(t),b=v.cloneInto(De),y=m.cloneInto(Ue);v.iclear(i),v.ior(o),m.iclear(s),m.ior(a);var _=!1,w=0,x=0;if(e.isRigid){var k=ae.globals.state.groupNumber_to_RigidGroupIndex[e.groupNumber];k++;for(var C=new N(ae.globals.STRIDE_MOV),M=0;M<ue.globals.level.layerCount;M++)C.ishiftor(k,5*M);C.iand(r.movementsLayerMask),w=ue.globals.level.rigidGroupIndexMask[t]||new N(ae.globals.STRIDE_MOV),x=ue.globals.level.rigidMovementAppliedMask[t]||new N(ae.globals.STRIDE_MOV),C.bitsSetInArray(w.data)||r.movementsLayerMask.bitsSetInArray(x.data)||(w.ior(C),x.ior(r.movementsLayerMask),_=!0)}var S=!1;if(!b.equals(v)||!y.equals(m)||_){S=!0,_&&(ue.globals.level.rigidGroupIndexMask[t]=w,ue.globals.level.rigidMovementAppliedMask[t]=x);var E=v.cloneInto(Ne);E.iclear(b),Ye.ior(E);var L=b.cloneInto(Be);L.iclear(v),Ke.ior(L),ue.globals.level.setCell(t,v),ue.globals.level.setMovements(t,m);var T=t/ue.globals.level.height|0,I=t%ue.globals.level.height;ue.globals.level.colCellContents[T].ior(v),ue.globals.level.rowCellContents[I].ior(v),ue.globals.level.mapCellContents.ior(v)}return S};var Je=[];B.prototype.findMatches=function(){for(var e=[],t=this.cellRowMasks,r=0;r<this.patterns.length;r++){var n=this.patterns[r],l=this.cellRowMatches[r];if(this.isEllipsis[r])var o=z(this.direction,l,n,t[r]);else var o=W(this.direction,l,n,t[r]);if(0===o.length)return[];e.push(o)}return e},B.prototype.applyAt=function(e,t,r){var n=this;if(r){for(var l=!0,o=0;o<n.patterns.length;o++)if(n.isEllipsis[o]){if(j(n.direction,n.patterns[o],t[o][0],t[o][1]+1,t[o][1])===!1){l=!1;break}}else if(H(n.direction,n.patterns[o],t[o])===!1){l=!1;break}if(l===!1)return!1}for(var i=!1,a=e[0]*ue.globals.level.height,s=e[1],o=0;o<n.patterns.length;o++)for(var c=n.patterns[o],u=n.isEllipsis[o]?t[o][0]:t[o],h=0;h<c.length;h++){var f=c[h];if(f!==Ie)i=f.replace(n,u)||i,u=(u+s+a)%ue.globals.level.n_tiles;else{var g=t[o][1];u=(u+(s+a)*g)%ue.globals.level.n_tiles}}if(ue.globals.verbose_logging&&i){var d=Se[n.direction],p='<font color="green">Rule <a onclick="jumpToLine('+n.lineNumber+');"  href="javascript:void(0);">'+n.lineNumber+"</a> "+d+" applied.</font>";(0,ce.consolePrint)(p)}return i},B.prototype.tryApply=function(){var e=Me[this.direction],t=this.findMatches();if(0===t.length)return!1;var r=!1;if(this.hasReplacements)for(var n=q(t),l=0;l<n.length;l++){var o=n[l],i=l>0,a=this.applyAt(e,o,i);r=a||r}return t.length>0&&this.queueCommands(),r},B.prototype.queueCommands=function(){for(var e=this.commands,t=0;t<e.length;t++){var r=e[t];if(!(ue.globals.level.commandQueue.indexOf(r[0])>=0)){if(ue.globals.level.commandQueue.push(r[0]),ue.globals.verbose_logging){var n=this.lineNumber,l=(Se[this.direction],'<font color="green">Rule <a onclick="jumpToLine('+n.toString()+');"  href="javascript:void(0);">'+n.toString()+"</a> triggers command "+r[0]+".</font>");(0,ce.consolePrint)(l)}"message"===r[0]&&(ae.globals.messagetext=r[1])}}};var Ye=0,Ke=0;t.ellipsisPattern=Ie,t.sprites=ke,t._o1=Re,t._o2=Oe,t._o2_5=Ae,t._o3=De,t._o4=Ne,t._o5=Be,t._o6=Pe,t._o7=Fe,t._o8=je,t._o9=He,t._o10=We,t._o11=ze,t._o12=qe,t._m1=Ge,t._m2=Ve,t._m3=Ue},function(e,t){function r(e){this.s=new Array(256),this.i=0,this.j=0;for(var t=0;256>t;t++)this.s[t]=t;e&&this.mix(e)}function n(){var e=new Error,t=e.stack;console.log(t)}function l(e){this.seed=e,null==e?e=(Math.random()+Date.now()).toString():"function"==typeof e?(this.uniform=e,this.nextByte=function(){return~~(256*this.uniform())},e=null):"[object String]"!==Object.prototype.toString.call(e)&&(e=JSON.stringify(e)),this._normal=null,e?this._state=new r(e):this._state=null}Object.defineProperty(t,"__esModule",{value:!0}),t.RC4=r,t.print_call_stack=n,t.RNG=l,/**
		 * Seedable random number generator functions.
		 * @version 1.0.0
		 * @license Public Domain
		 *
		 * @example
		 * var rng = new RNG('Example');
		 * rng.random(40, 50);  // =>  42
		 * rng.uniform();       // =>  0.7972798995050903
		 * rng.normal();        // => -0.6698504543216376
		 * rng.exponential();   // =>  1.0547367609131555
		 * rng.poisson(4);      // =>  2
		 * rng.gamma(4);        // =>  2.781724687386858
		 */
String.prototype.getBytes=function(){for(var e=[],t=0;t<this.length;t++){var r=this.charCodeAt(t),n=[];do n.push(255&r),r>>=8;while(r>0);e=e.concat(n.reverse())}return e},r.prototype._swap=function(e,t){var r=this.s[e];this.s[e]=this.s[t],this.s[t]=r},r.prototype.mix=function(e){for(var t=e.getBytes(),r=0,n=0;n<this.s.length;n++)r+=this.s[n]+t[n%t.length],r%=256,this._swap(n,r)},r.prototype.next=function(){return this.i=(this.i+1)%256,this.j=(this.j+this.s[this.i])%256,this._swap(this.i,this.j),this.s[(this.s[this.i]+this.s[this.j])%256]},l.prototype.nextByte=function(){return this._state.next()},l.prototype.uniform=function(){for(var e=7,t=0,r=0;e>r;r++)t*=256,t+=this.nextByte();return t/(Math.pow(2,8*e)-1)},l.prototype.random=function(e,t){return null==e?this.uniform():(null==t&&(t=e,e=0),e+Math.floor(this.uniform()*(t-e)))},l.prototype.normal=function(){if(null!==this._normal){var e=this._normal;return this._normal=null,e}var t=this.uniform()||Math.pow(2,-53),r=this.uniform();return this._normal=Math.sqrt(-2*Math.log(t))*Math.sin(2*Math.PI*r),Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*r)},l.prototype.exponential=function(){return-Math.log(this.uniform()||Math.pow(2,-53))},l.prototype.poisson=function(e){var t=Math.exp(-(e||1)),r=0,n=1;do r++,n*=this.uniform();while(n>t);return r-1},l.prototype.gamma=function(e){var t=(1>e?1+e:e)-1/3,r=1/Math.sqrt(9*t);do{do var n=this.normal(),l=Math.pow(r*n+1,3);while(0>=l);var o=this.uniform(),i=Math.pow(n,2)}while(o>=1-.0331*i*i&&Math.log(o)>=.5*i+t*(1-l+Math.log(l)));return 1>e?t*l*Math.exp(this.exponential()/-e):t*l},l.roller=function(e,t){var r=e.split(/(\d+)?d(\d+)([+-]\d+)?/).slice(1),n=parseFloat(r[0])||1,o=parseFloat(r[1]),i=parseFloat(r[2])||0;return t=t||new l,function(){for(var e=n+i,r=0;n>r;r++)e+=t.random(o);return e}}},function(e,t,r){function n(e){return e&&e.__esModule?e:{"default":e}}function l(e,t,r,n){void 0===r&&(r=[M.globals.state.bgcolor,M.globals.state.fgcolor]);var l=a(e),o=l.getContext("2d");o.clearRect(0,0,M.globals.cellwidth,M.globals.cellheight);var i=t[0].length,s=t.length,c=~~(M.globals.cellwidth/(i+(0|n))),u=~~(M.globals.cellheight/(s+(0|n))),h=u;"scanline"in M.globals.state.metadata&&(h=Math.ceil(u/2)),o.fillStyle=M.globals.state.fgcolor;for(var f=0;i>f;f++)for(var g=0;s>g;g++){var d=t[f][g];if(d>=0){var p=f*c|0,v=g*u|0;o.fillStyle=r[d],o.fillRect(v,p,c,h)}}return l}function o(e,t){E.globals.textImages={};for(var r in C["default"])C["default"].hasOwnProperty(r)&&(E.globals.textImages[r]=l("char"+r,C["default"][r],void 0,1))}function i(){if(M.globals.textMode)return void o();if(E.globals.levelEditorOpened&&(E.globals.textImages.s=l("chars",C["default"].s,void 0)),0!==M.globals.state.levels.length){p=[];for(var e=0;e<S.sprites.length;e++)void 0!=S.sprites[e]&&(p[e]=l(e.toString(),S.sprites[e].dat,S.sprites[e].colors));(!1).canOpenEditor&&s()}}function a(e){var t;return e in x.globals.canvasdict?t=x.globals.canvasdict[e]:(t=document.createElement("canvas"),x.globals.canvasdict[e]=t),t.width=M.globals.cellwidth,t.height=M.globals.cellheight,t}function s(){if(0!==M.globals.cellwidth&&0!==M.globals.cellheight){v=[],m=[];for(var e in M.globals.state.glyphDict)if(1==e.length&&M.globals.state.glyphDict.hasOwnProperty(e)){var t=M.globals.state.glyphDict[e],r=a("C"+e),n=r.getContext("2d");v.push(e);for(var l=0;l<t.length;l++){var o=t[l];-1!==o&&n.drawImage(p[o],0,0)}m.push(r)}b=a("highlight");var n=b.getContext("2d");n.fillStyle="#FFFFFF",n.fillRect(0,0,M.globals.cellwidth,1),n.fillRect(0,0,1,M.globals.cellheight),n.fillRect(0,M.globals.cellheight-1,M.globals.cellwidth,1),n.fillRect(M.globals.cellwidth-1,0,1,M.globals.cellheight),_=E.globals.textImages.s,y=a("highlightresize");var n=y.getContext("2d");n.fillStyle="#FFFFFF";var i=M.globals.cellwidth/2-1|0,s=M.globals.cellwidth-i-1-i,c=M.globals.cellheight/2-1|0,u=M.globals.cellheight-c-1-i;n.fillRect(i,0,s,M.globals.cellheight),n.fillRect(0,c,M.globals.cellwidth,u),w=a();var n=w.getContext("2d");n.fillStyle="yellow",n.fillRect(0,0,M.globals.cellwidth,2),n.fillRect(0,0,2,M.globals.cellheight),n.fillRect(0,M.globals.cellheight-2,M.globals.cellwidth,2),n.fillRect(M.globals.cellwidth-2,0,2,M.globals.cellheight)}}function c(){var e=0;for(var t in M.globals.state.glyphDict)1==t.length&&M.globals.state.glyphDict.hasOwnProperty(t)&&e++;return e}function u(){if(0!==M.globals.cellwidth&&0!==M.globals.cellheight)if(void 0===p&&i(),M.globals.textMode){(0,x.getCtx)().fillStyle=M.globals.state.bgcolor,(0,x.getCtx)().fillRect(0,0,x.globals.canvas.width,x.globals.canvas.height);for(var e=0;e<M.globals.titleWidth;e++)for(var t=0;t<M.globals.titleHeight;t++){var r=M.globals.titleImage[t].charAt(e);if(r in E.globals.textImages){var n=E.globals.textImages[r];(0,x.getCtx)().drawImage(n,M.globals.xoffset+e*M.globals.cellwidth,M.globals.yoffset+t*M.globals.cellheight)}}}else{(0,x.getCtx)().fillStyle=M.globals.state.bgcolor,(0,x.getCtx)().fillRect(0,0,x.globals.canvas.width,x.globals.canvas.height);var l=0,o=M.globals.screenwidth,a=0,s=M.globals.screenheight;if(E.globals.levelEditorOpened){var u=c();T=Math.ceil(u/(M.globals.screenwidth-1)),o-=2,s-=2+T}else if(M.globals.flickscreen){var f=(0,S.getPlayerPositions)();if(f.length>0){var g=f[0],d=g/E.globals.level.height|0,v=g%E.globals.level.height|0,m=d/M.globals.screenwidth|0,b=v/M.globals.screenheight|0;l=m*M.globals.screenwidth,a=b*M.globals.screenheight,o=Math.min(l+M.globals.screenwidth,E.globals.level.width),s=Math.min(a+M.globals.screenheight,E.globals.level.height),E.globals.oldflickscreendat=[l,a,o,s]}else E.globals.oldflickscreendat.length>0&&(l=E.globals.oldflickscreendat[0],a=E.globals.oldflickscreendat[1],o=E.globals.oldflickscreendat[2],s=E.globals.oldflickscreendat[3])}else if(M.globals.zoomscreen){var f=(0,S.getPlayerPositions)();if(f.length>0){var g=f[0],d=g/E.globals.level.height|0,v=g%E.globals.level.height|0;l=Math.max(Math.min(d-(M.globals.screenwidth/2|0),E.globals.level.width-M.globals.screenwidth),0),a=Math.max(Math.min(v-(M.globals.screenheight/2|0),E.globals.level.height-M.globals.screenheight),0),o=Math.min(l+M.globals.screenwidth,E.globals.level.width),s=Math.min(a+M.globals.screenheight,E.globals.level.height),E.globals.oldflickscreendat=[l,a,o,s]}else E.globals.oldflickscreendat.length>0&&(l=E.globals.oldflickscreendat[0],a=E.globals.oldflickscreendat[1],o=E.globals.oldflickscreendat[2],s=E.globals.oldflickscreendat[3])}for(var e=l;o>e;e++)for(var t=a;s>t;t++)for(var y=t+e*E.globals.level.height,_=E.globals.level.getCellInto(y,S._o12),w=0;w<M.globals.state.objectCount;w++)if(0!=_.get(w)){var n=p[w];(0,x.getCtx)().drawImage(n,M.globals.xoffset+(e-l)*M.globals.cellwidth,M.globals.yoffset+(t-a)*M.globals.cellheight)}E.globals.levelEditorOpened&&h()}}function h(){var e=(m.length,0),t=m.length,r=t-e;(0,x.getCtx)().drawImage(_,M.globals.xoffset-M.globals.cellwidth,M.globals.yoffset-M.globals.cellheight*(1+T)),mouseCoordY===-1-T&&-1===mouseCoordX&&(0,x.getCtx)().drawImage(w,M.globals.xoffset-M.globals.cellwidth,M.globals.yoffset-M.globals.cellheight*(1+T));for(var n=T-(-mouseCoordY-2)-1,l=mouseCoordX+(M.globals.screenwidth-1)*n,o=0;r>o;o++){var i=e+o,a=m[i],s=o%(M.globals.screenwidth-1),n=o/(M.globals.screenwidth-1)|0;(0,x.getCtx)().drawImage(a,M.globals.xoffset+s*M.globals.cellwidth,M.globals.yoffset+n*M.globals.cellheight-M.globals.cellheight*(1+T)),mouseCoordX>=0&&mouseCoordX<M.globals.screenwidth-1&&l===o&&(0,x.getCtx)().drawImage(w,M.globals.xoffset+s*M.globals.cellwidth,M.globals.yoffset+n*M.globals.cellheight-M.globals.cellheight*(1+T)),o===L&&(0,x.getCtx)().drawImage(b,M.globals.xoffset+s*M.globals.cellwidth,M.globals.yoffset+n*M.globals.cellheight-M.globals.cellheight*(1+T))}mouseCoordX>=-1&&mouseCoordY>=-1&&mouseCoordX<M.globals.screenwidth-1&&mouseCoordY<M.globals.screenheight-1-T&&(-1==mouseCoordX||-1==mouseCoordY||mouseCoordX==M.globals.screenwidth-2||mouseCoordY===M.globals.screenheight-2-T?(0,x.getCtx)().drawImage(y,M.globals.xoffset+mouseCoordX*M.globals.cellwidth,M.globals.yoffset+mouseCoordY*M.globals.cellheight):(0,x.getCtx)().drawImage(b,M.globals.xoffset+mouseCoordX*M.globals.cellwidth,M.globals.yoffset+mouseCoordY*M.globals.cellheight))}function f(){if(x.globals.canvas.width=x.globals.canvas.parentNode.clientWidth,x.globals.canvas.height=x.globals.canvas.parentNode.clientHeight,M.globals.screenwidth=E.globals.level.width,M.globals.screenheight=E.globals.level.height,void 0!==M.globals.state)if(M.globals.flickscreen=void 0!==M.globals.state.metadata.flickscreen,M.globals.zoomscreen=void 0!==M.globals.state.metadata.zoomscreen,E.globals.levelEditorOpened){M.globals.screenwidth+=2;var e=c();T=Math.ceil(e/(M.globals.screenwidth-1)),M.globals.screenheight+=2+T}else M.globals.flickscreen?(M.globals.screenwidth=M.globals.state.metadata.flickscreen[0],M.globals.screenheight=M.globals.state.metadata.flickscreen[1]):M.globals.zoomscreen&&(M.globals.screenwidth=M.globals.state.metadata.zoomscreen[0],M.globals.screenheight=M.globals.state.metadata.zoomscreen[1]);M.globals.textMode&&(M.globals.screenwidth=M.globals.titleWidth,M.globals.screenheight=M.globals.titleHeight),M.globals.cellwidth=x.globals.canvas.width/M.globals.screenwidth,M.globals.cellheight=x.globals.canvas.height/M.globals.screenheight;var t=5,r=5;M.globals.textMode&&(t=6,r=6),M.globals.cellwidth=t*~~(M.globals.cellwidth/t),M.globals.cellheight=r*~~(M.globals.cellheight/r),M.globals.xoffset=0,M.globals.yoffset=0,M.globals.cellwidth>M.globals.cellheight?(M.globals.cellwidth=M.globals.cellheight,M.globals.xoffset=(x.globals.canvas.width-M.globals.cellwidth*M.globals.screenwidth)/2,M.globals.yoffset=(x.globals.canvas.height-M.globals.cellheight*M.globals.screenheight)/2):(M.globals.cellheight=M.globals.cellwidth,M.globals.yoffset=(x.globals.canvas.height-M.globals.cellheight*M.globals.screenheight)/2,M.globals.xoffset=(x.globals.canvas.width-M.globals.cellwidth*M.globals.screenwidth)/2),M.globals.magnification=M.globals.cellwidth/t*5|0,E.globals.levelEditorOpened&&!M.globals.textMode&&(M.globals.xoffset+=M.globals.cellwidth,M.globals.yoffset+=M.globals.cellheight*(1+T)),M.globals.cellwidth=0|M.globals.cellwidth,M.globals.cellheight=0|M.globals.cellheight,M.globals.xoffset=0|M.globals.xoffset,M.globals.yoffset=0|M.globals.yoffset,(I!=M.globals.cellwidth||R!=M.globals.cellheight||O!=M.globals.textMode||A!=M.globals.state.fgcolor||x.globals.forceRegenImages)&&(x.globals.forceRegenImages=!1,i()),R=M.globals.cellheight,I=M.globals.cellwidth,O=M.globals.textMode,A=M.globals.state.fgcolor,u()}function g(e){e.addEventListener("resize",f,!1)}function d(e){e.removeEventListener("resize",f)}Object.defineProperty(t,"__esModule",{value:!0}),t.createSprite=l,t.regenText=o,t.regenSpriteImages=i,t.makeSpriteCanvas=a,t.generateGlyphImages=s,t.glyphCount=c,t.redraw=u,t.drawEditorIcons=h,t.canvasResize=f,t.addListeners=g,t.removeListeners=d;var p,v,m,b,y,_,w,x=r(2),k=r(9),C=n(k),M=r(5),S=r(6),E=r(4),L=0,T=1,I=0,R=0,O=-1,A=-1},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={a:[[0,0,0,0,0],[0,1,1,1,0],[1,0,0,1,0],[1,0,0,1,0],[0,1,1,1,0]],b:[[1,0,0,0,0],[1,0,0,0,0],[1,1,1,0,0],[1,0,0,1,0],[0,1,1,0,0]],c:[[0,0,0,0,0],[0,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[0,1,1,1,0]],d:[[0,0,0,1,0],[0,0,0,1,0],[0,1,1,1,0],[1,0,0,1,0],[0,1,1,0,0]],e:[[0,1,1,0,0],[1,0,0,1,0],[1,1,1,0,0],[1,0,0,0,0],[0,1,1,0,0]],f:[[0,0,0,0,0],[0,0,1,1,0],[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0]],g:[[0,1,1,0,0],[1,0,0,1,0],[0,1,1,1,0],[0,0,0,1,0],[0,1,1,0,0]],h:[[1,0,0,0,0],[1,0,0,0,0],[1,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0]],i:[[0,0,1,0,0],[0,0,0,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,1,1,1,0]],j:[[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0],[1,0,1,0,0],[0,1,0,0,0]],k:[[1,0,0,0,0],[1,0,0,1,0],[1,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0]],l:[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,1,0],[0,1,1,0,0]],m:[[0,0,0,0,0],[0,1,0,1,0],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1]],n:[[0,0,0,0,0],[0,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0],[1,0,0,1,0]],o:[[0,0,0,0,0],[0,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0],[0,1,1,0,0]],p:[[0,0,0,0,0],[0,1,1,0,0],[1,0,0,1,0],[1,1,1,0,0],[1,0,0,0,0]],q:[[0,0,0,0,0],[0,1,1,0,0],[1,0,0,1,0],[0,1,1,1,0],[0,0,0,1,0]],r:[[0,0,0,0,0],[0,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]],s:[[0,1,1,1,0],[1,0,0,0,0],[0,1,1,0,0],[0,0,0,1,0],[1,1,1,0,0]],t:[[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,1,0,0,1],[0,0,1,1,0]],u:[[0,0,0,0,0],[1,0,0,1,0],[1,0,0,1,0],[1,0,0,1,0],[1,1,1,0,0]],v:[[0,0,0,0,0],[1,0,0,1,0],[1,0,1,0,0],[1,1,0,0,0],[1,0,0,0,0]],w:[[0,0,0,0,0],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[0,1,0,1,0]],x:[[0,0,0,0,0],[1,0,0,1,0],[0,1,1,0,0],[0,1,1,0,0],[1,0,0,1,0]],y:[[1,0,0,1,0],[1,0,0,1,0],[0,1,1,1,0],[0,0,0,1,0],[1,1,1,0,0]],z:[[0,0,0,0,0],[1,1,1,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,1,1,1,0]],A:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1]],B:[[1,1,1,1,0],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,1],[1,1,1,1,0]],C:[[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],D:[[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0]],E:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1]],F:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0]],G:[[0,1,1,1,1],[1,0,0,0,0],[1,0,0,1,1],[1,0,0,0,1],[0,1,1,1,1]],H:[[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1]],I:[[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1]],J:[[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,1,0,0]],K:[[1,0,0,0,1],[1,0,1,1,0],[1,1,0,0,0],[1,0,1,1,0],[1,0,0,0,1]],L:[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],M:[[1,1,1,1,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1]],N:[[1,0,0,0,1],[1,1,0,0,1],[1,0,1,0,1],[1,0,0,1,1],[1,0,0,0,1]],O:[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]],P:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0]],Q:[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[0,0,0,0,1]],R:[[1,1,1,1,0],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1]],S:[[0,1,1,1,1],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[1,1,1,1,0]],T:[[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],U:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]],V:[[1,0,0,0,1],[0,1,0,1,0],[0,1,0,1,0],[0,0,1,0,0],[0,0,1,0,0]],W:[[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[0,1,0,1,0]],X:[[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1]],Y:[[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],Z:[[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,1,1,1,1]],0:[[1,1,1,1,1],[1,0,0,1,1],[1,0,1,0,1],[1,1,0,0,1],[1,1,1,1,1]],1:[[1,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1]],2:[[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1]],3:[[1,1,1,1,0],[0,0,0,0,1],[0,0,1,1,0],[0,0,0,0,1],[1,1,1,1,0]],4:[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,1,0],[1,1,1,1,1],[0,0,0,1,0]],5:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,0],[0,0,0,0,1],[1,1,1,1,0]],6:[[0,1,1,1,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,1],[0,1,1,1,0]],7:[[1,1,1,1,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0]],8:[[0,1,1,1,0],[1,0,0,0,1],[0,1,1,1,0],[1,0,0,0,1],[0,1,1,1,0]],9:[[0,1,1,1,0],[1,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[0,1,1,1,0]],".":[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0]],",":[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,1,1,0,0]],";":[[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,1,1,0,0]],":":[[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0]],"?":[[0,1,1,1,0],[1,0,0,0,1],[0,0,1,1,0],[0,0,1,0,0],[0,0,1,0,0]],"!":[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0]],"@":[[0,1,1,1,0],[1,0,0,0,1],[1,0,1,1,1],[1,0,0,0,0],[0,1,1,1,0]],"":[[0,1,1,1,0],[0,1,0,0,1],[1,1,1,0,0],[0,1,0,0,0],[1,1,1,1,1]],$:[[0,1,1,1,1],[1,0,1,0,0],[0,1,1,1,0],[0,0,1,0,1],[1,1,1,1,0]],"%":[[1,1,0,0,1],[1,1,0,1,0],[0,0,1,0,0],[0,1,0,1,1],[1,0,0,1,1]],"^":[[0,0,1,0,0],[0,1,0,1,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],"&":[[0,1,1,0,0],[1,0,0,0,0],[0,1,0,1,1],[1,0,0,1,0],[0,1,1,0,0]],"*":[[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[0,0,0,0,0],[0,0,0,0,0]],"(":[[0,0,0,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,1,0]],")":[[0,1,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,0,0,0]],"+":[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],"-":[[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0]],_:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1]],"=":[[0,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0]]," ":[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],"{":[[0,0,1,1,0],[0,0,1,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,1,0]],"}":[[0,1,1,0,0],[0,0,1,0,0],[0,0,1,1,0],[0,0,1,0,0],[0,1,1,0,0]],"[":[[0,0,1,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,1,0]],"]":[[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,1,0,0]],"'":[[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],'"':[[0,1,0,1,0],[0,1,0,1,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],"/":[[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,0,0,0,0]],"\\":[[1,0,0,0,0],[0,1,0,0,0],[0,0,1,0,0],[0,0,0,1,0],[0,0,0,0,1]],"|":[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],"<":[[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[0,0,1,0,0],[0,0,0,1,0]],">":[[0,1,0,0,0],[0,0,1,0,0],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0]],"~":[[0,0,0,0,0],[0,1,0,0,0],[1,0,1,0,1],[0,0,0,1,0],[0,0,0,0,0]],"`":[[0,1,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],"#":[[0,1,0,1,0],[1,1,1,1,1],[0,1,0,1,0],[1,1,1,1,1],[0,1,0,1,0]]};t["default"]=r,e.exports=t["default"]},function(e,t,r){function n(e){return e&&e.__esModule?e:{"default":e}}function l(e,t,r){if(g[0]||r){if(void 0===t)return a(e);var n='<a onclick="jumpToLine('+t.toString()+');"  href="javascript:void(0);"><span class="errorTextLineNumber"> line '+t.toString()+'</span></a> : <span class="errorText">'+e+"</span>";d.indexOf(n)>=0&&!r||((0,f.consolePrint)(n),d.push(n),p[0]++)}}function o(e,t,r){if(g[0]||r){if(void 0===t)return a(e);var n='<a onclick="jumpToLine('+t.toString()+');"  href="javascript:void(0);"><span class="errorTextLineNumber"> line '+t.toString()+'</span></a> : <span class="errorText">'+e+"</span>";d.indexOf(n)>=0&&!r||((0,f.consolePrint)(n,!0),d.push(n),p[0]++)}}function i(e,t,r){if(g[0]||r){if(void 0===t)return a(e);var n='<a onclick="jumpToLine('+t.toString()+');"  href="javascript:void(0);"><span class="errorTextLineNumber"> line '+t.toString()+'</span></a> : <span class="warningText">'+e+"</span>";d.indexOf(n)>=0&&!r||((0,f.consolePrint)(n,!0),d.push(n))}}function a(e,t){if(g[0]||t){var r='<span class="errorText">'+e+"</span>";d.indexOf(r)>=0&&!t||((0,f.consolePrint)(r,!0),d.push(r)),p[0]++}}function s(e,t){if(g[0]||t){var r='<span class="betaText">'+e+"</span>";d.indexOf(r)>=0&&!t||(consoleError(r),d.push(r))}}function c(e){"levels"===e.section?e.levels[e.levels.length-1].length>0&&e.levels.push([]):"objects"===e.section&&(e.objects_section=0)}Object.defineProperty(t,"__esModule",{value:!0}),t.logErrorCacheable=l,t.logError=o,t.logWarning=i,t.logErrorNoLine=a,t.logBetaMessage=s,t.blankLineHandle=c;var u=r(11),h=(n(u),r(12)),f=r(3),g=(r(4),[!1]);t.compiling=g;var d=[];t.errorStrings=d;var p=[0];t.errorCount=p;var v=function(){"use strict";function e(e,t){if(void 0!==e.objects[t])return o('Object "'+t.toUpperCase()+'" defined multiple times.',e.lineNumber),"ERROR";for(var r=0;r<e.legend_synonyms.length;r++){var n=e.legend_synonyms[r];n[0]==t&&o('Name "'+t.toUpperCase()+'" already in use.',e.lineNumber)}for(var r=0;r<e.legend_aggregates.length;r++){var n=e.legend_aggregates[r];n[0]==t&&o('Name "'+t.toUpperCase()+'" already in use.',e.lineNumber)}for(var r=0;r<e.legend_properties.length;r++){var n=e.legend_properties[r];n[0]==t&&o('Name "'+t.toUpperCase()+'" already in use.',e.lineNumber)}}var t=["objects","legend","sounds","collisionlayers","rules","winconditions","levels"],r=["sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10","cancel","checkpoint","restart","win","message","again"],n=/[\w]+\s*/,l=/\d+\b/,a=/(objects|collisionlayers|legend|sounds|rules|winconditions|levels)\s*/,s=/[\=]+/,u=/[^\(]+/,f=/[ \,]*/,g=/(move|action|create|destroy|cantmove|undo|restart|titlescreen|startgame|endgame|startlevel|endlevel|showmessage|closemessage|sfx0|sfx1|sfx2|sfx3|sfx4|sfx5|sfx6|sfx7|sfx8|sfx9|sfx10)\s+/,d=/^(action|up|down|left|right|\^|v|\<|\>|forward|moving|stationary|parallel|perpendicular|horizontal|orthogonal|vertical|no|randomdir|random)$/,p=/^(startloop|endloop)$/,v=/^(up|down|left|right|horizontal|vertical|orthogonal|late|rigid)$/,m=/\s*(up|down|left|right|horizontal|vertical|orthogonal)\s*/,b=/^(all|any|no|some)$/,y=["objects","collisionlayers","legend","sounds","rules","...","winconditions","levels","up","down","left","right","late","rigid","^","v",">","<","no","randomdir","random","horizontal","vertical","any","all","no","some","moving","stationary","parallel","perpendicular","action","message"];return{copyState:function(e){var t={};for(var r in e.objects)if(e.objects.hasOwnProperty(r)){var n=e.objects[r];t[r]={colors:n.colors.concat([]),lineNumber:n.lineNumber,spritematrix:n.spritematrix.concat([])}}for(var l=[],r=0;r<e.collisionLayers.length;r++)l.push(e.collisionLayers[r].concat([]));for(var o=[],i=[],a=[],s=[],c=[],u=[],r=0;r<e.legend_synonyms.length;r++)o.push(e.legend_synonyms[r].concat([]));for(var r=0;r<e.legend_aggregates.length;r++)i.push(e.legend_aggregates[r].concat([]));for(var r=0;r<e.legend_properties.length;r++)a.push(e.legend_properties[r].concat([]));for(var r=0;r<e.sounds.length;r++)s.push(e.sounds[r].concat([]));for(var r=0;r<e.levels.length;r++)c.push(e.levels[r].concat([]));for(var r=0;r<e.winconditions.length;r++)u.push(e.winconditions[r].concat([]));var h={lineNumber:e.lineNumber,objects:t,collisionLayers:l,commentLevel:e.commentLevel,section:e.section,visitedSections:e.visitedSections.concat([]),objects_candname:e.objects_candname,objects_section:e.objects_section,objects_spritematrix:e.objects_spritematrix.concat([]),tokenIndex:e.tokenIndex,legend_synonyms:o,legend_aggregates:i,legend_properties:a,sounds:s,rules:e.rules.concat([]),names:e.names.concat([]),winconditions:u,abbrevNames:e.abbrevNames.concat([]),metadata:e.metadata.concat([]),levels:c,STRIDE_OBJ:e.STRIDE_OBJ,STRIDE_MOV:e.STRIDE_MOV};return h},blankLine:function(e){"levels"===e.section&&e.levels[e.levels.length-1].length>0&&e.levels.push([])},token:function _(w,x){var k=w.string,C=w.sol();C&&(w.string=w.string.toLowerCase(),x.tokenIndex=0),w.eatWhile(/[ \t]/);var M=w.peek();if("("===M&&-4!==x.tokenIndex)w.next(),x.commentLevel++;else if(")"===M&&(w.next(),x.commentLevel>0&&(x.commentLevel--,0===x.commentLevel)))return"comment";if(x.commentLevel>0){for(;;){if(w.eatWhile(/[^\(\)]+/),w.eol())break;if(M=w.peek(),"("===M?x.commentLevel++:")"===M&&x.commentLevel--,w.next(),0===x.commentLevel)break}return"comment"}if(w.eatWhile(/[ \t]/),C&&w.eol())return c(x);if(C&&w.match(s,!0))return"EQUALSBIT";if(w.match(a,!0)){x.section=w.string.slice(0,w.pos).trim(),x.visitedSections.indexOf(x.section)>=0&&o('cannot duplicate sections (you tried to duplicate "'+x.section.toUpperCase()+'").',x.lineNumber),x.visitedSections.push(x.section);var S=t.indexOf(x.section);if(0==S?(x.objects_section=0,x.visitedSections.length>1&&o('section "'+x.section.toUpperCase()+'" must be the first section',x.lineNumber)):-1==x.visitedSections.indexOf(t[S-1])&&(-1===S?o('no such section as "'+x.section.toUpperCase()+'".',x.lineNumber):o('section "'+x.section.toUpperCase()+'" is out of order, must follow  "'+t[S-1].toUpperCase()+'".',x.lineNumber)),"sounds"===x.section){for(var E in x.objects)x.objects.hasOwnProperty(E)&&x.names.push(E);for(var L=0;L<x.legend_synonyms.length;L++){var E=x.legend_synonyms[L][0];x.names.push(E)}for(var L=0;L<x.legend_aggregates.length;L++){var E=x.legend_aggregates[L][0];x.names.push(E)}for(var L=0;L<x.legend_properties.length;L++){var E=x.legend_properties[L][0];x.names.push(E)}}else if("levels"===x.section){for(var E in x.objects)x.objects.hasOwnProperty(E)&&1==E.length&&x.abbrevNames.push(E);for(var L=0;L<x.legend_synonyms.length;L++)1==x.legend_synonyms[L][0].length&&x.abbrevNames.push(x.legend_synonyms[L][0]);for(var L=0;L<x.legend_aggregates.length;L++)1==x.legend_aggregates[L][0].length&&x.abbrevNames.push(x.legend_aggregates[L][0])}return"HEADER"}if(void 0===x.section&&o('must start with section "OBJECTS"',x.lineNumber),w.eol())return null;switch(x.section){case"objects":var T=function(){var e=C?w.match(n,!0):w.match(/[^\s\()]+\s*/,!0);if(null==e)return w.match(u,!0),"ERROR";var t=e[0].trim();if(void 0!==x.objects[t])return o('Object "'+t.toUpperCase()+'" defined multiple times.',x.lineNumber),"ERROR";for(var r=0;r<x.legend_synonyms.length;r++){var l=x.legend_synonyms[r];l[0]==t&&o('Name "'+t.toUpperCase()+'" already in use.',x.lineNumber)}if(y.indexOf(t)>=0&&i('You named an object "'+t.toUpperCase()+"\", but this is a keyword. Don't do that!",x.lineNumber),C)x.objects_candname=t,x.objects[x.objects_candname]={lineNumber:x.lineNumber,colors:[],spritematrix:[]};else{var a=[t,x.objects_candname];a.lineNumber=x.lineNumber,x.legend_synonyms.push(a)}return x.objects_section=1,"NAME"};switch(C&&2==x.objects_section&&(x.objects_section=3),C&&1==x.objects_section&&(x.objects_section=2),x.objects_section){case 0:case 1:return x.objects_spritematrix=[],T();case 2:x.tokenIndex=0;var I=w.match(h.reg_color,!0);if(null==I){var R=w.match(n,!0)||w.match(u,!0);return o("Was looking for color for object "+x.objects_candname.toUpperCase()+', got "'+R+'" instead.',x.lineNumber),null}void 0===x.objects[x.objects_candname].colors?x.objects[x.objects_candname].colors=[I[0].trim()]:x.objects[x.objects_candname].colors.push(I[0].trim());var O=I[0].trim().toLowerCase();return O in h.colorPalettes.arnecolors?"COLOR COLOR-"+O.toUpperCase():"transparent"===O?"COLOR FADECOLOR":"COLOR";case 3:var M=w.eat(/[.\d]/),A=x.objects_spritematrix;if(void 0===M)return 0===A.length?T():(o("Unknown junk in spritematrix for object "+x.objects_candname.toUpperCase()+".",x.lineNumber),w.match(u,!0),null);C&&A.push("");var D=x.objects[x.objects_candname];if(A[A.length-1]+=M,5===A.length&&5==A[A.length-1].length&&(D.spritematrix=x.objects_spritematrix,x.objects_section=0),"."!==M){var E=parseInt(M);return E>=D.colors.length?(o("trying to access color number "+E+" from the color palette of sprite "+x.objects_candname.toUpperCase()+", but there are only "+D.colors.length+" defined in it.",x.lineNumber),"ERROR"):isNaN(E)?(o('invalid character "'+M+'" in sprite for '+x.objects_candname.toUpperCase(),x.lineNumber),"ERROR"):"COLOR BOLDCOLOR COLOR-"+D.colors[E].toUpperCase()}return"COLOR FADECOLOR";default:window.console.logError("EEK shouldn't get here.")}break;case"sounds":if(C){var N=!0,B=u.exec(w.string)[0].split(/\s/).filter(function(e){return""!==e});B.push(x.lineNumber),x.sounds.push(B)}if(H=w.match(g,!0),null!==H)return"SOUNDVERB";if(H=w.match(m,!0),null!==H)return"DIRECTION";if(H=w.match(l,!0),null!==H)return x.tokenIndex++,"SOUND";if(H=w.match(/[^\[\|\]\s]*/,!0),null!==H){var P=H[0].trim();if(x.names.indexOf(P)>=0)return"NAME"}return H=w.match(u,!0),o('unexpected sound token "'+H+'".',x.lineNumber),w.match(u,!0),"ERROR";case"collisionlayers":C&&(x.collisionLayers.push([]),x.tokenIndex=0);var F=w.match(n,!0);if(null===F){var j=w.pos;return w.match(f,!0),w.pos==j&&(o("error detected - unexpected character "+w.peek(),x.lineNumber),w.next()),null}var H=F[0].trim(),W=function le(e){if(e=e.toLowerCase(),e in x.objects)return[e];for(var t=0;t<x.legend_synonyms.length;t++){var r=x.legend_synonyms[t];if(r[0]===e)return[r[1]]}for(var t=0;t<x.legend_aggregates.length;t++){var r=x.legend_aggregates[t];if(r[0]===e)return o('"'+e+'" is an aggregate (defined using "and"), and cannot be added to a single layer because its constituent objects must be able to coexist.',x.lineNumber),[]}for(var t=0;t<x.legend_properties.length;t++){var r=x.legend_properties[t];if(r[0]===e){var n=[].concat.apply([],r.slice(1).map(le));return n}}return o('Cannot add "'+H.toUpperCase()+'" to a collision layer; it has not been declared.',x.lineNumber),[]};"background"===H?(x.collisionLayers.length>0&&x.collisionLayers[x.collisionLayers.length-1].length>0&&o("Background must be in a layer by itself.",x.lineNumber),x.tokenIndex=1):0!==x.tokenIndex&&o("Background must be in a layer by itself.",x.lineNumber);var z=W(H);return 0===x.collisionLayers.length?(o("no layers found.",x.lineNumber),"ERROR"):(x.collisionLayers[x.collisionLayers.length-1]=x.collisionLayers[x.collisionLayers.length-1].concat(z),z.length>0?"NAME":"ERROR");case"legend":if(C){var q=w.string.replace("="," = ");q=u.exec(q)[0];var B=q.split(/\s/).filter(function(e){return""!==e}),N=!0;if(B.length>0){var H=B[0].toLowerCase();y.indexOf(H)>=0&&i('You named an object "'+H.toUpperCase()+"\", but this is a keyword. Don't do that!",x.lineNumber),B.indexOf(H,2)>=2&&o("You can't define object "+H.toUpperCase()+" in terms of itself!",x.lineNumber),e(x,H)}if(B.length<3)N=!1;else if("="!==B[1])N=!1;else if(3===B.length){var G=[B[0],B[2].toLowerCase()];G.lineNumber=x.lineNumber,x.legend_synonyms.push(G)}else if(B.length%2===0)N=!1;else{var V=B[3].toLowerCase();if("and"===V){for(var W=(function oe(e){if(e=e.toLowerCase(),e in x.objects)return[e];for(var t=0;t<x.legend_synonyms.length;t++){var r=x.legend_synonyms[t];if(r[0]===e)return[1]}for(var t=0;t<x.legend_aggregates.length;t++){var r=x.legend_aggregates[t];if(r[0]===e)return[].concat.apply([],r.slice(1).map(oe))}for(var t=0;t<x.legend_properties.length;t++){var r=x.legend_properties[t];if(r[0]===e)return o("Cannot define an aggregate (using 'and') in terms of properties (something that uses 'or').",x.lineNumber),N=!1,[e]}return[e]}),L=5;L<B.length;L+=2)if("and"!==B[L].toLowerCase()){N=!1;break}if(N){for(var U=[B[0]].concat(W(B[2])).concat(W(B[4])),L=6;L<B.length;L+=2)U=U.concat(W(B[L]));U.lineNumber=x.lineNumber,x.legend_aggregates.push(U)}}else if("or"===V){for(var W=(function ie(e){if(e=e.toLowerCase(),e in x.objects)return[e];for(var t=0;t<x.legend_synonyms.length;t++){var r=x.legend_synonyms[t];if(r[0]===e)return[1]}for(var t=0;t<x.legend_aggregates.length;t++){var r=x.legend_aggregates[t];r[0]===e&&(o("Cannot define a property (using 'or') in terms of aggregates (something that uses 'and').",x.lineNumber),N=!1)}for(var t=0;t<x.legend_properties.length;t++){var r=x.legend_properties[t];if(r[0]===e)return[].concat.apply([],r.slice(1).map(ie))}return[e]}),L=5;L<B.length;L+=2)if("or"!==B[L].toLowerCase()){N=!1;break}if(N){for(var U=[B[0],B[2].toLowerCase(),B[4].toLowerCase()],L=6;L<B.length;L+=2)U.push(B[L].toLowerCase());U.lineNumber=x.lineNumber,x.legend_properties.push(U)}}else N=!1}if(N===!1)return o("incorrect format of legend - should be one of A = B, A = B or C ( or D ...), A = B and C (and D ...)",x.lineNumber),w.match(u,!0),"ERROR";x.tokenIndex=0}if(0===x.tokenIndex)return w.match(/[^=]*/,!0),x.tokenIndex++,"NAME";if(1===x.tokenIndex)return w.next(),w.match(/\s*/,!0),x.tokenIndex++,"ASSSIGNMENT";var F=w.match(n,!0);if(null===F)return o("Something bad's happening in the LEGEND",x.lineNumber),w.match(u,!0),"ERROR";var H=F[0].trim();if(x.tokenIndex%2===0){var J=function(e){if(e=e.toLowerCase(),e in x.objects)return!0;for(var t=0;t<x.legend_aggregates.length;t++){var r=x.legend_aggregates[t];if(r[0]===e)return!0}for(var t=0;t<x.legend_properties.length;t++){var r=x.legend_properties[t];if(r[0]===e)return!0}for(var t=0;t<x.legend_synonyms.length;t++){var r=x.legend_synonyms[t];if(r[0]===e)return!0}return!1};return J(H)===!1?(o('Cannot reference "'+H.toUpperCase()+'" in the LEGEND section; it has not been defined yet.',x.lineNumber),x.tokenIndex++,"ERROR"):(x.tokenIndex++,"NAME")}return x.tokenIndex++,"LOGICWORD";case"rules":if(C){var Y=u.exec(w.string)[0];x.rules.push([Y,x.lineNumber,k]),x.tokenIndex=0}if(-4===x.tokenIndex)return w.skipToEnd(),"MESSAGE";if(w.match(/\s*\-\>\s*/,!0))return"ARROW";if("["===M||"|"===M||"]"===M||"+"===M)return"+"!==M&&(x.tokenIndex=1),w.next(),w.match(/\s*/,!0),"BRACKET";var P=w.match(/[^\[\|\]\s]*/,!0)[0].trim();return 0===x.tokenIndex&&p.exec(P)?"BRACKET":0===x.tokenIndex&&v.exec(P)?(w.match(/\s*/,!0),"DIRECTION"):1===x.tokenIndex&&d.exec(P)?(w.match(/\s*/,!0),"DIRECTION"):x.names.indexOf(P)>=0?C?(o("Identifiers cannot appear outside of square brackes in rules, only directions can.",x.lineNumber),
"ERROR"):(w.match(/\s*/,!0),"NAME"):"..."===P?"DIRECTION":"rigid"===P?"DIRECTION":"random"===P?"DIRECTION":r.indexOf(P)>=0?("message"===P&&(x.tokenIndex=-4),"COMMAND"):(o('Name "'+P+'", referred to in a rule, does not exist.',x.lineNumber),"ERROR");case"winconditions":if(C){var K=u.exec(w.string),X=K[0].split(/\s/),Q=X.filter(function(e){return""!==e});Q.push(x.lineNumber),x.winconditions.push(Q),x.tokenIndex=-1}x.tokenIndex++;var $=w.match(/\s*\w+\s*/);if(null===$)return o("incorrect format of win condition.",x.lineNumber),w.match(u,!0),"ERROR";var Z=$[0].trim();if(0===x.tokenIndex)return b.exec(Z)?"LOGICWORD":"ERROR";if(2===x.tokenIndex)return"on"!=Z?"ERROR":"LOGICWORD";if(1===x.tokenIndex||3===x.tokenIndex)return-1===x.names.indexOf(Z)?(o('Error in win condition: "'+Z.toUpperCase()+'" is not a valid object name.',x.lineNumber),"ERROR"):"NAME";break;case"levels":if(C){if(w.match(/\s*message\s*/,!0)){x.tokenIndex=1;var ee=["\n",k.slice(w.pos).trim()];return 0==x.levels[x.levels.length-1].length?x.levels.splice(x.levels.length-1,0,ee):x.levels.push(ee),"MESSAGE_VERB"}var te=w.match(u,!1)[0].trim();x.tokenIndex=2;var re=x.levels[x.levels.length-1];"\n"==re[0]?x.levels.push([x.lineNumber,te]):(0==re.length&&re.push(x.lineNumber),re.push(te))}else if(1==x.tokenIndex)return w.skipToEnd(),"MESSAGE";if(2===x.tokenIndex&&!w.eol()){var M=w.peek();return w.next(),x.abbrevNames.indexOf(M)>=0?"LEVEL":(o('Key "'+M.toUpperCase()+'" not found. Do you need to add it to the legend, or define a new object?',x.lineNumber),"ERROR")}break;default:if(C&&(x.tokenIndex=0),0!=x.tokenIndex)return w.match(u,!0),"METADATATEXT";var $=w.match(/\s*\w+\s*/);if(null!==$){var _=$[0].trim();if(C){if(["title","author","homepage","background_color","text_color","key_repeat_interval","realtime_interval","again_interval","flickscreen","zoomscreen","color_palette","youtube"].indexOf(_)>=0){("youtube"===_||"author"===_||"title"===_)&&(w.string=k);var ne=w.match(u,!1);return null!=ne?(x.metadata.push(_),x.metadata.push(ne[0].trim())):o('MetaData "'+_+'" needs a value.',x.lineNumber),x.tokenIndex=1,"METADATA"}return["run_rules_on_level_start","norepeat_action","require_player_movement","debug","verbose_logging","throttle_movement","noundo","noaction","norestart","scanline"].indexOf(_)>=0?(x.metadata.push(_),x.metadata.push("true"),x.tokenIndex=-1,"METADATA"):(o("Unrecognised stuff in metadata section.",x.lineNumber),"ERROR")}return-1==x.tokenIndex?(o('MetaData "'+_+'" has no parameters.',x.lineNumber),"ERROR"):"METADATA"}}return w.eol()?null:w.eol()?void 0:(w.next(),null)},startState:function(){return{objects:{},lineNumber:0,commentLevel:0,section:"",visitedSections:[],objects_candname:"",objects_section:0,objects_spritematrix:[],collisionLayers:[],tokenIndex:0,legend_synonyms:[],legend_aggregates:[],legend_properties:[],sounds:[],rules:[],names:[],winconditions:[],metadata:[],abbrevNames:[],levels:[[]],subsection:""}}}};t.codeMirrorFn=v},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){"use strict";function e(r,n){if(!(this instanceof e))return new e(r,n);this.options=n=n||{};for(var l in ro)n.hasOwnProperty(l)||(n[l]=ro[l]);g(n);var o=n.value;"string"==typeof o&&(o=new Eo(o,n.mode)),this.doc=o;var i=this.display=new t(r,o);i.wrapper.CodeMirror=this,u(this),s(this),n.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),n.autofocus&&!Dl&&ht(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new Hn},bl&&setTimeout(Yn(ut,this,!0),20),dt(this);var a=this;Ye(this,function(){a.curOp.forceUpdate=!0,sn(a,o),n.autofocus&&!Dl||tl()==i.input?setTimeout(Yn(Nt,a),20):Bt(a);for(var e in no)no.hasOwnProperty(e)&&no[e](a,n[e],lo);for(var t=0;t<so.length;++t)so[t](a)})}function t(e,t){var r=this,n=r.input=Qn("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none");Cl?n.style.width="1000px":n.setAttribute("wrap","off"),Al&&(n.style.border="1px solid black"),n.setAttribute("autocorrect","off"),n.setAttribute("autocapitalize","off"),n.setAttribute("spellcheck","false"),r.inputDiv=Qn("div",[n],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),r.scrollbarH=Qn("div",[Qn("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar"),r.scrollbarV=Qn("div",[Qn("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),r.scrollbarFiller=Qn("div",null,"CodeMirror-scrollbar-filler"),r.gutterFiller=Qn("div",null,"CodeMirror-gutter-filler"),r.lineDiv=Qn("div",null,"CodeMirror-code"),r.selectionDiv=Qn("div",null,null,"position: relative; z-index: 1"),r.cursorDiv=Qn("div",null,"CodeMirror-cursors"),r.measure=Qn("div",null,"CodeMirror-measure"),r.lineMeasure=Qn("div",null,"CodeMirror-measure"),r.lineSpace=Qn("div",[r.measure,r.lineMeasure,r.selectionDiv,r.cursorDiv,r.lineDiv],null,"position: relative; outline: none"),r.mover=Qn("div",[Qn("div",[r.lineSpace],"CodeMirror-lines")],null,"position: relative"),r.sizer=Qn("div",[r.mover],"CodeMirror-sizer"),r.heightForcer=Qn("div",null,null,"position: absolute; height: "+Fo+"px; width: 1px;"),r.gutters=Qn("div",null,"CodeMirror-gutters"),r.lineGutter=null,r.scroller=Qn("div",[r.sizer,r.heightForcer,r.gutters],"CodeMirror-scroll"),r.scroller.setAttribute("tabIndex","-1"),r.wrapper=Qn("div",[r.inputDiv,r.scrollbarH,r.scrollbarV,r.scrollbarFiller,r.gutterFiller,r.scroller],"CodeMirror"),yl&&(r.gutters.style.zIndex=-1,r.scroller.style.paddingRight=0),Al&&(n.style.width="0px"),Cl||(r.scroller.draggable=!0),Tl&&(r.inputDiv.style.height="1px",r.inputDiv.style.position="absolute"),yl&&(r.scrollbarH.style.minHeight=r.scrollbarV.style.minWidth="18px"),e.appendChild?e.appendChild(r.wrapper):e(r.wrapper),r.viewFrom=r.viewTo=t.first,r.view=[],r.externalMeasured=null,r.viewOffset=0,r.lastSizeC=0,r.updateLineNumbers=null,r.lineNumWidth=r.lineNumInnerWidth=r.lineNumChars=null,r.prevInput="",r.alignWidgets=!1,r.pollingFast=!1,r.poll=new Hn,r.cachedCharWidth=r.cachedTextHeight=r.cachedPaddingH=null,r.inaccurateSelection=!1,r.maxLine=null,r.maxLineLength=0,r.maxLineChanged=!1,r.wheelDX=r.wheelDY=r.wheelStartX=r.wheelStartY=null,r.shift=!1}function r(t){t.doc.mode=e.getMode(t.options,t.doc.modeOption),n(t)}function n(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.frontier=e.doc.first,ve(e,100),e.state.modeGen++,e.curOp&&et(e)}function l(e){e.options.lineWrapping?(e.display.wrapper.className+=" CodeMirror-wrap",e.display.sizer.style.minWidth=""):(e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-wrap",""),f(e)),i(e),et(e),Ae(e),setTimeout(function(){p(e)},100)}function o(e){var t=Ge(e.display),r=e.options.lineWrapping,n=r&&Math.max(5,e.display.scroller.clientWidth/Ve(e.display)-3);return function(l){if(Pr(e.doc,l))return 0;var o=0;if(l.widgets)for(var i=0;i<l.widgets.length;i++)l.widgets[i].height&&(o+=l.widgets[i].height);return r?o+(Math.ceil(l.text.length/n)||1)*t:o+t}}function i(e){var t=e.doc,r=o(e);t.iter(function(e){var t=r(e);t!=e.height&&fn(e,t)})}function a(e){var t=go[e.options.keyMap],r=t.style;e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(r?" cm-keymap-"+r:"")}function s(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Ae(e)}function c(e){u(e),et(e),setTimeout(function(){m(e)},20)}function u(e){var t=e.display.gutters,r=e.options.gutters;$n(t);for(var n=0;n<r.length;++n){var l=r[n],o=t.appendChild(Qn("div",null,"CodeMirror-gutter "+l));"CodeMirror-linenumbers"==l&&(e.display.lineGutter=o,o.style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=n?"":"none";var i=t.offsetWidth;e.display.sizer.style.marginLeft=i+"px",n&&(e.display.scrollbarH.style.left=e.options.fixedGutter?i+"px":0)}function h(e){if(0==e.height)return 0;for(var t,r=e.text.length,n=e;t=Ir(n);){var l=t.find(0,!0);n=l.from.line,r+=l.from.ch-l.to.ch}for(n=e;t=Rr(n);){var l=t.find(0,!0);r-=n.text.length-l.from.ch,n=l.to.line,r+=n.text.length-l.to.ch}return r}function f(e){var t=e.display,r=e.doc;t.maxLine=cn(r,r.first),t.maxLineLength=h(t.maxLine),t.maxLineChanged=!0,r.iter(function(e){var r=h(e);r>t.maxLineLength&&(t.maxLineLength=r,t.maxLine=e)})}function g(e){var t=Gn(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function d(e){var t=e.display.scroller;return{clientHeight:t.clientHeight,barHeight:e.display.scrollbarV.clientHeight,scrollWidth:t.scrollWidth,clientWidth:t.clientWidth,barWidth:e.display.scrollbarH.clientWidth,docHeight:Math.round(e.doc.height+we(e.display))}}function p(e,t){t||(t=d(e));var r=e.display,n=t.docHeight+Fo,l=t.scrollWidth>t.clientWidth,o=n>t.clientHeight;if(o?(r.scrollbarV.style.display="block",r.scrollbarV.style.bottom=l?rl(r.measure)+"px":"0",r.scrollbarV.firstChild.style.height=Math.max(0,n-t.clientHeight+(t.barHeight||r.scrollbarV.clientHeight))+"px"):(r.scrollbarV.style.display="",r.scrollbarV.firstChild.style.height="0"),l?(r.scrollbarH.style.display="block",r.scrollbarH.style.right=o?rl(r.measure)+"px":"0",r.scrollbarH.firstChild.style.width=t.scrollWidth-t.clientWidth+(t.barWidth||r.scrollbarH.clientWidth)+"px"):(r.scrollbarH.style.display="",r.scrollbarH.firstChild.style.width="0"),l&&o?(r.scrollbarFiller.style.display="block",r.scrollbarFiller.style.height=r.scrollbarFiller.style.width=rl(r.measure)+"px"):r.scrollbarFiller.style.display="",l&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(r.gutterFiller.style.display="block",r.gutterFiller.style.height=rl(r.measure)+"px",r.gutterFiller.style.width=r.gutters.offsetWidth+"px"):r.gutterFiller.style.display="",Il&&0===rl(r.measure)){r.scrollbarV.style.minWidth=r.scrollbarH.style.minHeight=Rl?"18px":"12px";var i=function(t){An(t)!=r.scrollbarV&&An(t)!=r.scrollbarH&&Ke(e,mt)(t)};Do(r.scrollbarV,"mousedown",i),Do(r.scrollbarH,"mousedown",i)}}function v(e,t,r){var n=r&&null!=r.top?r.top:e.scroller.scrollTop;n=Math.floor(n-_e(e));var l=r&&null!=r.bottom?r.bottom:n+e.wrapper.clientHeight,o=dn(t,n),i=dn(t,l);if(r&&r.ensure){var a=r.ensure.from.line,s=r.ensure.to.line;if(o>a)return{from:a,to:dn(t,pn(cn(t,a))+e.wrapper.clientHeight)};if(Math.min(s,t.lastLine())>=i)return{from:dn(t,pn(cn(t,s))-e.wrapper.clientHeight),to:s}}return{from:o,to:i}}function m(e){var t=e.display,r=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var n=_(t)-t.scroller.scrollLeft+e.doc.scrollLeft,l=t.gutters.offsetWidth,o=n+"px",i=0;i<r.length;i++)if(!r[i].hidden){e.options.fixedGutter&&r[i].gutter&&(r[i].gutter.style.left=o);var a=r[i].alignable;if(a)for(var s=0;s<a.length;s++)a[s].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+l+"px")}}function b(e){if(!e.options.lineNumbers)return!1;var t=e.doc,r=y(e.options,t.first+t.size-1),n=e.display;if(r.length!=n.lineNumChars){var l=n.measure.appendChild(Qn("div",[Qn("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=l.firstChild.offsetWidth,i=l.offsetWidth-o;n.lineGutter.style.width="",n.lineNumInnerWidth=Math.max(o,n.lineGutter.offsetWidth-i),n.lineNumWidth=n.lineNumInnerWidth+i,n.lineNumChars=n.lineNumInnerWidth?r.length:-1,n.lineGutter.style.width=n.lineNumWidth+"px";var a=n.gutters.offsetWidth;return n.scrollbarH.style.left=e.options.fixedGutter?a+"px":0,n.sizer.style.marginLeft=a+"px",!0}return!1}function y(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function _(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function w(e,t,r){for(var n,l=e.display.viewFrom,o=e.display.viewTo,i=v(e.display,e.doc,t),a=!0;;a=!1){var s=e.display.scroller.clientWidth;if(!x(e,i,r))break;n=!0,e.display.maxLineChanged&&!e.options.lineWrapping&&k(e);var c=d(e);if(fe(e),C(e,c),p(e,c),a&&e.options.lineWrapping&&s!=e.display.scroller.clientWidth)r=!0;else if(r=!1,t&&null!=t.top&&(t={top:Math.min(c.docHeight-Fo-c.clientHeight,t.top)}),i=v(e.display,e.doc,t),i.from>=e.display.viewFrom&&i.to<=e.display.viewTo)break}return e.display.updateLineNumbers=null,n&&(Nn(e,"update",e),(e.display.viewFrom!=l||e.display.viewTo!=o)&&Nn(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo)),n}function x(e,t,r){var n=e.display,l=e.doc;if(!n.wrapper.offsetWidth)return void rt(e);if(!(!r&&t.from>=n.viewFrom&&t.to<=n.viewTo&&0==it(e))){b(e)&&rt(e);var o=E(e),i=l.first+l.size,a=Math.max(t.from-e.options.viewportMargin,l.first),s=Math.min(i,t.to+e.options.viewportMargin);n.viewFrom<a&&a-n.viewFrom<20&&(a=Math.max(l.first,n.viewFrom)),n.viewTo>s&&n.viewTo-s<20&&(s=Math.min(i,n.viewTo)),Wl&&(a=Nr(e.doc,a),s=Br(e.doc,s));var c=a!=n.viewFrom||s!=n.viewTo||n.lastSizeC!=n.wrapper.clientHeight;ot(e,a,s),n.viewOffset=pn(cn(e.doc,n.viewFrom)),e.display.mover.style.top=n.viewOffset+"px";var u=it(e);if(c||0!=u||r){var h=tl();return u>4&&(n.lineDiv.style.display="none"),L(e,n.updateLineNumbers,o),u>4&&(n.lineDiv.style.display=""),h&&tl()!=h&&h.offsetHeight&&h.focus(),$n(n.cursorDiv),$n(n.selectionDiv),c&&(n.lastSizeC=n.wrapper.clientHeight,ve(e,400)),M(e),!0}}}function k(e){var t=e.display,r=Se(e,t.maxLine,t.maxLine.text.length).left;t.maxLineChanged=!1;var n=Math.max(0,r+3),l=Math.max(0,t.sizer.offsetLeft+n+Fo-t.scroller.clientWidth);t.sizer.style.minWidth=n+"px",l<e.doc.scrollLeft&&St(e,Math.min(t.scroller.scrollLeft,l),!0)}function C(e,t){e.display.sizer.style.minHeight=e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=Math.max(t.docHeight,t.clientHeight-Fo)+"px"}function M(e){for(var t=e.display,r=t.lineDiv.offsetTop,n=0;n<t.view.length;n++){var l,o=t.view[n];if(!o.hidden){if(yl){var i=o.node.offsetTop+o.node.offsetHeight;l=i-r,r=i}else{var a=o.node.getBoundingClientRect();l=a.bottom-a.top}var s=o.line.height-l;if(2>l&&(l=Ge(t)),(s>.001||-.001>s)&&(fn(o.line,l),S(o.line),o.rest))for(var c=0;c<o.rest.length;c++)S(o.rest[c])}}}function S(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.offsetHeight}function E(e){for(var t=e.display,r={},n={},l=t.gutters.firstChild,o=0;l;l=l.nextSibling,++o)r[e.options.gutters[o]]=l.offsetLeft,n[e.options.gutters[o]]=l.offsetWidth;return{fixedPos:_(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:r,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function L(e,t,r){function n(t){var r=t.nextSibling;return Cl&&Nl&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),r}for(var l=e.display,o=e.options.lineNumbers,i=l.lineDiv,a=i.firstChild,s=l.view,c=l.viewFrom,u=0;u<s.length;u++){var h=s[u];if(h.hidden);else if(h.node){for(;a!=h.node;)a=n(a);var f=o&&null!=t&&c>=t&&h.lineNumber;h.changes&&(Gn(h.changes,"gutter")>-1&&(f=!1),T(e,h,c,r)),f&&($n(h.lineNumber),h.lineNumber.appendChild(document.createTextNode(y(e.options,c)))),a=h.node.nextSibling}else{var g=P(e,h,c,r);i.insertBefore(g,a)}c+=h.size}for(;a;)a=n(a)}function T(e,t,r,n){for(var l=0;l<t.changes.length;l++){var o=t.changes[l];"text"==o?A(e,t):"gutter"==o?N(e,t,r,n):"class"==o?D(t):"widget"==o&&B(t,n)}t.changes=null}function I(e){return e.node==e.text&&(e.node=Qn("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),yl&&(e.node.style.zIndex=2)),e.node}function R(e){var t=e.bgClass?e.bgClass+" "+(e.line.bgClass||""):e.line.bgClass;if(t&&(t+=" CodeMirror-linebackground"),e.background)t?e.background.className=t:(e.background.parentNode.removeChild(e.background),e.background=null);else if(t){var r=I(e);e.background=r.insertBefore(Qn("div",null,t),r.firstChild)}}function O(e,t){var r=e.display.externalMeasured;return r&&r.line==t.line?(e.display.externalMeasured=null,t.measure=r.measure,r.built):Kr(e,t)}function A(e,t){var r=t.text.className,n=O(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,D(t)):r&&(t.text.className=r)}function D(e){R(e),e.line.wrapClass?I(e).className=e.line.wrapClass:e.node!=e.text&&(e.node.className="");var t=e.textClass?e.textClass+" "+(e.line.textClass||""):e.line.textClass;e.text.className=t||""}function N(e,t,r,n){t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null);var l=t.line.gutterMarkers;if(e.options.lineNumbers||l){var o=I(t),i=t.gutter=o.insertBefore(Qn("div",null,"CodeMirror-gutter-wrapper","position: absolute; left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px"),t.text);if(!e.options.lineNumbers||l&&l["CodeMirror-linenumbers"]||(t.lineNumber=i.appendChild(Qn("div",y(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+n.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),l)for(var a=0;a<e.options.gutters.length;++a){var s=e.options.gutters[a],c=l.hasOwnProperty(s)&&l[s];c&&i.appendChild(Qn("div",[c],"CodeMirror-gutter-elt","left: "+n.gutterLeft[s]+"px; width: "+n.gutterWidth[s]+"px"))}}}function B(e,t){e.alignable&&(e.alignable=null);for(var r,n=e.node.firstChild;n;n=r){var r=n.nextSibling;"CodeMirror-linewidget"==n.className&&e.node.removeChild(n)}F(e,t)}function P(e,t,r,n){var l=O(e,t);return t.text=t.node=l.pre,l.bgClass&&(t.bgClass=l.bgClass),l.textClass&&(t.textClass=l.textClass),D(t),N(e,t,r,n),F(t,n),t.node}function F(e,t){if(j(e.line,e,t,!0),e.rest)for(var r=0;r<e.rest.length;r++)j(e.rest[r],e,t,!1)}function j(e,t,r,n){if(e.widgets)for(var l=I(t),o=0,i=e.widgets;o<i.length;++o){var a=i[o],s=Qn("div",[a.node],"CodeMirror-linewidget");a.handleMouseEvents||(s.ignoreEvents=!0),H(a,s,t,r),n&&a.above?l.insertBefore(s,t.gutter||t.text):l.appendChild(s),Nn(a,"redraw")}}function H(e,t,r,n){if(e.noHScroll){(r.alignable||(r.alignable=[])).push(t);var l=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(l-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=l+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function W(e){return zl(e.line,e.ch)}function z(e,t){return ql(e,t)<0?t:e}function q(e,t){return ql(e,t)<0?e:t}function G(e,t){this.ranges=e,this.primIndex=t}function V(e,t){this.anchor=e,this.head=t}function U(e,t){var r=e[t];e.sort(function(e,t){return ql(e.from(),t.from())}),t=Gn(e,r);for(var n=1;n<e.length;n++){var l=e[n],o=e[n-1];if(ql(o.to(),l.from())>=0){var i=q(o.from(),l.from()),a=z(o.to(),l.to()),s=o.empty()?l.from()==l.head:o.from()==o.head;t>=n&&--t,e.splice(--n,2,new V(s?a:i,s?i:a))}}return new G(e,t)}function J(e,t){return new G([new V(e,t||e)],0)}function Y(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function K(e,t){if(t.line<e.first)return zl(e.first,0);var r=e.first+e.size-1;return t.line>r?zl(r,cn(e,r).text.length):X(t,cn(e,t.line).text.length)}function X(e,t){var r=e.ch;return null==r||r>t?zl(e.line,t):0>r?zl(e.line,0):e}function Q(e,t){return t>=e.first&&t<e.first+e.size}function $(e,t){for(var r=[],n=0;n<t.length;n++)r[n]=K(e,t[n]);return r}function Z(e,t,r,n){if(e.cm&&e.cm.display.shift||e.extend){var l=t.anchor;if(n){var o=ql(r,l)<0;o!=ql(n,l)<0?(l=r,r=n):o!=ql(r,n)<0&&(r=n)}return new V(l,r)}return new V(n||r,r)}function ee(e,t,r,n){ie(e,new G([Z(e,e.sel.primary(),t,r)],0),n)}function te(e,t,r){for(var n=[],l=0;l<e.sel.ranges.length;l++)n[l]=Z(e,e.sel.ranges[l],t[l],null);var o=U(n,e.sel.primIndex);ie(e,o,r)}function re(e,t,r,n){var l=e.sel.ranges.slice(0);l[t]=r,ie(e,U(l,e.sel.primIndex),n)}function ne(e,t,r,n){ie(e,J(t,r),n)}function le(e,t){var r={ranges:t.ranges,update:function(t){this.ranges=[];for(var r=0;r<t.length;r++)this.ranges[r]=new V(K(e,t[r].anchor),K(e,t[r].head))}};return Bo(e,"beforeSelectionChange",e,r),e.cm&&Bo(e.cm,"beforeSelectionChange",e.cm,r),r.ranges!=t.ranges?U(r.ranges,r.ranges.length-1):t}function oe(e,t,r){var n=e.history.done,l=qn(n);l&&l.ranges?(n[n.length-1]=t,ae(e,t,r)):ie(e,t,r)}function ie(e,t,r){ae(e,t,r),kn(e,e.sel,e.cm?e.cm.curOp.id:NaN,r)}function ae(e,t,r){(Fn(e,"beforeSelectionChange")||e.cm&&Fn(e.cm,"beforeSelectionChange"))&&(t=le(e,t));var n=ql(t.primary().head,e.sel.primary().head)<0?-1:1;se(e,ue(e,t,n,!0)),r&&r.scroll===!1||!e.cm||rr(e.cm)}function se(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=e.cm.curOp.cursorActivity=!0),Nn(e,"cursorActivity",e))}function ce(e){se(e,ue(e,e.sel,null,!1),Ho)}function ue(e,t,r,n){for(var l,o=0;o<t.ranges.length;o++){var i=t.ranges[o],a=he(e,i.anchor,r,n),s=he(e,i.head,r,n);(l||a!=i.anchor||s!=i.head)&&(l||(l=t.ranges.slice(0,o)),l[o]=new V(a,s))}return l?U(l,t.primIndex):t}function he(e,t,r,n){var l=!0;e:for(;l;){var o=e,i=t,a=r,s=n;l=!1;var c=!1,u=i,h=a||1;o.cantEdit=!1;t:for(;;){var f=cn(o,u.line);if(f.markedSpans)for(var g=0;g<f.markedSpans.length;++g){var d=f.markedSpans[g],p=d.marker;if((null==d.from||(p.inclusiveLeft?d.from<=u.ch:d.from<u.ch))&&(null==d.to||(p.inclusiveRight?d.to>=u.ch:d.to>u.ch))){if(s&&(Bo(p,"beforeCursorEnter"),p.explicitlyCleared)){if(f.markedSpans){--g;continue}break}if(!p.atomic)continue;var v=p.find(0>h?-1:1);if(0==ql(v,u)&&(v.ch+=h,v.ch<0?v=v.line>o.first?K(o,zl(v.line-1)):null:v.ch>f.text.length&&(v=v.line<o.first+o.size-1?zl(v.line+1,0):null),!v)){if(c){if(!s){e=o,t=i,r=a,n=!0,l=!0,c=u=h=f=g=d=p=v=void 0;continue e}return o.cantEdit=!0,zl(o.first,0)}c=!0,v=i,h=-h}u=v;continue t}}return u}}}function fe(e){for(var t=e.display,r=e.doc,n=document.createDocumentFragment(),l=document.createDocumentFragment(),o=0;o<r.sel.ranges.length;o++){var i=r.sel.ranges[o],a=i.empty();(a||e.options.showCursorWhenSelecting)&&ge(e,i,n),a||de(e,i,l)}if(e.options.moveInputWithCursor){var s=je(e,r.sel.primary().head,"div"),c=t.wrapper.getBoundingClientRect(),u=t.lineDiv.getBoundingClientRect(),h=Math.max(0,Math.min(t.wrapper.clientHeight-10,s.top+u.top-c.top)),f=Math.max(0,Math.min(t.wrapper.clientWidth-10,s.left+u.left-c.left));t.inputDiv.style.top=h+"px",t.inputDiv.style.left=f+"px"}Zn(t.cursorDiv,n),Zn(t.selectionDiv,l)}function ge(e,t,r){var n=je(e,t.head,"div"),l=r.appendChild(Qn("div","","CodeMirror-cursor"));if(l.style.left=n.left+"px",l.style.top=n.top+"px",l.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px",n.other){var o=r.appendChild(Qn("div","","CodeMirror-cursor CodeMirror-secondarycursor"));o.style.display="",o.style.left=n.other.left+"px",o.style.top=n.other.top+"px",o.style.height=.85*(n.other.bottom-n.other.top)+"px"}}function de(e,t,r){function n(e,t,r,n){0>t&&(t=0),a.appendChild(Qn("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; width: "+(null==r?u-e:r)+"px; height: "+(n-t)+"px"))}function l(t,r,l){function o(r,n){return Fe(e,zl(t,r),"div",h,n)}var a,s,h=cn(i,t),f=h.text.length;return ol(vn(h),r||0,null==l?f:l,function(e,t,i){var h,g,d,p=o(e,"left");if(e==t)h=p,g=d=p.left;else{if(h=o(t-1,"right"),"rtl"==i){var v=p;p=h,h=v}g=p.left,d=h.right}null==r&&0==e&&(g=c),h.top-p.top>3&&(n(g,p.top,null,p.bottom),g=c,p.bottom<h.top&&n(g,p.bottom,null,h.top)),null==l&&t==f&&(d=u),(!a||p.top<a.top||p.top==a.top&&p.left<a.left)&&(a=p),(!s||h.bottom>s.bottom||h.bottom==s.bottom&&h.right>s.right)&&(s=h),c+1>g&&(g=c),n(g,h.top,d-g,h.bottom)}),{start:a,end:s}}var o=e.display,i=e.doc,a=document.createDocumentFragment(),s=xe(e.display),c=s.left,u=o.lineSpace.offsetWidth-s.right,h=t.from(),f=t.to();if(h.line==f.line)l(h.line,h.ch,f.ch);else{var g=cn(i,h.line),d=cn(i,f.line),p=Ar(g)==Ar(d),v=l(h.line,h.ch,p?g.text.length+1:null).end,m=l(f.line,p?0:null,f.ch).start;p&&(v.top<m.top-2?(n(v.right,v.top,null,v.bottom),n(c,m.top,m.left,m.bottom)):n(v.right,v.top,m.left-v.right,v.bottom)),v.bottom<m.top&&n(c,v.bottom,null,m.top)}r.appendChild(a)}function pe(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var r=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0&&(t.blinker=setInterval(function(){t.cursorDiv.style.visibility=(r=!r)?"":"hidden"},e.options.cursorBlinkRate))}}function ve(e,t){e.doc.mode.startState&&e.doc.frontier<e.display.viewTo&&e.state.highlight.set(t,Yn(me,e))}function me(e){var t=e.doc;if(t.frontier<t.first&&(t.frontier=t.first),!(t.frontier>=e.display.viewTo)){var r=+new Date+e.options.workTime,n=uo(t.mode,ye(e,t.frontier));Ye(e,function(){t.iter(t.frontier,Math.min(t.first+t.size,e.display.viewTo+500),function(l){if(t.frontier>=e.display.viewFrom){var o=l.styles;l.styles=Vr(e,l,n,!0);for(var i=!o||o.length!=l.styles.length,a=0;!i&&a<o.length;++a)i=o[a]!=l.styles[a];i&&tt(e,t.frontier,"text"),l.stateAfter=uo(t.mode,n)}else Jr(e,l.text,n),l.stateAfter=t.frontier%5==0?uo(t.mode,n):null;return++t.frontier,+new Date>r?(ve(e,e.options.workDelay),!0):void 0})})}}function be(e,t,r){for(var n,l,o=e.doc,i=r?-1:t-(e.doc.mode.innerMode?1e3:100),a=t;a>i;--a){if(a<=o.first)return o.first;var s=cn(o,a-1);if(s.stateAfter&&(!r||a<=o.frontier))return a;var c=qo(s.text,null,e.options.tabSize);(null==l||n>c)&&(l=a-1,n=c)}return l}function ye(e,t,r){var n=e.doc,l=e.display;if(!n.mode.startState)return!0;var o=be(e,t,r),i=o>n.first&&cn(n,o-1).stateAfter;return i=i?uo(n.mode,i):ho(n.mode),n.iter(o,t,function(r){Jr(e,r.text,i);var a=o==t-1||o%5==0||o>=l.viewFrom&&o<l.viewTo;r.stateAfter=a?uo(n.mode,i):null,++o}),r&&(n.frontier=o),i}function _e(e){return e.lineSpace.offsetTop}function we(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function xe(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=Zn(e.measure,Qn("pre","x")),r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle;return e.cachedPaddingH={left:parseInt(r.paddingLeft),right:parseInt(r.paddingRight)}}function ke(e,t,r){var n=e.options.lineWrapping,l=n&&e.display.scroller.clientWidth;if(!t.measure.heights||n&&t.measure.width!=l){var o=t.measure.heights=[];if(n){t.measure.width=l;for(var i=t.text.firstChild.getClientRects(),a=0;a<i.length-1;a++){var s=i[a],c=i[a+1];Math.abs(s.bottom-c.bottom)>2&&o.push((s.bottom+c.top)/2-r.top)}}o.push(r.bottom-r.top)}}function Ce(e,t,r){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var n=0;n<e.rest.length;n++)if(gn(e.rest[n])>r)return{map:e.measure.maps[n],cache:e.measure.caches[n],before:!0}}function Me(e,t){t=Ar(t);var r=gn(t),n=e.display.externalMeasured=new $e(e.doc,t,r);n.lineN=r;var l=n.built=Kr(e,n);return n.text=l.pre,Zn(e.display.lineMeasure,l.pre),n}function Se(e,t,r,n){return Te(e,Le(e,t),r,n)}function Ee(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[nt(e,t)];var r=e.display.externalMeasured;return r&&t>=r.lineN&&t<r.lineN+r.size?r:void 0}function Le(e,t){var r=gn(t),n=Ee(e,r);n&&!n.text?n=null:n&&n.changes&&T(e,n,r,E(e)),n||(n=Me(e,t));var l=Ce(n,t,r);return{line:t,view:n,rect:null,map:l.map,cache:l.cache,before:l.before,hasHeights:!1}}function Te(e,t,r,n){t.before&&(r=-1);var l,o=r+(n||"");return t.cache.hasOwnProperty(o)?l=t.cache[o]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(ke(e,t.view,t.rect),t.hasHeights=!0),l=Ie(e,t,r,n),l.bogus||(t.cache[o]=l)),{left:l.left,right:l.right,top:l.top,bottom:l.bottom}}function Ie(e,t,r,n){for(var l,o,i,a,s=t.map,c=0;c<s.length;c+=3){var u=s[c],h=s[c+1];if(u>r?(o=0,i=1,a="left"):h>r?(o=r-u,i=o+1):(c==s.length-3||r==h&&s[c+3]>r)&&(i=h-u,o=i-1,r>=h&&(a="right")),null!=o){if(l=s[c+2],u==h&&n==(l.insertLeft?"left":"right")&&(a=n),"left"==n&&0==o)for(;c&&s[c-2]==s[c-3]&&s[c-1].insertLeft;)l=s[(c-=3)+2],a="left";if("right"==n&&o==h-u)for(;c<s.length-3&&s[c+3]==s[c+4]&&!s[c+5].insertLeft;)l=s[(c+=3)+2],a="right";break}}var f;if(3==l.nodeType){for(;o&&Xn(t.line.text.charAt(u+o));)--o;for(;h>u+i&&Xn(t.line.text.charAt(u+i));)++i;if(_l&&0==o&&i==h-u)f=l.parentNode.getBoundingClientRect();else if(kl&&e.options.lineWrapping){var g=Uo(l,o,i).getClientRects();f=g.length?g["right"==n?g.length-1:0]:Jl}else f=Uo(l,o,i).getBoundingClientRect()}else{o>0&&(a=n="right");var g;f=e.options.lineWrapping&&(g=l.getClientRects()).length>1?g["right"==n?g.length-1:0]:l.getBoundingClientRect()}if(_l&&!o&&(!f||!f.left&&!f.right)){var d=l.parentNode.getClientRects()[0];f=d?{left:d.left,right:d.left+Ve(e.display),top:d.top,bottom:d.bottom}:Jl}for(var p,v=(f.bottom+f.top)/2-t.rect.top,m=t.view.measure.heights,c=0;c<m.length-1&&!(v<m[c]);c++);p=c?m[c-1]:0,v=m[c];var b={left:("right"==a?f.right:f.left)-t.rect.left,right:("left"==a?f.left:f.right)-t.rect.left,top:p,bottom:v};return f.left||f.right||(b.bogus=!0),b}function Re(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Oe(e){e.display.externalMeasure=null,$n(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)Re(e.display.view[t])}function Ae(e){Oe(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function De(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Ne(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function Be(e,t,r,n){if(t.widgets)for(var l=0;l<t.widgets.length;++l)if(t.widgets[l].above){var o=Hr(t.widgets[l]);r.top+=o,r.bottom+=o}if("line"==n)return r;n||(n="local");var i=pn(t);if("local"==n?i+=_e(e.display):i-=e.display.viewOffset,"page"==n||"window"==n){var a=e.display.lineSpace.getBoundingClientRect();i+=a.top+("window"==n?0:Ne());var s=a.left+("window"==n?0:De());r.left+=s,r.right+=s}return r.top+=i,r.bottom+=i,r}function Pe(e,t,r){if("div"==r)return t;var n=t.left,l=t.top;if("page"==r)n-=De(),l-=Ne();else if("local"==r||!r){var o=e.display.sizer.getBoundingClientRect();n+=o.left,l+=o.top}var i=e.display.lineSpace.getBoundingClientRect();return{left:n-i.left,top:l-i.top}}function Fe(e,t,r,n,l){return n||(n=cn(e.doc,t.line)),Be(e,n,Se(e,n,t.ch,l),r)}function je(e,t,r,n,l){function o(t,o){var i=Te(e,l,t,o?"right":"left");return o?i.left=i.right:i.right=i.left,Be(e,n,i,r)}function i(e,t){var r=a[t],n=r.level%2;return e==il(r)&&t&&r.level<a[t-1].level?(r=a[--t],e=al(r)-(r.level%2?0:1),n=!0):e==al(r)&&t<a.length-1&&r.level<a[t+1].level&&(r=a[++t],e=il(r)-r.level%2,n=!1),n&&e==r.to&&e>r.from?o(e-1):o(e,n)}n=n||cn(e.doc,t.line),l||(l=Le(e,n));var a=vn(n),s=t.ch;if(!a)return o(s);var c=gl(a,s),u=i(s,c);return null!=li&&(u.other=i(s,li)),u}function He(e,t){var r=0,t=K(e.doc,t);e.options.lineWrapping||(r=Ve(e.display)*t.ch);var n=cn(e.doc,t.line),l=pn(n)+_e(e.display);return{left:r,right:r,top:l,bottom:l+n.height}}function We(e,t,r,n){var l=zl(e,t);return l.xRel=n,r&&(l.outside=!0),l}function ze(e,t,r){var n=e.doc;if(r+=e.display.viewOffset,0>r)return We(n.first,0,!0,-1);var l=dn(n,r),o=n.first+n.size-1;if(l>o)return We(n.first+n.size-1,cn(n,o).text.length,!0,1);0>t&&(t=0);for(var i=cn(n,l);;){var a=qe(e,i,l,t,r),s=Rr(i),c=s&&s.find(0,!0);if(!s||!(a.ch>c.from.ch||a.ch==c.from.ch&&a.xRel>0))return a;l=gn(i=c.to.line)}}function qe(e,t,r,n,l){function o(n){var l=je(e,zl(r,n),"line",t,c);return a=!0,i>l.bottom?l.left-s:i<l.top?l.left+s:(a=!1,l.left)}var i=l-pn(t),a=!1,s=2*e.display.wrapper.clientWidth,c=Le(e,t),u=vn(t),h=t.text.length,f=sl(t),g=cl(t),d=o(f),p=a,v=o(g),m=a;if(n>v)return We(r,g,m,1);for(;;){if(u?g==f||g==pl(t,f,1):1>=g-f){for(var b=d>n||v-n>=n-d?f:g,y=n-(b==f?d:v);Xn(t.text.charAt(b));)++b;var _=We(r,b,b==f?p:m,-1>y?-1:y>1?1:0);return _}var w=Math.ceil(h/2),x=f+w;if(u){x=f;for(var k=0;w>k;++k)x=pl(t,x,1)}var C=o(x);C>n?(g=x,v=C,(m=a)&&(v+=1e3),h=w):(f=x,d=C,p=a,h-=w)}}function Ge(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==Gl){Gl=Qn("pre");for(var t=0;49>t;++t)Gl.appendChild(document.createTextNode("x")),Gl.appendChild(Qn("br"));Gl.appendChild(document.createTextNode("x"))}Zn(e.measure,Gl);var r=Gl.offsetHeight/50;return r>3&&(e.cachedTextHeight=r),
$n(e.measure),r||1}function Ve(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=Qn("span","xxxxxxxxxx"),r=Qn("pre",[t]);Zn(e.measure,r);var n=t.getBoundingClientRect(),l=(n.right-n.left)/10;return l>2&&(e.cachedCharWidth=l),l||10}function Ue(e){e.curOp={viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivity:!1,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,id:++Yl},Po++||(Io=[])}function Je(e){var t=e.curOp,r=e.doc,n=e.display;if(e.curOp=null,t.updateMaxLine&&f(e),t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<n.viewFrom||t.scrollToPos.to.line>=n.viewTo)||n.maxLineChanged&&e.options.lineWrapping){var l=w(e,{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate);e.display.scroller.offsetHeight&&(e.doc.scrollTop=e.display.scroller.scrollTop)}if(!l&&t.selectionChanged&&fe(e),l||t.startHeight==e.doc.height||p(e),null!=t.scrollTop&&n.scroller.scrollTop!=t.scrollTop){var o=Math.max(0,Math.min(n.scroller.scrollHeight-n.scroller.clientHeight,t.scrollTop));n.scroller.scrollTop=n.scrollbarV.scrollTop=r.scrollTop=o}if(null!=t.scrollLeft&&n.scroller.scrollLeft!=t.scrollLeft){var i=Math.max(0,Math.min(n.scroller.scrollWidth-n.scroller.clientWidth,t.scrollLeft));n.scroller.scrollLeft=n.scrollbarH.scrollLeft=r.scrollLeft=i,m(e)}if(t.scrollToPos){var a=$t(e,K(e.doc,t.scrollToPos.from),K(e.doc,t.scrollToPos.to),t.scrollToPos.margin);t.scrollToPos.isCursor&&e.state.focused&&Qt(e,a)}t.selectionChanged&&pe(e),e.state.focused&&t.updateInput&&ut(e,t.typing);var s=t.maybeHiddenMarkers,c=t.maybeUnhiddenMarkers;if(s)for(var u=0;u<s.length;++u)s[u].lines.length||Bo(s[u],"hide");if(c)for(var u=0;u<c.length;++u)c[u].lines.length&&Bo(c[u],"unhide");var h;if(--Po||(h=Io,Io=null),t.changeObjs){for(var u=0;u<t.changeObjs.length;u++)Bo(e,"change",e,t.changeObjs[u]);Bo(e,"changes",e,t.changeObjs)}if(t.cursorActivity&&Bo(e,"cursorActivity",e),h)for(var u=0;u<h.length;++u)h[u]()}function Ye(e,t){if(e.curOp)return t();Ue(e);try{return t()}finally{Je(e)}}function Ke(e,t){return function(){if(e.curOp)return t.apply(e,arguments);Ue(e);try{return t.apply(e,arguments)}finally{Je(e)}}}function Xe(e){return function(){if(this.curOp)return e.apply(this,arguments);Ue(this);try{return e.apply(this,arguments)}finally{Je(this)}}}function Qe(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);Ue(t);try{return e.apply(this,arguments)}finally{Je(t)}}}function $e(e,t,r){this.line=t,this.rest=Dr(t),this.size=this.rest?gn(qn(this.rest))-r+1:1,this.node=this.text=null,this.hidden=Pr(e,t)}function Ze(e,t,r){for(var n,l=[],o=t;r>o;o=n){var i=new $e(e.doc,cn(e.doc,o),o);n=o+i.size,l.push(i)}return l}function et(e,t,r,n){null==t&&(t=e.doc.first),null==r&&(r=e.doc.first+e.doc.size),n||(n=0);var l=e.display;if(n&&r<l.viewTo&&(null==l.updateLineNumbers||l.updateLineNumbers>t)&&(l.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=l.viewTo)Wl&&Nr(e.doc,t)<l.viewTo&&rt(e);else if(r<=l.viewFrom)Wl&&Br(e.doc,r+n)>l.viewFrom?rt(e):(l.viewFrom+=n,l.viewTo+=n);else if(t<=l.viewFrom&&r>=l.viewTo)rt(e);else if(t<=l.viewFrom){var o=lt(e,r,r+n,1);o?(l.view=l.view.slice(o.index),l.viewFrom=o.lineN,l.viewTo+=n):rt(e)}else if(r>=l.viewTo){var o=lt(e,t,t,-1);o?(l.view=l.view.slice(0,o.index),l.viewTo=o.lineN):rt(e)}else{var i=lt(e,t,t,-1),a=lt(e,r,r+n,1);i&&a?(l.view=l.view.slice(0,i.index).concat(Ze(e,i.lineN,a.lineN)).concat(l.view.slice(a.index)),l.viewTo+=n):rt(e)}var s=l.externalMeasured;s&&(r<s.lineN?s.lineN+=n:t<s.lineN+s.size&&(l.externalMeasured=null))}function tt(e,t,r){e.curOp.viewChanged=!0;var n=e.display,l=e.display.externalMeasured;if(l&&t>=l.lineN&&t<l.lineN+l.size&&(n.externalMeasured=null),!(t<n.viewFrom||t>=n.viewTo)){var o=n.view[nt(e,t)];if(null!=o.node){var i=o.changes||(o.changes=[]);-1==Gn(i,r)&&i.push(r)}}}function rt(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function nt(e,t){if(t>=e.display.viewTo)return null;if(t-=e.display.viewFrom,0>t)return null;for(var r=e.display.view,n=0;n<r.length;n++)if(t-=r[n].size,0>t)return n}function lt(e,t,r,n){var l,o=nt(e,t),i=e.display.view;if(!Wl)return{index:o,lineN:r};for(var a=0,s=e.display.viewFrom;o>a;a++)s+=i[a].size;if(s!=t){if(n>0){if(o==i.length-1)return null;l=s+i[o].size-t,o++}else l=s-t;t+=l,r+=l}for(;Nr(e.doc,r)!=r;){if(o==(0>n?0:i.length-1))return null;r+=n*i[o-(0>n?1:0)].size,o+=n}return{index:o,lineN:r}}function ot(e,t,r){var n=e.display,l=n.view;0==l.length||t>=n.viewTo||r<=n.viewFrom?(n.view=Ze(e,t,r),n.viewFrom=t):(n.viewFrom>t?n.view=Ze(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(nt(e,t))),n.viewFrom=t,n.viewTo<r?n.view=n.view.concat(Ze(e,n.viewTo,r)):n.viewTo>r&&(n.view=n.view.slice(0,nt(e,r)))),n.viewTo=r}function it(e){for(var t=e.display.view,r=0,n=0;n<t.length;n++){var l=t[n];l.hidden||l.node&&!l.changes||++r}return r}function at(e){e.display.pollingFast||e.display.poll.set(e.options.pollInterval,function(){ct(e),e.state.focused&&at(e)})}function st(e){function t(){var n=ct(e);n||r?(e.display.pollingFast=!1,at(e)):(r=!0,e.display.poll.set(60,t))}var r=!1;e.display.pollingFast=!0,e.display.poll.set(20,t)}function ct(e){var t=e.display.input,r=e.display.prevInput,n=e.doc;if(!e.state.focused||ti(t)||gt(e)||e.options.disableInput)return!1;var l=t.value;if(l==r&&!e.somethingSelected())return!1;if(kl&&!_l&&e.display.inputHasSelection===l)return ut(e),!1;var o=!e.curOp;o&&Ue(e),e.display.shift=!1;for(var i=0,a=Math.min(r.length,l.length);a>i&&r.charCodeAt(i)==l.charCodeAt(i);)++i;for(var s=l.slice(i),c=ei(s),u=e.state.pasteIncoming&&c.length>1&&n.sel.ranges.length==c.length,h=n.sel.ranges.length-1;h>=0;h--){var f=n.sel.ranges[h],g=f.from(),d=f.to();i<r.length?g=zl(g.line,g.ch-(r.length-i)):e.state.overwrite&&f.empty()&&!e.state.pasteIncoming&&(d=zl(d.line,Math.min(cn(n,d.line).text.length,d.ch+qn(c).length)));var p=e.curOp.updateInput,v={from:g,to:d,text:u?[c[h]]:c,origin:e.state.pasteIncoming?"paste":e.state.cutIncoming?"cut":"+input"};if(Gt(e.doc,v),Nn(e,"inputRead",e,v),s&&!e.state.pasteIncoming&&e.options.electricChars&&e.options.smartIndent&&f.head.ch<100&&(!h||n.sel.ranges[h-1].head.line!=f.head.line)){var m=e.getModeAt(f.head).electricChars;if(m)for(var b=0;b<m.length;b++)if(s.indexOf(m.charAt(b))>-1){lr(e,f.head.line,"smart");break}}}return rr(e),e.curOp.updateInput=p,e.curOp.typing=!0,l.length>1e3||l.indexOf("\n")>-1?t.value=e.display.prevInput="":e.display.prevInput=l,o&&Je(e),e.state.pasteIncoming=e.state.cutIncoming=!1,!0}function ut(e,t){var r,n,l=e.doc;if(e.somethingSelected()){e.display.prevInput="";var o=l.sel.primary();r=ri&&(o.to().line-o.from().line>100||(n=e.getSelection()).length>1e3);var i=r?"-":n||e.getSelection();e.display.input.value=i,e.state.focused&&Vo(e.display.input),kl&&!_l&&(e.display.inputHasSelection=i)}else t||(e.display.prevInput=e.display.input.value="",kl&&!_l&&(e.display.inputHasSelection=null));e.display.inaccurateSelection=r}function ht(e){"nocursor"==e.options.readOnly||Dl&&tl()==e.display.input||e.display.input.focus()}function ft(e){e.state.focused||(ht(e),Nt(e))}function gt(e){return e.options.readOnly||e.doc.cantEdit}function dt(e){function t(){e.state.focused&&setTimeout(Yn(ht,e),0)}function r(){null==a&&(a=setTimeout(function(){a=null,i.cachedCharWidth=i.cachedTextHeight=i.cachedPaddingH=Xo=null,e.setSize()},100))}function n(){el(document.body,i.wrapper)?setTimeout(n,5e3):No(window,"resize",r)}function l(t){Pn(e,t)||Ao(t)}function o(t){i.inaccurateSelection&&(i.prevInput="",i.inaccurateSelection=!1,i.input.value=e.getSelection(),Vo(i.input)),"cut"==t.type&&(e.state.cutIncoming=!0)}var i=e.display;Do(i.scroller,"mousedown",Ke(e,mt)),bl?Do(i.scroller,"dblclick",Ke(e,function(t){if(!Pn(e,t)){var r=vt(e,t);if(r&&!xt(e,t)&&!pt(e.display,t)){Ro(t);var n=cr(e.doc,r);ee(e.doc,n.anchor,n.head)}}})):Do(i.scroller,"dblclick",function(t){Pn(e,t)||Ro(t)}),Do(i.lineSpace,"selectstart",function(e){pt(i,e)||Ro(e)}),jl||Do(i.scroller,"contextmenu",function(t){Pt(e,t)}),Do(i.scroller,"scroll",function(){i.scroller.clientHeight&&(Mt(e,i.scroller.scrollTop),St(e,i.scroller.scrollLeft,!0),Bo(e,"scroll",e))}),Do(i.scrollbarV,"scroll",function(){i.scroller.clientHeight&&Mt(e,i.scrollbarV.scrollTop)}),Do(i.scrollbarH,"scroll",function(){i.scroller.clientHeight&&St(e,i.scrollbarH.scrollLeft)}),Do(i.scroller,"mousewheel",function(t){Et(e,t)}),Do(i.scroller,"DOMMouseScroll",function(t){Et(e,t)}),Do(i.scrollbarH,"mousedown",t),Do(i.scrollbarV,"mousedown",t),Do(i.wrapper,"scroll",function(){i.wrapper.scrollTop=i.wrapper.scrollLeft=0});var a;Do(window,"resize",r),setTimeout(n,5e3),Do(i.input,"keyup",Ke(e,At)),Do(i.input,"input",function(){kl&&!_l&&e.display.inputHasSelection&&(e.display.inputHasSelection=null),st(e)}),Do(i.input,"keydown",Ke(e,Ot)),Do(i.input,"keypress",Ke(e,Dt)),Do(i.input,"focus",Yn(Nt,e)),Do(i.input,"blur",Yn(Bt,e)),e.options.dragDrop&&(Do(i.scroller,"dragstart",function(t){Ct(e,t)}),Do(i.scroller,"dragenter",l),Do(i.scroller,"dragover",l),Do(i.scroller,"drop",Ke(e,kt))),Do(i.scroller,"paste",function(t){pt(i,t)||(e.state.pasteIncoming=!0,ht(e),st(e))}),Do(i.input,"paste",function(){e.state.pasteIncoming=!0,st(e)}),Do(i.input,"cut",o),Do(i.input,"copy",o),Tl&&Do(i.sizer,"mouseup",function(){tl()==i.input&&i.input.blur(),ht(e)})}function pt(e,t){for(var r=An(t);r!=e.wrapper;r=r.parentNode)if(!r||r.ignoreEvents||r.parentNode==e.sizer&&r!=e.mover)return!0}function vt(e,t,r,n){var l=e.display;if(!r){var o=An(t);if(o==l.scrollbarH||o==l.scrollbarV||o==l.scrollbarFiller||o==l.gutterFiller)return null}var i,a,s=l.lineSpace.getBoundingClientRect();try{i=t.clientX-s.left,a=t.clientY-s.top}catch(t){return null}var c,u=ze(e,i,a);if(n&&1==u.xRel&&(c=cn(e.doc,u.line).text).length==u.ch){var h=qo(c,c.length,e.options.tabSize)-c.length;u=zl(u.line,Math.round((i-xe(e.display).left)/Ve(e.display))-h)}return u}function mt(e){if(!Pn(this,e)){var t=this,r=t.display;if(r.shift=e.shiftKey,pt(r,e))return void(Cl||(r.scroller.draggable=!1,setTimeout(function(){r.scroller.draggable=!0},100)));if(!xt(t,e)){var n=vt(t,e);switch(window.focus(),Dn(e)){case 1:n?bt(t,e,n):An(e)==r.scroller&&Ro(e);break;case 2:Cl&&(t.state.lastMiddleDown=+new Date),n&&ee(t.doc,n),setTimeout(Yn(ht,t),20),Ro(e);break;case 3:jl&&Pt(t,e)}}}}function bt(e,t,r){setTimeout(Yn(ft,e),0);var n,l=+new Date;Ul&&Ul.time>l-400&&0==ql(Ul.pos,r)?n="triple":Vl&&Vl.time>l-400&&0==ql(Vl.pos,r)?(n="double",Ul={time:l,pos:r}):(n="single",Vl={time:l,pos:r});var o=e.doc.sel,i=!1;e.options.dragDrop&&Zo&&!i&&!gt(e)&&"single"==n&&o.contains(r)>-1&&o.somethingSelected()?yt(e,t,r):_t(e,t,r,n,i)}function yt(e,t,r){var n=e.display,l=Ke(e,function(o){Cl&&(n.scroller.draggable=!1),e.state.draggingText=!1,No(document,"mouseup",l),No(n.scroller,"drop",l),Math.abs(t.clientX-o.clientX)+Math.abs(t.clientY-o.clientY)<10&&(Ro(o),ee(e.doc,r),ht(e),bl&&!_l&&setTimeout(function(){document.body.focus(),ht(e)},20))});Cl&&(n.scroller.draggable=!0),e.state.draggingText=l,n.scroller.dragDrop&&n.scroller.dragDrop(),Do(document,"mouseup",l),Do(n.scroller,"drop",l)}function _t(e,t,r,n,l){function o(t){if(0!=ql(p,t))if(p=t,"rect"==n){for(var l=[],o=e.options.tabSize,i=qo(cn(c,r.line).text,r.ch,o),a=qo(cn(c,t.line).text,t.ch,o),s=Math.min(i,a),g=Math.max(i,a),d=Math.min(r.line,t.line),v=Math.min(e.lastLine(),Math.max(r.line,t.line));v>=d;d++){var m=cn(c,d).text,b=Wn(m,s,o);s==g?l.push(new V(zl(d,b),zl(d,b))):m.length>b&&l.push(new V(zl(d,b),zl(d,Wn(m,g,o))))}l.length||l.push(new V(r,r)),ie(c,U(f.ranges.slice(0,h).concat(l),h),Wo)}else{var y=u,_=y.anchor,w=t;if("single"!=n){if("double"==n)var x=cr(c,t);else var x=new V(zl(t.line,0),K(c,zl(t.line+1,0)));ql(x.anchor,_)>0?(w=x.head,_=q(y.from(),x.anchor)):(w=x.anchor,_=z(y.to(),x.head))}var l=f.ranges.slice(0);l[h]=new V(K(c,_),w),ie(c,U(l,h),Wo)}}function i(t){var r=++b,l=vt(e,t,!0,"rect"==n);if(l)if(0!=ql(l,p)){ft(e),o(l);var a=v(s,c);(l.line>=a.to||l.line<a.from)&&setTimeout(Ke(e,function(){b==r&&i(t)}),150)}else{var u=t.clientY<m.top?-20:t.clientY>m.bottom?20:0;u&&setTimeout(Ke(e,function(){b==r&&(s.scroller.scrollTop+=u,i(t))}),50)}}function a(t){b=1/0,Ro(t),ht(e),No(document,"mousemove",y),No(document,"mouseup",_),c.history.lastSelOrigin=null}var s=e.display,c=e.doc;Ro(t);var u,h,f=c.sel;if(l?(h=c.sel.contains(r),u=h>-1?c.sel.ranges[h]:new V(r,r)):u=c.sel.primary(),t.altKey)n="rect",l||(u=new V(r,r)),r=vt(e,t,!0,!0),h=-1;else if("double"==n){var g=cr(c,r);u=e.display.shift||c.extend?Z(c,u,g.anchor,g.head):g}else if("triple"==n){var d=new V(zl(r.line,0),K(c,zl(r.line+1,0)));u=e.display.shift||c.extend?Z(c,u,d.anchor,d.head):d}else u=Z(c,u,r);l?h>-1?re(c,h,u,Wo):(h=c.sel.ranges.length,ie(c,U(c.sel.ranges.concat([u]),h),{scroll:!1,origin:"*mouse"})):(h=0,ie(c,new G([u],0),Wo));var p=r,m=s.wrapper.getBoundingClientRect(),b=0,y=Ke(e,function(e){(kl&&!wl?e.buttons:Dn(e))?i(e):a(e)}),_=Ke(e,a);Do(document,"mousemove",y),Do(document,"mouseup",_)}function wt(e,t,r,n,l){try{var o=t.clientX,i=t.clientY}catch(t){return!1}if(o>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&Ro(t);var a=e.display,s=a.lineDiv.getBoundingClientRect();if(i>s.bottom||!Fn(e,r))return On(t);i-=s.top-a.viewOffset;for(var c=0;c<e.options.gutters.length;++c){var u=a.gutters.childNodes[c];if(u&&u.getBoundingClientRect().right>=o){var h=dn(e.doc,i),f=e.options.gutters[c];return l(e,r,e,h,f,t),On(t)}}}function xt(e,t){return wt(e,t,"gutterClick",!0,Nn)}function kt(e){var t=this;if(!Pn(t,e)&&!pt(t.display,e)){Ro(e),bl&&(Kl=+new Date);var r=vt(t,e,!0),n=e.dataTransfer.files;if(r&&!gt(t))if(n&&n.length&&window.FileReader&&window.File)for(var l=n.length,o=Array(l),i=0,a=function(e,n){var a=new FileReader;a.onload=function(){if(o[n]=a.result,++i==l){r=K(t.doc,r);var e={from:r,to:r,text:ei(o.join("\n")),origin:"paste"};Gt(t.doc,e),oe(t.doc,J(r,to(e)))}},a.readAsText(e)},s=0;l>s;++s)a(n[s],s);else{if(t.state.draggingText&&t.doc.sel.contains(r)>-1)return t.state.draggingText(e),void setTimeout(Yn(ht,t),20);try{var o=e.dataTransfer.getData("Text");if(o){var c=t.state.draggingText&&t.listSelections();if(ae(t.doc,J(r,r)),c)for(var s=0;s<c.length;++s)Xt(t.doc,"",c[s].anchor,c[s].head,"drag");t.replaceSelection(o,"around","paste"),ht(t)}}catch(e){}}}}function Ct(e,t){if(bl&&(!e.state.draggingText||+new Date-Kl<100))return void Ao(t);if(!Pn(e,t)&&!pt(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.setDragImage&&!Ll)){var r=Qn("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",El&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),El&&r.parentNode.removeChild(r)}}function Mt(e,t){Math.abs(e.doc.scrollTop-t)<2||(e.doc.scrollTop=t,ml||w(e,{top:t}),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t),e.display.scrollbarV.scrollTop!=t&&(e.display.scrollbarV.scrollTop=t),ml&&w(e),ve(e,100))}function St(e,t,r){(r?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)||(t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),e.doc.scrollLeft=t,m(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbarH.scrollLeft!=t&&(e.display.scrollbarH.scrollLeft=t))}function Et(e,t){var r=t.wheelDeltaX,n=t.wheelDeltaY;null==r&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(r=t.detail),null==n&&t.detail&&t.axis==t.VERTICAL_AXIS?n=t.detail:null==n&&(n=t.wheelDelta);var l=e.display,o=l.scroller;if(r&&o.scrollWidth>o.clientWidth||n&&o.scrollHeight>o.clientHeight){if(n&&Nl&&Cl)e:for(var i=t.target,a=l.view;i!=o;i=i.parentNode)for(var s=0;s<a.length;s++)if(a[s].node==i){e.display.currentWheelTarget=i;break e}if(r&&!ml&&!El&&null!=Ql)return n&&Mt(e,Math.max(0,Math.min(o.scrollTop+n*Ql,o.scrollHeight-o.clientHeight))),St(e,Math.max(0,Math.min(o.scrollLeft+r*Ql,o.scrollWidth-o.clientWidth))),Ro(t),void(l.wheelStartX=null);if(n&&null!=Ql){var c=n*Ql,u=e.doc.scrollTop,h=u+l.wrapper.clientHeight;0>c?u=Math.max(0,u+c-50):h=Math.min(e.doc.height,h+c+50),w(e,{top:u,bottom:h})}20>Xl&&(null==l.wheelStartX?(l.wheelStartX=o.scrollLeft,l.wheelStartY=o.scrollTop,l.wheelDX=r,l.wheelDY=n,setTimeout(function(){if(null!=l.wheelStartX){var e=o.scrollLeft-l.wheelStartX,t=o.scrollTop-l.wheelStartY,r=t&&l.wheelDY&&t/l.wheelDY||e&&l.wheelDX&&e/l.wheelDX;l.wheelStartX=l.wheelStartY=null,r&&(Ql=(Ql*Xl+r)/(Xl+1),++Xl)}},200)):(l.wheelDX+=r,l.wheelDY+=n))}}function Lt(e,t,r){if("string"==typeof t&&(t=fo[t],!t))return!1;e.display.pollingFast&&ct(e)&&(e.display.pollingFast=!1);var n=e.display.shift,l=!1;try{gt(e)&&(e.state.suppressEdits=!0),r&&(e.display.shift=!1),l=t(e)!=jo}finally{e.display.shift=n,e.state.suppressEdits=!1}return l}function Tt(e){var t=e.state.keyMaps.slice(0);return e.options.extraKeys&&t.push(e.options.extraKeys),t.push(e.options.keyMap),t}function It(e,t){var r=hr(e.options.keyMap),n=r.auto;clearTimeout($l),n&&!vo(t)&&($l=setTimeout(function(){hr(e.options.keyMap)==r&&(e.options.keyMap=n.call?n.call(null,e):n,a(e))},50));var l=mo(t,!0),o=!1;if(!l)return!1;var i=Tt(e);return o=t.shiftKey?po("Shift-"+l,i,function(t){return Lt(e,t,!0)})||po(l,i,function(t){return("string"==typeof t?/^go[A-Z]/.test(t):t.motion)?Lt(e,t):void 0}):po(l,i,function(t){return Lt(e,t)}),o&&(Ro(t),pe(e),Nn(e,"keyHandled",e,l,t)),o}function Rt(e,t,r){var n=po("'"+r+"'",Tt(e),function(t){return Lt(e,t,!0)});return n&&(Ro(t),pe(e),Nn(e,"keyHandled",e,"'"+r+"'",t)),n}function Ot(e){var t=this;if(ft(t),!Pn(t,e)){bl&&27==e.keyCode&&(e.returnValue=!1);var r=e.keyCode;t.display.shift=16==r||e.shiftKey;var n=It(t,e);El&&(eo=n?r:null,!n&&88==r&&!ri&&(Nl?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut"))}}function At(e){Pn(this,e)||16==e.keyCode&&(this.doc.sel.shift=!1)}function Dt(e){var t=this;if(!Pn(t,e)){var r=e.keyCode,n=e.charCode;if(El&&r==eo)return eo=null,void Ro(e);if(!(El&&(!e.which||e.which<10)||Tl)||!It(t,e)){var l=String.fromCharCode(null==n?r:n);Rt(t,e,l)||(kl&&!_l&&(t.display.inputHasSelection=null),st(t))}}}function Nt(e){"nocursor"!=e.options.readOnly&&(e.state.focused||(Bo(e,"focus",e),e.state.focused=!0,-1==e.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(e.display.wrapper.className+=" CodeMirror-focused"),e.curOp||(ut(e),Cl&&setTimeout(Yn(ut,e,!0),0))),at(e),pe(e))}function Bt(e){e.state.focused&&(Bo(e,"blur",e),e.state.focused=!1,e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-focused","")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150)}function Pt(e,t){function r(){if(null!=l.input.selectionStart){var t=l.input.value=""+(e.somethingSelected()?l.input.value:"");l.prevInput="",l.input.selectionStart=1,l.input.selectionEnd=t.length}}function n(){if(l.inputDiv.style.position="relative",l.input.style.cssText=s,_l&&(l.scrollbarV.scrollTop=l.scroller.scrollTop=i),at(e),null!=l.input.selectionStart){(!kl||_l)&&r(),clearTimeout(Zl);var t=0,n=function o(){""==l.prevInput&&0==l.input.selectionStart?Ke(e,fo.selectAll)(e):t++<10?Zl=setTimeout(o,500):ut(e)};Zl=setTimeout(n,200)}}if(!Pn(e,t,"contextmenu")){var l=e.display;if(!pt(l,t)&&!Ft(e,t)){var o=vt(e,t),i=l.scroller.scrollTop;if(o&&!El){var a=e.options.resetSelectionOnContextMenu;a&&-1==e.doc.sel.contains(o)&&Ke(e,ie)(e.doc,J(o),Ho);var s=l.input.style.cssText;if(l.inputDiv.style.position="absolute",l.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(t.clientY-5)+"px; left: "+(t.clientX-5)+"px; z-index: 1000; background: "+(kl?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",ht(e),ut(e),e.somethingSelected()||(l.input.value=l.prevInput=" "),kl&&!_l&&r(),jl){Ao(t);var c=function u(){No(window,"mouseup",u),setTimeout(n,20)};Do(window,"mouseup",c)}else setTimeout(n,50)}}}}function Ft(e,t){return Fn(e,"gutterContextMenu")?wt(e,t,"gutterContextMenu",!1,Bo):!1}function jt(e,t){if(ql(e,t.from)<0)return e;if(ql(e,t.to)<=0)return to(t);var r=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=to(t).ch-t.to.ch),zl(r,n)}function Ht(e,t){for(var r=[],n=0;n<e.sel.ranges.length;n++){var l=e.sel.ranges[n];r.push(new V(jt(l.anchor,t),jt(l.head,t)))}return U(r,e.sel.primIndex)}function Wt(e,t,r){return e.line==t.line?zl(r.line,e.ch-t.ch+r.ch):zl(r.line+(e.line-t.line),e.ch)}function zt(e,t,r){for(var n=[],l=zl(e.first,0),o=l,i=0;i<t.length;i++){var a=t[i],s=Wt(a.from,l,o),c=Wt(to(a),l,o);if(l=a.to,o=c,"around"==r){var u=e.sel.ranges[i],h=ql(u.head,u.anchor)<0;n[i]=new V(h?c:s,h?s:c)}else n[i]=new V(s,s)}return new G(n,e.sel.primIndex)}function qt(e,t,r){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){this.canceled=!0}};return r&&(n.update=function(t,r,n,l){t&&(this.from=K(e,t)),r&&(this.to=K(e,r)),n&&(this.text=n),void 0!==l&&(this.origin=l)}),Bo(e,"beforeChange",e,n),e.cm&&Bo(e.cm,"beforeChange",e.cm,n),n.canceled?null:{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Gt(e,t,r){if(e.cm){if(!e.cm.curOp)return Ke(e.cm,Gt)(e,t,r);if(e.cm.state.suppressEdits)return}if(!(Fn(e,"beforeChange")||e.cm&&Fn(e.cm,"beforeChange"))||(t=qt(e,t,!0))){var n=Hl&&!r&&kr(e,t.from,t.to);if(n)for(var l=n.length-1;l>=0;--l)Vt(e,{from:n[l].from,to:n[l].to,text:l?[""]:t.text});else Vt(e,t)}}function Vt(e,t){if(1!=t.text.length||""!=t.text[0]||0!=ql(t.from,t.to)){var r=Ht(e,t);wn(e,t,r,e.cm?e.cm.curOp.id:NaN),Yt(e,t,r,_r(e,t));var n=[];an(e,function(e,r){r||-1!=Gn(n,e.history)||(Rn(e.history,t),n.push(e.history)),Yt(e,t,null,_r(e,t))})}}function Ut(e,t,r){if(!e.cm||!e.cm.state.suppressEdits){for(var n,l=e.history,o=e.sel,i="undo"==t?l.done:l.undone,a="undo"==t?l.undone:l.done,s=0;s<i.length&&(n=i[s],r?!n.ranges||n.equals(e.sel):n.ranges);s++);if(s!=i.length){for(l.lastOrigin=l.lastSelOrigin=null;n=i.pop(),n.ranges;){if(Cn(n,a),r&&!n.equals(e.sel))return void ie(e,n,{clearRedo:!1});o=n}var c=[];Cn(o,a),a.push({changes:c,generation:l.generation}),l.generation=n.generation||++l.maxGeneration;for(var u=Fn(e,"beforeChange")||e.cm&&Fn(e.cm,"beforeChange"),s=n.changes.length-1;s>=0;--s){var h=n.changes[s];if(h.origin=t,u&&!qt(e,h,!1))return void(i.length=0);c.push(bn(e,h));var f=s?Ht(e,h,null):qn(i);Yt(e,h,f,xr(e,h)),e.cm&&rr(e.cm);var g=[];an(e,function(e,t){t||-1!=Gn(g,e.history)||(Rn(e.history,h),g.push(e.history)),Yt(e,h,null,xr(e,h))})}}}}function Jt(e,t){e.first+=t,e.sel=new G(Vn(e.sel.ranges,function(e){return new V(zl(e.anchor.line+t,e.anchor.ch),zl(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm&&et(e.cm,e.first,e.first-t,t)}function Yt(e,t,r,n){if(e.cm&&!e.cm.curOp)return Ke(e.cm,Yt)(e,t,r,n);if(t.to.line<e.first)return void Jt(e,t.text.length-1-(t.to.line-t.from.line));if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var l=t.text.length-1-(e.first-t.from.line);Jt(e,l),t={from:zl(e.first,0),to:zl(t.to.line+l,t.to.ch),text:[qn(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:zl(o,cn(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=un(e,t.from,t.to),r||(r=Ht(e,t,null)),e.cm?Kt(e.cm,t,n):nn(e,t,n),ae(e,r,Ho)}}function Kt(e,t,r){var n=e.doc,l=e.display,i=t.from,a=t.to,s=!1,c=i.line;e.options.lineWrapping||(c=gn(Ar(cn(n,i.line))),n.iter(c,a.line+1,function(e){return e==l.maxLine?(s=!0,!0):void 0})),n.sel.contains(t.from,t.to)>-1&&(e.curOp.cursorActivity=!0),nn(n,t,r,o(e)),e.options.lineWrapping||(n.iter(c,i.line+t.text.length,function(e){var t=h(e);t>l.maxLineLength&&(l.maxLine=e,l.maxLineLength=t,l.maxLineChanged=!0,s=!1)}),s&&(e.curOp.updateMaxLine=!0)),n.frontier=Math.min(n.frontier,i.line),ve(e,400);var u=t.text.length-(a.line-i.line)-1;i.line!=a.line||1!=t.text.length||rn(e.doc,t)?et(e,i.line,a.line+1,u):tt(e,i.line,"text"),(Fn(e,"change")||Fn(e,"changes"))&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push({from:i,to:a,text:t.text,removed:t.removed,origin:t.origin})}function Xt(e,t,r,n,l){if(n||(n=r),ql(n,r)<0){var o=n;n=r,r=o}"string"==typeof t&&(t=ei(t)),Gt(e,{from:r,to:n,text:t,origin:l})}function Qt(e,t){var r=e.display,n=r.sizer.getBoundingClientRect(),l=null;if(t.top+n.top<0?l=!0:t.bottom+n.top>(window.innerHeight||document.documentElement.clientHeight)&&(l=!1),null!=l&&!Ol){var o=Qn("div","",null,"position: absolute; top: "+(t.top-r.viewOffset-_e(e.display))+"px; height: "+(t.bottom-t.top+Fo)+"px; left: "+t.left+"px; width: 2px;");e.display.lineSpace.appendChild(o),o.scrollIntoView(l),e.display.lineSpace.removeChild(o)}}function $t(e,t,r,n){for(null==n&&(n=0);;){var l=!1,o=je(e,t),i=r&&r!=t?je(e,r):o,a=er(e,Math.min(o.left,i.left),Math.min(o.top,i.top)-n,Math.max(o.left,i.left),Math.max(o.bottom,i.bottom)+n),s=e.doc.scrollTop,c=e.doc.scrollLeft;if(null!=a.scrollTop&&(Mt(e,a.scrollTop),Math.abs(e.doc.scrollTop-s)>1&&(l=!0)),null!=a.scrollLeft&&(St(e,a.scrollLeft),Math.abs(e.doc.scrollLeft-c)>1&&(l=!0)),!l)return o}}function Zt(e,t,r,n,l){var o=er(e,t,r,n,l);null!=o.scrollTop&&Mt(e,o.scrollTop),null!=o.scrollLeft&&St(e,o.scrollLeft)}function er(e,t,r,n,l){var o=e.display,i=Ge(e.display);0>r&&(r=0);var a=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:o.scroller.scrollTop,s=o.scroller.clientHeight-Fo,c={},u=e.doc.height+we(o),h=i>r,f=l>u-i;if(a>r)c.scrollTop=h?0:r;else if(l>a+s){var g=Math.min(r,(f?u:l)-s);g!=a&&(c.scrollTop=g)}var d=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:o.scroller.scrollLeft,p=o.scroller.clientWidth-Fo;t+=o.gutters.offsetWidth,n+=o.gutters.offsetWidth;var v=o.gutters.offsetWidth,m=v+10>t;return d+v>t||m?(m&&(t=0),c.scrollLeft=Math.max(0,t-10-v)):n>p+d-3&&(c.scrollLeft=n+10-p),c}function tr(e,t,r){(null!=t||null!=r)&&nr(e),null!=t&&(e.curOp.scrollLeft=(null==e.curOp.scrollLeft?e.doc.scrollLeft:e.curOp.scrollLeft)+t),null!=r&&(e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+r)}function rr(e){nr(e);var t=e.getCursor(),r=t,n=t;e.options.lineWrapping||(r=t.ch?zl(t.line,t.ch-1):t,n=zl(t.line,t.ch+1)),e.curOp.scrollToPos={from:r,to:n,margin:e.options.cursorScrollMargin,isCursor:!0}}function nr(e){var t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null;var r=He(e,t.from),n=He(e,t.to),l=er(e,Math.min(r.left,n.left),Math.min(r.top,n.top)-t.margin,Math.max(r.right,n.right),Math.max(r.bottom,n.bottom)+t.margin);e.scrollTo(l.scrollLeft,l.scrollTop)}}function lr(e,t,r,n){var l,o=e.doc;null==r&&(r="add"),"smart"==r&&(e.doc.mode.indent?l=ye(e,t):r="prev");var i=e.options.tabSize,a=cn(o,t),s=qo(a.text,null,i);a.stateAfter&&(a.stateAfter=null);var c,u=a.text.match(/^\s*/)[0];if(n||/\S/.test(a.text)){if("smart"==r&&(c=e.doc.mode.indent(l,a.text.slice(u.length),a.text),c==jo)){if(!n)return;r="prev"}}else c=0,r="not";"prev"==r?c=t>o.first?qo(cn(o,t-1).text,null,i):0:"add"==r?c=s+e.options.indentUnit:"subtract"==r?c=s-e.options.indentUnit:"number"==typeof r&&(c=s+r),c=Math.max(0,c);var h="",f=0;if(e.options.indentWithTabs)for(var g=Math.floor(c/i);g;--g)f+=i,h+="	";if(c>f&&(h+=zn(c-f)),h!=u)Xt(e.doc,h,zl(t,0),zl(t,u.length),"+input");else for(var g=0;g<o.sel.ranges.length;g++){var d=o.sel.ranges[g];if(d.head.line==t&&d.head.ch<u.length){var f=zl(t,u.length);re(o,g,new V(f,f));break}}a.stateAfter=null}function or(e,t,r,n){var l=t,o=t,i=e.doc;return"number"==typeof t?o=cn(i,Y(i,t)):l=gn(t),null==l?null:n(o,l)?(tt(e,l,r),o):null}function ir(e,t){for(var r=e.doc.sel.ranges,n=[],l=0;l<r.length;l++){for(var o=t(r[l]);n.length&&ql(o.from,qn(n).to)<=0;){var i=n.pop();if(ql(i.from,o.from)<0){o.from=i.from;break}}n.push(o)}Ye(e,function(){for(var t=n.length-1;t>=0;t--)Xt(e.doc,"",n[t].from,n[t].to,"+delete");rr(e)})}function ar(e,t,r,n,l){function o(){var t=a+r;return t<e.first||t>=e.first+e.size?h=!1:(a=t,u=cn(e,t))}function i(e){var t=(l?pl:vl)(u,s,r,!0);if(null==t){if(e||!o())return h=!1;s=l?(0>r?cl:sl)(u):0>r?u.text.length:0}else s=t;return!0}var a=t.line,s=t.ch,c=r,u=cn(e,a),h=!0;if("char"==n)i();else if("column"==n)i(!0);else if("word"==n||"group"==n)for(var f=null,g="group"==n,d=!0;!(0>r)||i(!d);d=!1){var p=u.text.charAt(s)||"\n",v=Yo(p)?"w":g&&"\n"==p?"n":!g||/\s/.test(p)?null:"p";if(!g||d||v||(v="s"),f&&f!=v){0>r&&(r=1,i());break}if(v&&(f=v),r>0&&!i(!d))break}var m=he(e,zl(a,s),c,!0);return h||(m.hitSide=!0),m}function sr(e,t,r,n){var l,o=e.doc,i=t.left;if("page"==n){var a=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);l=t.top+r*(a-(0>r?1.5:.5)*Ge(e.display))}else"line"==n&&(l=r>0?t.bottom+3:t.top-3);for(;;){var s=ze(e,i,l);if(!s.outside)break;if(0>r?0>=l:l>=o.height){s.hitSide=!0;break}l+=5*r}return s}function cr(e,t){var r=cn(e,t.line).text,n=t.ch,l=t.ch;if(r){(t.xRel<0||l==r.length)&&n?--n:++l;for(var o=r.charAt(n),i=Yo(o)?Yo:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!Yo(e)};n>0&&i(r.charAt(n-1));)--n;for(;l<r.length&&i(r.charAt(l));)++l}return new V(zl(t.line,n),zl(t.line,l))}function ur(t,r,n,l){e.defaults[t]=r,n&&(no[t]=l?function(e,t,r){r!=lo&&n(e,t,r)}:n)}function hr(e){return"string"==typeof e?go[e]:e}function fr(e,t,r,n,l){if(n&&n.shared)return gr(e,t,r,n,l);if(e.cm&&!e.cm.curOp)return Ke(e.cm,fr)(e,t,r,n,l);var o=new yo(e,l),i=ql(t,r);if(n&&Jn(n,o),i>0||0==i&&o.clearWhenEmpty!==!1)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=Qn("span",[o.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||(o.widgetNode.ignoreEvents=!0),n.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(Or(e,t.line,t,r,o)||t.line!=r.line&&Or(e,r.line,t,r,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");Wl=!0}o.addToHistory&&wn(e,{from:t,to:r,origin:"markText"},e.sel,NaN);var a,s=t.line,c=e.cm;if(e.iter(s,r.line+1,function(e){c&&o.collapsed&&!c.options.lineWrapping&&Ar(e)==c.display.maxLine&&(a=!0),o.collapsed&&s!=t.line&&fn(e,0),mr(e,new dr(o,s==t.line?t.ch:null,s==r.line?r.ch:null)),++s}),o.collapsed&&e.iter(t.line,r.line+1,function(t){Pr(e,t)&&fn(t,0)}),o.clearOnEnter&&Do(o,"beforeCursorEnter",function(){o.clear()}),o.readOnly&&(Hl=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed&&(o.id=++_o,o.atomic=!0),c){if(a&&(c.curOp.updateMaxLine=!0),o.collapsed)et(c,t.line,r.line+1);else if(o.className||o.title||o.startStyle||o.endStyle)for(var u=t.line;u<=r.line;u++)tt(c,u,"text");o.atomic&&ce(c.doc),Nn(c,"markerAdded",c,o)}return o}function gr(e,t,r,n,l){n=Jn(n),n.shared=!1;var o=[fr(e,t,r,n,l)],i=o[0],a=n.widgetNode;return an(e,function(e){a&&(n.widgetNode=a.cloneNode(!0)),o.push(fr(e,K(e,t),K(e,r),n,l));for(var s=0;s<e.linked.length;++s)if(e.linked[s].isParent)return;i=qn(o)}),new wo(o,i)}function dr(e,t,r){this.marker=e,this.from=t,this.to=r}function pr(e,t){if(e)for(var r=0;r<e.length;++r){var n=e[r];if(n.marker==t)return n}}function vr(e,t){for(var r,n=0;n<e.length;++n)e[n]!=t&&(r||(r=[])).push(e[n]);return r}function mr(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function br(e,t,r){if(e)for(var n,l=0;l<e.length;++l){var o=e[l],i=o.marker,a=null==o.from||(i.inclusiveLeft?o.from<=t:o.from<t);if(a||o.from==t&&"bookmark"==i.type&&(!r||!o.marker.insertLeft)){var s=null==o.to||(i.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new dr(i,o.from,s?null:o.to))}}return n}function yr(e,t,r){if(e)for(var n,l=0;l<e.length;++l){var o=e[l],i=o.marker,a=null==o.to||(i.inclusiveRight?o.to>=t:o.to>t);if(a||o.from==t&&"bookmark"==i.type&&(!r||o.marker.insertLeft)){var s=null==o.from||(i.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new dr(i,s?null:o.from-t,null==o.to?null:o.to-t))}}return n}function _r(e,t){var r=Q(e,t.from.line)&&cn(e,t.from.line).markedSpans,n=Q(e,t.to.line)&&cn(e,t.to.line).markedSpans;if(!r&&!n)return null;var l=t.from.ch,o=t.to.ch,i=0==ql(t.from,t.to),a=br(r,l,i),s=yr(n,o,i),c=1==t.text.length,u=qn(t.text).length+(c?l:0);if(a)for(var h=0;h<a.length;++h){var f=a[h];if(null==f.to){var g=pr(s,f.marker);
g?c&&(f.to=null==g.to?null:g.to+u):f.to=l}}if(s)for(var h=0;h<s.length;++h){var f=s[h];if(null!=f.to&&(f.to+=u),null==f.from){var g=pr(a,f.marker);g||(f.from=u,c&&(a||(a=[])).push(f))}else f.from+=u,c&&(a||(a=[])).push(f)}a&&(a=wr(a)),s&&s!=a&&(s=wr(s));var d=[a];if(!c){var p,v=t.text.length-2;if(v>0&&a)for(var h=0;h<a.length;++h)null==a[h].to&&(p||(p=[])).push(new dr(a[h].marker,null,null));for(var h=0;v>h;++h)d.push(p);d.push(s)}return d}function wr(e){for(var t=0;t<e.length;++t){var r=e[t];null!=r.from&&r.from==r.to&&r.marker.clearWhenEmpty!==!1&&e.splice(t--,1)}return e.length?e:null}function xr(e,t){var r=En(e,t),n=_r(e,t);if(!r)return n;if(!n)return r;for(var l=0;l<r.length;++l){var o=r[l],i=n[l];if(o&&i)e:for(var a=0;a<i.length;++a){for(var s=i[a],c=0;c<o.length;++c)if(o[c].marker==s.marker)continue e;o.push(s)}else i&&(r[l]=i)}return r}function kr(e,t,r){var n=null;if(e.iter(t.line,r.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var r=e.markedSpans[t].marker;!r.readOnly||n&&-1!=Gn(n,r)||(n||(n=[])).push(r)}}),!n)return null;for(var l=[{from:t,to:r}],o=0;o<n.length;++o)for(var i=n[o],a=i.find(0),s=0;s<l.length;++s){var c=l[s];if(!(ql(c.to,a.from)<0||ql(c.from,a.to)>0)){var u=[s,1],h=ql(c.from,a.from),f=ql(c.to,a.to);(0>h||!i.inclusiveLeft&&!h)&&u.push({from:c.from,to:a.from}),(f>0||!i.inclusiveRight&&!f)&&u.push({from:a.to,to:c.to}),l.splice.apply(l,u),s+=u.length-1}}return l}function Cr(e){var t=e.markedSpans;if(t){for(var r=0;r<t.length;++r)t[r].marker.detachLine(e);e.markedSpans=null}}function Mr(e,t){if(t){for(var r=0;r<t.length;++r)t[r].marker.attachLine(e);e.markedSpans=t}}function Sr(e){return e.inclusiveLeft?-1:0}function Er(e){return e.inclusiveRight?1:0}function Lr(e,t){var r=e.lines.length-t.lines.length;if(0!=r)return r;var n=e.find(),l=t.find(),o=ql(n.from,l.from)||Sr(e)-Sr(t);if(o)return-o;var i=ql(n.to,l.to)||Er(e)-Er(t);return i?i:t.id-e.id}function Tr(e,t){var r,n=Wl&&e.markedSpans;if(n)for(var l,o=0;o<n.length;++o)l=n[o],l.marker.collapsed&&null==(t?l.from:l.to)&&(!r||Lr(r,l.marker)<0)&&(r=l.marker);return r}function Ir(e){return Tr(e,!0)}function Rr(e){return Tr(e,!1)}function Or(e,t,r,n,l){var o=cn(e,t),i=Wl&&o.markedSpans;if(i)for(var a=0;a<i.length;++a){var s=i[a];if(s.marker.collapsed){var c=s.marker.find(0),u=ql(c.from,r)||Sr(s.marker)-Sr(l),h=ql(c.to,n)||Er(s.marker)-Er(l);if(!(u>=0&&0>=h||0>=u&&h>=0)&&(0>=u&&(ql(c.to,r)||Er(s.marker)-Sr(l))>0||u>=0&&(ql(c.from,n)||Sr(s.marker)-Er(l))<0))return!0}}}function Ar(e){for(var t;t=Ir(e);)e=t.find(-1,!0).line;return e}function Dr(e){for(var t,r;t=Rr(e);)e=t.find(1,!0).line,(r||(r=[])).push(e);return r}function Nr(e,t){var r=cn(e,t),n=Ar(r);return r==n?t:gn(n)}function Br(e,t){if(t>e.lastLine())return t;var r,n=cn(e,t);if(!Pr(e,n))return t;for(;r=Rr(n);)n=r.find(1,!0).line;return gn(n)+1}function Pr(e,t){var r=Wl&&t.markedSpans;if(r)for(var n,l=0;l<r.length;++l)if(n=r[l],n.marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&Fr(e,t,n))return!0}}function Fr(e,t,r){for(var n=!0;n;){var l=e,o=t,i=r;if(n=!1,null!=i.to){if(i.marker.inclusiveRight&&i.to==o.text.length)return!0;for(var a,s=0;s<o.markedSpans.length;++s)if(a=o.markedSpans[s],a.marker.collapsed&&!a.marker.widgetNode&&a.from==i.to&&(null==a.to||a.to!=i.from)&&(a.marker.inclusiveLeft||i.marker.inclusiveRight)&&Fr(l,o,a))return!0}else{var c=i.marker.find(1,!0);e=l,t=c.line,r=pr(c.line.markedSpans,i.marker),n=!0,c=void 0}}}function jr(e,t,r){pn(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&tr(e,null,r)}function Hr(e){return null!=e.height?e.height:(el(document.body,e.node)||Zn(e.cm.display.measure,Qn("div",[e.node],null,"position: relative")),e.height=e.node.offsetHeight)}function Wr(e,t,r,n){var l=new xo(e,r,n);return l.noHScroll&&(e.display.alignWidgets=!0),or(e,t,"widget",function(t){var r=t.widgets||(t.widgets=[]);if(null==l.insertAt?r.push(l):r.splice(Math.min(r.length-1,Math.max(0,l.insertAt)),0,l),l.line=t,!Pr(e.doc,t)){var n=pn(t)<e.doc.scrollTop;fn(t,t.height+Hr(l)),n&&tr(e,null,l.height),e.curOp.forceUpdate=!0}return!0}),l}function zr(e,t,r,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),Cr(e),Mr(e,r);var l=n?n(e):1;l!=e.height&&fn(e,l)}function qr(e){e.parent=null,Cr(e)}function Gr(t,r,n,l,o,i){var a=n.flattenSpans;null==a&&(a=t.options.flattenSpans);var s,c=0,u=null,h=new bo(r,t.options.tabSize);for(""==r&&n.blankLine&&n.blankLine(l);!h.eol();){if(h.pos>t.options.maxHighlightLength?(a=!1,i&&Jr(t,r,l,h.pos),h.pos=r.length,s=null):s=n.token(h,l),t.options.addModeClass){var f=e.innerMode(n,l).mode.name;f&&(s="m-"+(s?f+" "+s:f))}a&&u==s||(c<h.start&&o(h.start,u),c=h.start,u=s),h.start=h.pos}for(;c<h.pos;){var g=Math.min(h.pos,c+5e4);o(g,u),c=g}}function Vr(e,t,r,n){var l=[e.state.modeGen];Gr(e,t.text,e.doc.mode,r,function(e,t){l.push(e,t)},n);for(var o=0;o<e.state.overlays.length;++o){var i=e.state.overlays[o],a=1,s=0;Gr(e,t.text,i.mode,!0,function(e,t){for(var r=a;e>s;){var n=l[a];n>e&&l.splice(a,1,e,l[a+1],n),a+=2,s=Math.min(e,n)}if(t)if(i.opaque)l.splice(r,a-r,e,t),a=r+2;else for(;a>r;r+=2){var o=l[r+1];l[r+1]=o?o+" "+t:t}})}return l}function Ur(e,t){return t.styles&&t.styles[0]==e.state.modeGen||(t.styles=Vr(e,t,t.stateAfter=ye(e,gn(t)))),t.styles}function Jr(e,t,r,n){var l=e.doc.mode,o=new bo(t,e.options.tabSize);for(o.start=o.pos=n||0,""==t&&l.blankLine&&l.blankLine(r);!o.eol()&&o.pos<=e.options.maxHighlightLength;)l.token(o,r),o.start=o.pos}function Yr(e,t){if(!e)return null;for(;;){var r=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!r)break;e=e.slice(0,r.index)+e.slice(r.index+r[0].length);var n=r[1]?"bgClass":"textClass";null==t[n]?t[n]=r[2]:new RegExp("(?:^|s)"+r[2]+"(?:$|s)").test(t[n])||(t[n]+=" "+r[2])}if(/^\s*$/.test(e))return null;var l=t.cm.options.addModeClass?Mo:Co;return l[e]||(l[e]=e.replace(/\S+/g,"cm-$&"))}function Kr(e,t){var r=Qn("span",null,null,Cl?"padding-right: .1px":null),n={pre:Qn("pre",[r]),content:r,col:0,pos:0,cm:e};t.measure={};for(var l=0;l<=(t.rest?t.rest.length:0);l++){var o,i=l?t.rest[l-1]:t.line;n.pos=0,n.addToken=Qr,(kl||Cl)&&e.getOption("lineWrapping")&&(n.addToken=$r(n.addToken)),ll(e.display.measure)&&(o=vn(i))&&(n.addToken=Zr(n.addToken,o)),n.map=[],tn(i,n,Ur(e,i)),0==n.map.length&&n.map.push(0,0,n.content.appendChild(nl(e.display.measure))),0==l?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}return Bo(e,"renderLine",e,t.line,n.pre),n}function Xr(e){var t=Qn("span","","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t}function Qr(e,t,r,n,l,o){if(t){var i=e.cm.options.specialChars,a=!1;if(i.test(t))for(var s=document.createDocumentFragment(),c=0;;){i.lastIndex=c;var u=i.exec(t),h=u?u.index-c:t.length-c;if(h){var f=document.createTextNode(t.slice(c,c+h));_l?s.appendChild(Qn("span",[f])):s.appendChild(f),e.map.push(e.pos,e.pos+h,f),e.col+=h,e.pos+=h}if(!u)break;if(c+=h+1,"	"==u[0]){var g=e.cm.options.tabSize,d=g-e.col%g,f=s.appendChild(Qn("span",zn(d),"cm-tab"));e.col+=d}else{var f=e.cm.options.specialCharPlaceholder(u[0]);_l?s.appendChild(Qn("span",[f])):s.appendChild(f),e.col+=1}e.map.push(e.pos,e.pos+1,f),e.pos++}else{e.col+=t.length;var s=document.createTextNode(t);e.map.push(e.pos,e.pos+t.length,s),_l&&(a=!0),e.pos+=t.length}if(r||n||l||a){var p=r||"";n&&(p+=n),l&&(p+=l);var v=Qn("span",[s],p);return o&&(v.title=o),e.content.appendChild(v)}e.content.appendChild(s)}}function $r(e){function t(e){for(var t=" ",r=0;r<e.length-2;++r)t+=r%2?" ":"";return t+=" "}return function(r,n,l,o,i,a){e(r,n.replace(/ {3,}/g,t),l,o,i,a)}}function Zr(e,t){return function(r,n,l,o,i,a){l=l?l+" cm-force-border":"cm-force-border";for(var s=r.pos,c=s+n.length;;){for(var u=0;u<t.length;u++){var h=t[u];if(h.to>s&&h.from<=s)break}if(h.to>=c)return e(r,n,l,o,i,a);e(r,n.slice(0,h.to-s),l,o,null,a),o=null,n=n.slice(h.to-s),s=h.to}}}function en(e,t,r,n){var l=!n&&r.widgetNode;l&&(e.map.push(e.pos,e.pos+t,l),e.content.appendChild(l)),e.pos+=t}function tn(e,t,r){var n=e.markedSpans,l=e.text,o=0;if(n)for(var i,a,s,c,u,h,f=l.length,g=0,d=1,p="",v=0;;){if(v==g){a=s=c=u="",h=null,v=1/0;for(var m=[],b=0;b<n.length;++b){var y=n[b],_=y.marker;y.from<=g&&(null==y.to||y.to>g)?(null!=y.to&&v>y.to&&(v=y.to,s=""),_.className&&(a+=" "+_.className),_.startStyle&&y.from==g&&(c+=" "+_.startStyle),_.endStyle&&y.to==v&&(s+=" "+_.endStyle),_.title&&!u&&(u=_.title),_.collapsed&&(!h||Lr(h.marker,_)<0)&&(h=y)):y.from>g&&v>y.from&&(v=y.from),"bookmark"==_.type&&y.from==g&&_.widgetNode&&m.push(_)}if(h&&(h.from||0)==g&&(en(t,(null==h.to?f+1:h.to)-g,h.marker,null==h.from),null==h.to))return;if(!h&&m.length)for(var b=0;b<m.length;++b)en(t,0,m[b])}if(g>=f)break;for(var w=Math.min(f,v);;){if(p){var x=g+p.length;if(!h){var k=x>w?p.slice(0,w-g):p;t.addToken(t,k,i?i+a:a,c,g+k.length==v?s:"",u)}if(x>=w){p=p.slice(w-g),g=w;break}g=x,c=""}p=l.slice(o,o=r[d++]),i=Yr(r[d++],t)}}else for(var d=1;d<r.length;d+=2)t.addToken(t,l.slice(o,o=r[d]),Yr(r[d+1],t))}function rn(e,t){return 0==t.from.ch&&0==t.to.ch&&""==qn(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function nn(e,t,r,n){function l(e){return r?r[e]:null}function o(e,r,l){zr(e,r,l,n),Nn(e,"change",e,t)}var i=t.from,a=t.to,s=t.text,c=cn(e,i.line),u=cn(e,a.line),h=qn(s),f=l(s.length-1),g=a.line-i.line;if(rn(e,t)){for(var d=0,p=[];d<s.length-1;++d)p.push(new ko(s[d],l(d),n));o(u,u.text,f),g&&e.remove(i.line,g),p.length&&e.insert(i.line,p)}else if(c==u)if(1==s.length)o(c,c.text.slice(0,i.ch)+h+c.text.slice(a.ch),f);else{for(var p=[],d=1;d<s.length-1;++d)p.push(new ko(s[d],l(d),n));p.push(new ko(h+c.text.slice(a.ch),f,n)),o(c,c.text.slice(0,i.ch)+s[0],l(0)),e.insert(i.line+1,p)}else if(1==s.length)o(c,c.text.slice(0,i.ch)+s[0]+u.text.slice(a.ch),l(0)),e.remove(i.line+1,g);else{o(c,c.text.slice(0,i.ch)+s[0],l(0)),o(u,h+u.text.slice(a.ch),f);for(var d=1,p=[];d<s.length-1;++d)p.push(new ko(s[d],l(d),n));g>1&&e.remove(i.line+1,g-1),e.insert(i.line+1,p)}Nn(e,"change",e,t)}function ln(e){this.lines=e,this.parent=null;for(var t=0,r=0;t<e.length;++t)e[t].parent=this,r+=e[t].height;this.height=r}function on(e){this.children=e;for(var t=0,r=0,n=0;n<e.length;++n){var l=e[n];t+=l.chunkSize(),r+=l.height,l.parent=this}this.size=t,this.height=r,this.parent=null}function an(e,t,r){function n(e,l,o){if(e.linked)for(var i=0;i<e.linked.length;++i){var a=e.linked[i];if(a.doc!=l){var s=o&&a.sharedHist;(!r||s)&&(t(a.doc,s),n(a.doc,e,s))}}}n(e,null,!0)}function sn(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,i(e),r(e),e.options.lineWrapping||f(e),e.options.mode=t.modeOption,et(e)}function cn(e,t){if(t-=e.first,0>t||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var r=e;!r.lines;)for(var n=0;;++n){var l=r.children[n],o=l.chunkSize();if(o>t){r=l;break}t-=o}return r.lines[t]}function un(e,t,r){var n=[],l=t.line;return e.iter(t.line,r.line+1,function(e){var o=e.text;l==r.line&&(o=o.slice(0,r.ch)),l==t.line&&(o=o.slice(t.ch)),n.push(o),++l}),n}function hn(e,t,r){var n=[];return e.iter(t,r,function(e){n.push(e.text)}),n}function fn(e,t){var r=t-e.height;if(r)for(var n=e;n;n=n.parent)n.height+=r}function gn(e){if(null==e.parent)return null;for(var t=e.parent,r=Gn(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(var l=0;n.children[l]!=t;++l)r+=n.children[l].chunkSize();return r+t.first}function dn(e,t){var r=e.first;e:do{for(var n=0;n<e.children.length;++n){var l=e.children[n],o=l.height;if(o>t){e=l;continue e}t-=o,r+=l.chunkSize()}return r}while(!e.lines);for(var n=0;n<e.lines.length;++n){var i=e.lines[n],a=i.height;if(a>t)break;t-=a}return r+n}function pn(e){e=Ar(e);for(var t=0,r=e.parent,n=0;n<r.lines.length;++n){var l=r.lines[n];if(l==e)break;t+=l.height}for(var o=r.parent;o;r=o,o=r.parent)for(var n=0;n<o.children.length;++n){var i=o.children[n];if(i==r)break;t+=i.height}return t}function vn(e){var t=e.order;return null==t&&(t=e.order=oi(e.text)),t}function mn(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function bn(e,t){var r={from:W(t.from),to:to(t),text:un(e,t.from,t.to)};return Mn(e,r,t.from.line,t.to.line+1),an(e,function(e){Mn(e,r,t.from.line,t.to.line+1)},!0),r}function yn(e){for(;e.length;){var t=qn(e);if(!t.ranges)break;e.pop()}}function _n(e,t){return t?(yn(e.done),qn(e.done)):e.done.length&&!qn(e.done).ranges?qn(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),qn(e.done)):void 0}function wn(e,t,r,n){var l=e.history;l.undone.length=0;var o,i=+new Date;if((l.lastOp==n||l.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&l.lastModTime>i-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(o=_n(l,l.lastOp==n))){var a=qn(o.changes);0==ql(t.from,t.to)&&0==ql(t.from,a.to)?a.to=to(t):o.changes.push(bn(e,t))}else{var s=qn(l.done);for(s&&s.ranges||Cn(e.sel,l.done),o={changes:[bn(e,t)],generation:l.generation},l.done.push(o);l.done.length>l.undoDepth;)l.done.shift(),l.done[0].ranges||l.done.shift()}l.done.push(r),l.generation=++l.maxGeneration,l.lastModTime=l.lastSelTime=i,l.lastOp=n,l.lastOrigin=l.lastSelOrigin=t.origin,a||Bo(e,"historyAdded")}function xn(e,t,r,n){var l=t.charAt(0);return"*"==l||"+"==l&&r.ranges.length==n.ranges.length&&r.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function kn(e,t,r,n){var l=e.history,o=n&&n.origin;r==l.lastOp||o&&l.lastSelOrigin==o&&(l.lastModTime==l.lastSelTime&&l.lastOrigin==o||xn(e,o,qn(l.done),t))?l.done[l.done.length-1]=t:Cn(t,l.done),l.lastSelTime=+new Date,l.lastSelOrigin=o,l.lastOp=r,n&&n.clearRedo!==!1&&yn(l.undone)}function Cn(e,t){var r=qn(t);r&&r.ranges&&r.equals(e)||t.push(e)}function Mn(e,t,r,n){var l=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,r),Math.min(e.first+e.size,n),function(r){r.markedSpans&&((l||(l=t["spans_"+e.id]={}))[o]=r.markedSpans),++o})}function Sn(e){if(!e)return null;for(var t,r=0;r<e.length;++r)e[r].marker.explicitlyCleared?t||(t=e.slice(0,r)):t&&t.push(e[r]);return t?t.length?t:null:e}function En(e,t){var r=t["spans_"+e.id];if(!r)return null;for(var n=0,l=[];n<t.text.length;++n)l.push(Sn(r[n]));return l}function Ln(e,t,r){for(var n=0,l=[];n<e.length;++n){var o=e[n];if(o.ranges)l.push(r?G.prototype.deepCopy.call(o):o);else{var i=o.changes,a=[];l.push({changes:a});for(var s=0;s<i.length;++s){var c,u=i[s];if(a.push({from:u.from,to:u.to,text:u.text}),t)for(var h in u)(c=h.match(/^spans_(\d+)$/))&&Gn(t,Number(c[1]))>-1&&(qn(a)[h]=u[h],delete u[h])}}}return l}function Tn(e,t,r,n){r<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function In(e,t,r,n){for(var l=0;l<e.length;++l){var o=e[l],i=!0;if(o.ranges){o.copied||(o=e[l]=o.deepCopy(),o.copied=!0);for(var a=0;a<o.ranges.length;a++)Tn(o.ranges[a].anchor,t,r,n),Tn(o.ranges[a].head,t,r,n)}else{for(var a=0;a<o.changes.length;++a){var s=o.changes[a];if(r<s.from.line)s.from=zl(s.from.line+n,s.from.ch),s.to=zl(s.to.line+n,s.to.ch);else if(t<=s.to.line){i=!1;break}}i||(e.splice(0,l+1),l=0)}}}function Rn(e,t){var r=t.from.line,n=t.to.line,l=t.text.length-(n-r)-1;In(e.done,r,n,l),In(e.undone,r,n,l)}function On(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function An(e){return e.target||e.srcElement}function Dn(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),Nl&&e.ctrlKey&&1==t&&(t=3),t}function Nn(e,t){function r(e){return function(){e.apply(null,l)}}var n=e._handlers&&e._handlers[t];if(n){var l=Array.prototype.slice.call(arguments,2);Io||(++Po,Io=[],setTimeout(Bn,0));for(var o=0;o<n.length;++o)Io.push(r(n[o]))}}function Bn(){--Po;var e=Io;Io=null;for(var t=0;t<e.length;++t)e[t]()}function Pn(e,t,r){return Bo(e,r||t.type,e,t),On(t)||t.codemirrorIgnore}function Fn(e,t){var r=e._handlers&&e._handlers[t];return r&&r.length>0}function jn(e){e.prototype.on=function(e,t){Do(this,e,t)},e.prototype.off=function(e,t){No(this,e,t)}}function Hn(){this.id=null}function Wn(e,t,r){for(var n=0,l=0;;){var o=e.indexOf("	",n);-1==o&&(o=e.length);var i=o-n;if(o==e.length||l+i>=t)return n+Math.min(i,t-l);if(l+=o-n,l+=r-l%r,n=o+1,l>=t)return n}}function zn(e){for(;Go.length<=e;)Go.push(qn(Go)+" ");return Go[e]}function qn(e){return e[e.length-1]}function Gn(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return r;return-1}function Vn(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=t(e[n],n);return r}function Un(e,t){var r;if(Object.create)r=Object.create(e);else{var n=function(){};n.prototype=e,r=new n}return t&&Jn(t,r),r}function Jn(e,t){t||(t={});for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function Yn(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function Kn(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function Xn(e){return e.charCodeAt(0)>=768&&Ko.test(e)}function Qn(e,t,r,n){var l=document.createElement(e);if(r&&(l.className=r),n&&(l.style.cssText=n),"string"==typeof t)l.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)l.appendChild(t[o]);return l}function $n(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function Zn(e,t){return $n(e).appendChild(t)}function el(e,t){if(e.contains)return e.contains(t);for(;t=t.parentNode;)if(t==e)return!0}function tl(){return document.activeElement}function rl(e){if(null!=Xo)return Xo;var t=Qn("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return Zn(e,t),t.offsetWidth&&(Xo=t.offsetHeight-t.clientHeight),Xo||0}function nl(e){if(null==Qo){var t=Qn("span","");Zn(e,Qn("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Qo=t.offsetWidth<=1&&t.offsetHeight>2&&!yl)}return Qo?Qn("span",""):Qn("span","",null,"display: inline-block; width: 1px; margin-right: -1px")}function ll(e){if(null!=$o)return $o;var t=Zn(e,document.createTextNode("AA")),r=Uo(t,0,1).getBoundingClientRect();if(r.left==r.right)return!1;var n=Uo(t,1,2).getBoundingClientRect();return $o=n.right-r.right<3}function ol(e,t,r,n){if(!e)return n(t,r,"ltr");for(var l=!1,o=0;o<e.length;++o){var i=e[o];(i.from<r&&i.to>t||t==r&&i.to==t)&&(n(Math.max(i.from,t),Math.min(i.to,r),1==i.level?"rtl":"ltr"),l=!0)}l||n(t,r,"ltr")}function il(e){return e.level%2?e.to:e.from}function al(e){return e.level%2?e.from:e.to}function sl(e){var t=vn(e);return t?il(t[0]):0}function cl(e){var t=vn(e);return t?al(qn(t)):e.text.length}function ul(e,t){var r=cn(e.doc,t),n=Ar(r);n!=r&&(t=gn(n));var l=vn(n),o=l?l[0].level%2?cl(n):sl(n):0;return zl(t,o)}function hl(e,t){for(var r,n=cn(e.doc,t);r=Rr(n);)n=r.find(1,!0).line,t=null;var l=vn(n),o=l?l[0].level%2?sl(n):cl(n):n.text.length;return zl(null==t?gn(n):t,o)}function fl(e,t,r){var n=e[0].level;return t==n?!0:r==n?!1:r>t}function gl(e,t){li=null;for(var r,n=0;n<e.length;++n){var l=e[n];if(l.from<t&&l.to>t)return n;if(l.from==t||l.to==t){if(null!=r)return fl(e,l.level,e[r].level)?(l.from!=l.to&&(li=r),n):(l.from!=l.to&&(li=n),r);r=n}}return r}function dl(e,t,r,n){if(!n)return t+r;do t+=r;while(t>0&&Xn(e.text.charAt(t)));return t}function pl(e,t,r,n){var l=vn(e);if(!l)return vl(e,t,r,n);for(var o=gl(l,t),i=l[o],a=dl(e,t,i.level%2?-r:r,n);;){if(a>i.from&&a<i.to)return a;if(a==i.from||a==i.to)return gl(l,a)==o?a:(i=l[o+=r],r>0==i.level%2?i.to:i.from);if(i=l[o+=r],!i)return null;a=r>0==i.level%2?dl(e,i.to,-1,n):dl(e,i.from,1,n)}}function vl(e,t,r,n){var l=t+r;if(n)for(;l>0&&Xn(e.text.charAt(l));)l+=r;return 0>l||l>e.text.length?null:l}var ml=/gecko\/\d/i.test(navigator.userAgent),bl=/MSIE \d/.test(navigator.userAgent),yl=bl&&(null==document.documentMode||document.documentMode<8),_l=bl&&(null==document.documentMode||document.documentMode<9),wl=bl&&(null==document.documentMode||document.documentMode<10),xl=/Trident\/([7-9]|\d{2,})\./.test(navigator.userAgent),kl=bl||xl,Cl=/WebKit\//.test(navigator.userAgent),Ml=Cl&&/Qt\/\d+\.\d+/.test(navigator.userAgent),Sl=/Chrome\//.test(navigator.userAgent),El=/Opera\//.test(navigator.userAgent),Ll=/Apple Computer/.test(navigator.vendor),Tl=/KHTML\//.test(navigator.userAgent),Il=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),Rl=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Ol=/PhantomJS/.test(navigator.userAgent),Al=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Dl=Al||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),Nl=Al||/Mac/.test(navigator.platform),Bl=/win/i.test(navigator.platform),Pl=El&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);Pl&&(Pl=Number(Pl[1])),Pl&&Pl>=15&&(El=!1,Cl=!0);var Fl=Nl&&(Ml||El&&(null==Pl||12.11>Pl)),jl=ml||kl&&!_l,Hl=!1,Wl=!1,zl=e.Pos=function(e,t){return this instanceof zl?(this.line=e,void(this.ch=t)):new zl(e,t)},ql=e.cmpPos=function(e,t){return e.line-t.line||e.ch-t.ch};G.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var r=this.ranges[t],n=e.ranges[t];if(0!=ql(r.anchor,n.anchor)||0!=ql(r.head,n.head))return!1}return!0},deepCopy:function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new V(W(this.ranges[t].anchor),W(this.ranges[t].head));return new G(e,this.primIndex)},somethingSelected:function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},contains:function(e,t){t||(t=e);for(var r=0;r<this.ranges.length;r++){var n=this.ranges[r];if(ql(t,n.from())>=0&&ql(e,n.to())<=0)return r}return-1}},V.prototype={from:function(){return q(this.anchor,this.head)},to:function(){return z(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var Gl,Vl,Ul,Jl={left:0,right:0,top:0,bottom:0},Yl=0,Kl=0,Xl=0,Ql=null;kl?Ql=-.53:ml?Ql=15:Sl?Ql=-.7:Ll&&(Ql=-1/3);var $l,Zl,eo=null,to=e.changeEnd=function(e){return e.text?zl(e.from.line+e.text.length-1,qn(e.text).length+(1==e.text.length?e.from.ch:0)):e.to};e.prototype={constructor:e,posFromMouse:function(e){return vt(this,e,!0)},focus:function(){window.focus(),ht(this),st(this)},setOption:function(e,t){var r=this.options,n=r[e];(r[e]!=t||"mode"==e)&&(r[e]=t,no.hasOwnProperty(e)&&Ke(this,no[e])(this,t,n))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](e)},removeKeyMap:function(e){for(var t=this.state.keyMaps,r=0;r<t.length;++r)if(t[r]==e||"string"!=typeof t[r]&&t[r].name==e)return t.splice(r,1),!0},addOverlay:Xe(function(t,r){var n=t.token?t:e.getMode(this.options,t);if(n.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:n,modeSpec:t,opaque:r&&r.opaque}),this.state.modeGen++,et(this)}),removeOverlay:Xe(function(e){for(var t=this.state.overlays,r=0;r<t.length;++r){var n=t[r].modeSpec;if(n==e||"string"==typeof e&&n.name==e)return t.splice(r,1),this.state.modeGen++,void et(this)}}),indentLine:Xe(function(e,t,r){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),Q(this.doc,e)&&lr(this,e,t,r)}),indentSelection:Xe(function(e){for(var t=this.doc.sel.ranges,r=-1,n=0;n<t.length;n++){var l=t[n];if(l.empty())l.head.line>r&&(lr(this,l.head.line,e,!0),r=l.head.line,n==this.doc.sel.primIndex&&rr(this));else{var o=Math.max(r,l.from().line),i=l.to();r=Math.min(this.lastLine(),i.line-(i.ch?0:1))+1;for(var a=o;r>a;++a)lr(this,a,e)}}}),getTokenAt:function(e,t){var r=this.doc;e=K(r,e);for(var n=ye(this,e.line,t),l=this.doc.mode,o=cn(r,e.line),i=new bo(o.text,this.options.tabSize);i.pos<e.ch&&!i.eol();){i.start=i.pos;var a=l.token(i,n)}return{start:i.start,end:i.pos,string:i.current(),type:a||null,state:n}},getTokenTypeAt:function(e){e=K(this.doc,e);var t=Ur(this,cn(this.doc,e.line)),r=0,n=(t.length-1)/2,l=e.ch;if(0==l)return t[2];for(;;){var o=r+n>>1;if((o?t[2*o-1]:0)>=l)n=o;else{if(!(t[2*o+1]<l))return t[2*o+2];r=o+1}}},getModeAt:function(t){var r=this.doc.mode;return r.innerMode?e.innerMode(r,this.getTokenAt(t).state).mode:r},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var r=[];if(!co.hasOwnProperty(t))return co;var n=co[t],l=this.getModeAt(e);if("string"==typeof l[t])n[l[t]]&&r.push(n[l[t]]);else if(l[t])for(var o=0;o<l[t].length;o++){var i=n[l[t][o]];i&&r.push(i)}else l.helperType&&n[l.helperType]?r.push(n[l.helperType]):n[l.name]&&r.push(n[l.name]);for(var o=0;o<n._global.length;o++){var a=n._global[o];a.pred(l,this)&&-1==Gn(r,a.val)&&r.push(a.val)}return r},getStateAfter:function(e,t){var r=this.doc;return e=Y(r,null==e?r.first+r.size-1:e),ye(this,e+1,t)},cursorCoords:function(e,t){var r,n=this.doc.sel.primary();return r=null==e?n.head:"object"==typeof e?K(this.doc,e):e?n.from():n.to(),je(this,r,t||"page")},charCoords:function(e,t){return Fe(this,K(this.doc,e),t||"page")},coordsChar:function(e,t){return e=Pe(this,e,t||"page"),ze(this,e.left,e.top)},lineAtHeight:function(e,t){return e=Pe(this,{top:e,left:0},t||"page").top,dn(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t){var r=!1,n=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>n&&(e=n,r=!0);var l=cn(this.doc,e);return Be(this,l,{top:0,left:0},t||"page").top+(r?this.doc.height-pn(l):0)},defaultTextHeight:function(){return Ge(this.display)},defaultCharWidth:function(){return Ve(this.display)},setGutterMarker:Xe(function(e,t,r){return or(this,e,"gutter",function(e){var n=e.gutterMarkers||(e.gutterMarkers={});return n[t]=r,!r&&Kn(n)&&(e.gutterMarkers=null),!0})}),clearGutter:Xe(function(e){var t=this,r=t.doc,n=r.first;r.iter(function(r){r.gutterMarkers&&r.gutterMarkers[e]&&(r.gutterMarkers[e]=null,tt(t,n,"gutter"),Kn(r.gutterMarkers)&&(r.gutterMarkers=null)),++n})}),addLineClass:Xe(function(e,t,r){return or(this,e,"class",function(e){var n="text"==t?"textClass":"background"==t?"bgClass":"wrapClass";if(e[n]){if(new RegExp("(?:^|\\s)"+r+"(?:$|\\s)").test(e[n]))return!1;e[n]+=" "+r}else e[n]=r;return!0})}),removeLineClass:Xe(function(e,t,r){return or(this,e,"class",function(e){var n="text"==t?"textClass":"background"==t?"bgClass":"wrapClass",l=e[n];if(!l)return!1;if(null==r)e[n]=null;else{var o=l.match(new RegExp("(?:^|\\s+)"+r+"(?:$|\\s+)"));if(!o)return!1;var i=o.index+o[0].length;e[n]=l.slice(0,o.index)+(o.index&&i!=l.length?" ":"")+l.slice(i)||null}return!0})}),addLineWidget:Xe(function(e,t,r){return Wr(this,e,t,r)}),removeLineWidget:function(e){e.clear()},lineInfo:function(e){if("number"==typeof e){if(!Q(this.doc,e))return null;var t=e;if(e=cn(this.doc,e),!e)return null}else{var t=gn(e);if(null==t)return null}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,r,n,l){var o=this.display;e=je(this,K(this.doc,e));var i=e.bottom,a=e.left;if(t.style.position="absolute",o.sizer.appendChild(t),"over"==n)i=e.top;else if("above"==n||"near"==n){var s=Math.max(o.wrapper.clientHeight,this.doc.height),c=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||e.bottom+t.offsetHeight>s)&&e.top>t.offsetHeight?i=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=s&&(i=e.bottom),a+t.offsetWidth>c&&(a=c-t.offsetWidth)}t.style.top=i+"px",t.style.left=t.style.right="","right"==l?(a=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==l?a=0:"middle"==l&&(a=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=a+"px"),r&&Zt(this,a,i,a+t.offsetWidth,i+t.offsetHeight)},triggerOnKeyDown:Xe(Ot),triggerOnKeyPress:Xe(Dt),triggerOnKeyUp:Xe(At),execCommand:function(e){return fo.hasOwnProperty(e)?fo[e](this):void 0},findPosH:function(e,t,r,n){var l=1;0>t&&(l=-1,t=-t);for(var o=0,i=K(this.doc,e);t>o&&(i=ar(this.doc,i,l,r,n),!i.hitSide);++o);return i},moveH:Xe(function(e,t){var r=this;r.extendSelectionsBy(function(n){return r.display.shift||r.doc.extend||n.empty()?ar(r.doc,n.head,e,t,r.options.rtlMoveVisually):0>e?n.from():n.to()},zo)}),deleteH:Xe(function(e,t){var r=this.doc.sel,n=this.doc;r.somethingSelected()?n.replaceSelection("",null,"+delete"):ir(this,function(r){var l=ar(n,r.head,e,t,!1);return 0>e?{from:l,to:r.head}:{from:r.head,to:l}})}),findPosV:function(e,t,r,n){var l=1,o=n;0>t&&(l=-1,t=-t);for(var i=0,a=K(this.doc,e);t>i;++i){var s=je(this,a,"div");if(null==o?o=s.left:s.left=o,a=sr(this,s,l,r),a.hitSide)break}return a},moveV:Xe(function(e,t){var r=this,n=this.doc,l=[],o=!r.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy(function(i){if(o)return 0>e?i.from():i.to();var a=je(r,i.head,"div");null!=i.goalColumn&&(a.left=i.goalColumn),l.push(a.left);var s=sr(r,a,e,t);return"page"==t&&i==n.sel.primary()&&tr(r,null,Fe(r,s,"div").top-a.top),s},zo),l.length)for(var i=0;i<n.sel.ranges.length;i++)n.sel.ranges[i].goalColumn=l[i]}),toggleOverwrite:function(e){(null==e||e!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?this.display.cursorDiv.className+=" CodeMirror-overwrite":this.display.cursorDiv.className=this.display.cursorDiv.className.replace(" CodeMirror-overwrite",""),Bo(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return tl()==this.display.input},scrollTo:Xe(function(e,t){(null!=e||null!=t)&&nr(this),null!=e&&(this.curOp.scrollLeft=e),null!=t&&(this.curOp.scrollTop=t)}),getScrollInfo:function(){var e=this.display.scroller,t=Fo;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-t,width:e.scrollWidth-t,clientHeight:e.clientHeight-t,clientWidth:e.clientWidth-t}},scrollIntoView:Xe(function(e,t){if(null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:zl(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line)nr(this),this.curOp.scrollToPos=e;else{var r=er(this,Math.min(e.from.left,e.to.left),Math.min(e.from.top,e.to.top)-e.margin,Math.max(e.from.right,e.to.right),Math.max(e.from.bottom,e.to.bottom)+e.margin);this.scrollTo(r.scrollLeft,r.scrollTop)}}),setSize:Xe(function(e,t){function r(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e}null!=e&&(this.display.wrapper.style.width=r(e)),null!=t&&(this.display.wrapper.style.height=r(t)),this.options.lineWrapping&&Oe(this),this.curOp.forceUpdate=!0,Bo(this,"refresh",this)}),operation:function(e){return Ye(this,e)},refresh:Xe(function(){var e=this.display.cachedTextHeight;et(this),Ae(this),this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop),(null==e||Math.abs(e-Ge(this.display))>.5)&&i(this),Bo(this,"refresh",this)}),swapDoc:Xe(function(e){var t=this.doc;return t.cm=null,sn(this,e),Ae(this),ut(this),this.scrollTo(e.scrollLeft,e.scrollTop),Nn(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},jn(e);var ro=e.defaults={},no=e.optionHandlers={},lo=e.Init={toString:function(){return"CodeMirror.Init"}};ur("value","",function(e,t){e.setValue(t)},!0),ur("mode",null,function(e,t){e.doc.modeOption=t,r(e)},!0),ur("indentUnit",2,r,!0),ur("indentWithTabs",!1),ur("smartIndent",!0),ur("tabSize",4,function(e){n(e),Ae(e),et(e)},!0),ur("specialChars",/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\ufeff]/g,function(e,t){e.options.specialChars=new RegExp(t.source+(t.test("	")?"":"|	"),"g"),e.refresh()},!0),ur("specialCharPlaceholder",Xr,function(e){e.refresh()},!0),ur("electricChars",!0),ur("rtlMoveVisually",!Bl),ur("wholeLineUpdateBefore",!0),ur("theme","default",function(e){s(e),c(e)},!0),ur("keyMap","default",a),ur("extraKeys",null),ur("lineWrapping",!1,l,!0),ur("gutters",[],function(e){
g(e.options),c(e)},!0),ur("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?_(e.display)+"px":"0",e.refresh()},!0),ur("coverGutterNextToScrollbar",!1,p,!0),ur("lineNumbers",!1,function(e){g(e.options),c(e)},!0),ur("firstLineNumber",1,c,!0),ur("lineNumberFormatter",function(e){return e},c,!0),ur("showCursorWhenSelecting",!1,fe,!0),ur("resetSelectionOnContextMenu",!0),ur("readOnly",!1,function(e,t){"nocursor"==t?(Bt(e),e.display.input.blur(),e.display.disabled=!0):(e.display.disabled=!1,t||ut(e))}),ur("disableInput",!1,function(e,t){t||ut(e)},!0),ur("dragDrop",!0),ur("cursorBlinkRate",530),ur("cursorScrollMargin",0),ur("cursorHeight",1),ur("workTime",100),ur("workDelay",100),ur("flattenSpans",!0,n,!0),ur("addModeClass",!1,n,!0),ur("pollInterval",100),ur("undoDepth",200,function(e,t){e.doc.history.undoDepth=t}),ur("historyEventDelay",1250),ur("viewportMargin",10,function(e){e.refresh()},!0),ur("maxHighlightLength",1e4,n,!0),ur("moveInputWithCursor",!0,function(e,t){t||(e.display.inputDiv.style.top=e.display.inputDiv.style.left=0)}),ur("tabindex",null,function(e,t){e.display.input.tabIndex=t||""}),ur("autofocus",null);var oo=e.modes={},io=e.mimeModes={};e.defineMode=function(t,r){if(e.defaults.mode||"null"==t||(e.defaults.mode=t),arguments.length>2){r.dependencies=[];for(var n=2;n<arguments.length;++n)r.dependencies.push(arguments[n])}oo[t]=r},e.defineMIME=function(e,t){io[e]=t},e.resolveMode=function(t){if("string"==typeof t&&io.hasOwnProperty(t))t=io[t];else if(t&&"string"==typeof t.name&&io.hasOwnProperty(t.name)){var r=io[t.name];"string"==typeof r&&(r={name:r}),t=Un(r,t),t.name=r.name}else if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return e.resolveMode("application/xml");return"string"==typeof t?{name:t}:t||{name:"null"}},e.getMode=function(t,r){var r=e.resolveMode(r),n=oo[r.name];if(!n)return e.getMode(t,"text/plain");var l=n(t,r);if(ao.hasOwnProperty(r.name)){var o=ao[r.name];for(var i in o)o.hasOwnProperty(i)&&(l.hasOwnProperty(i)&&(l["_"+i]=l[i]),l[i]=o[i])}if(l.name=r.name,r.helperType&&(l.helperType=r.helperType),r.modeProps)for(var i in r.modeProps)l[i]=r.modeProps[i];return l},e.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),e.defineMIME("text/plain","null");var ao=e.modeExtensions={};e.extendMode=function(e,t){var r=ao.hasOwnProperty(e)?ao[e]:ao[e]={};Jn(t,r)},e.defineExtension=function(t,r){e.prototype[t]=r},e.defineDocExtension=function(e,t){Eo.prototype[e]=t},e.defineOption=ur;var so=[];e.defineInitHook=function(e){so.push(e)};var co=e.helpers={};e.registerHelper=function(t,r,n){co.hasOwnProperty(t)||(co[t]=e[t]={_global:[]}),co[t][r]=n},e.registerGlobalHelper=function(t,r,n,l){e.registerHelper(t,r,l),co[t]._global.push({pred:n,val:l})};var uo=e.copyState=function(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var r={};for(var n in t){var l=t[n];l instanceof Array&&(l=l.concat([])),r[n]=l}return r},ho=e.startState=function(e,t,r){return e.startState?e.startState(t,r):!0};e.innerMode=function(e,t){for(;e.innerMode;){var r=e.innerMode(t);if(!r||r.mode==e)break;t=r.state,e=r.mode}return r||{mode:e,state:t}};var fo=e.commands={selectAll:function(e){e.setSelection(zl(e.firstLine(),0),zl(e.lastLine()),Ho)},singleSelection:function(e){e.setSelection(e.getCursor("anchor"),e.getCursor("head"),Ho)},killLine:function(e){ir(e,function(t){if(t.empty()){var r=cn(e.doc,t.head.line).text.length;return t.head.ch==r&&t.head.line<e.lastLine()?{from:t.head,to:zl(t.head.line+1,0)}:{from:t.head,to:zl(t.head.line,r)}}return{from:t.from(),to:t.to()}})},deleteLine:function(e){ir(e,function(t){return{from:zl(t.from().line,0),to:K(e.doc,zl(t.to().line+1,0))}})},delLineLeft:function(e){ir(e,function(e){return{from:zl(e.from().line,0),to:e.from()}})},undo:function(e){e.undo()},redo:function(e){e.redo()},undoSelection:function(e){e.undoSelection()},redoSelection:function(e){e.redoSelection()},goDocStart:function(e){e.extendSelection(zl(e.firstLine(),0))},goDocEnd:function(e){e.extendSelection(zl(e.lastLine()))},goLineStart:function(e){e.extendSelectionsBy(function(t){return ul(e,t.head.line)},zo)},goLineStartSmart:function(e){e.extendSelectionsBy(function(t){var r=ul(e,t.head.line),n=e.getLineHandle(r.line),l=vn(n);if(!l||0==l[0].level){var o=Math.max(0,n.text.search(/\S/)),i=t.head.line==r.line&&t.head.ch<=o&&t.head.ch;return zl(r.line,i?0:o)}return r},zo)},goLineEnd:function(e){e.extendSelectionsBy(function(t){return hl(e,t.head.line)},zo)},goLineRight:function(e){e.extendSelectionsBy(function(t){var r=e.charCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div")},zo)},goLineLeft:function(e){e.extendSelectionsBy(function(t){var r=e.charCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:r},"div")},zo)},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goGroupRight:function(e){e.moveH(1,"group")},goGroupLeft:function(e){e.moveH(-1,"group")},goWordRight:function(e){e.moveH(1,"word")},delCharBefore:function(e){e.deleteH(-1,"char")},delCharAfter:function(e){e.deleteH(1,"char")},delWordBefore:function(e){e.deleteH(-1,"word")},delWordAfter:function(e){e.deleteH(1,"word")},delGroupBefore:function(e){e.deleteH(-1,"group")},delGroupAfter:function(e){e.deleteH(1,"group")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("	")},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){Ye(e,function(){for(var t=e.listSelections(),r=0;r<t.length;r++){var n=t[r].head,l=cn(e.doc,n.line).text;n.ch>0&&n.ch<l.length-1&&e.replaceRange(l.charAt(n.ch)+l.charAt(n.ch-1),zl(n.line,n.ch-1),zl(n.line,n.ch+1))}})},newlineAndIndent:function(e){Ye(e,function(){for(var t=e.listSelections().length,r=0;t>r;r++){var n=e.listSelections()[r];e.replaceRange("\n",n.anchor,n.head,"+input"),e.indentLine(n.from().line+1,null,!0),rr(e)}})},toggleOverwrite:function(e){e.toggleOverwrite()}},go=e.keyMap={};go.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},go.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},go.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection",fallthrough:["basic","emacsy"]},go.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},go["default"]=Nl?go.macDefault:go.pcDefault;var po=e.lookupKey=function(e,t,r){function n(t){for(var l=!0;l;){var o=t;l=!1,o=hr(o);var i=o[e];if(i===!1)return"stop";if(null!=i&&r(i))return!0;if(o.nofallthrough)return"stop";var a=o.fallthrough;if(null==a)return!1;if("[object Array]"==Object.prototype.toString.call(a)){for(var s=0;s<a.length;++s){var c=n(a[s]);if(c)return c}return!1}t=a,l=!0,i=a=void 0}}for(var l=0;l<t.length;++l){var o=n(t[l]);if(o)return"stop"!=o}},vo=e.isModifierKey=function(e){var t=ni[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t},mo=e.keyName=function(e,t){if(El&&34==e.keyCode&&e["char"])return!1;var r=ni[e.keyCode];return null==r||e.altGraphKey?!1:(e.altKey&&(r="Alt-"+r),(Fl?e.metaKey:e.ctrlKey)&&(r="Ctrl-"+r),(Fl?e.ctrlKey:e.metaKey)&&(r="Cmd-"+r),!t&&e.shiftKey&&(r="Shift-"+r),r)};e.fromTextArea=function(t,r){function n(){t.value=c.getValue()}if(r||(r={}),r.value=t.value,!r.tabindex&&t.tabindex&&(r.tabindex=t.tabindex),!r.placeholder&&t.placeholder&&(r.placeholder=t.placeholder),null==r.autofocus){var l=tl();r.autofocus=l==t||null!=t.getAttribute("autofocus")&&l==document.body}if(t.form&&(Do(t.form,"submit",n),!r.leaveSubmitMethodAlone)){var o=t.form,i=o.submit;try{var a=o.submit=function(){n(),o.submit=i,o.submit(),o.submit=a}}catch(s){}}t.style.display="none";var c=e(function(e){t.parentNode.insertBefore(e,t.nextSibling)},r);return c.save=n,c.getTextArea=function(){return t},c.toTextArea=function(){n(),t.parentNode.removeChild(c.getWrapperElement()),t.style.display="",t.form&&(No(t.form,"submit",n),"function"==typeof t.form.submit&&(t.form.submit=i))},c};var bo=e.StringStream=function(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};bo.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(e){var t=this.string.charAt(this.pos);if("string"==typeof e)var r=t==e;else var r=t&&(e.test?e.test(t):e(t));return r?(++this.pos,t):void 0},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);return t>-1?(this.pos=t,!0):void 0},backUp:function(e){this.pos-=e},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=qo(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?qo(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return qo(this.string,null,this.tabSize)-(this.lineStart?qo(this.string,this.lineStart,this.tabSize):0)},match:function ii(e,t,r){if("string"!=typeof e){var ii=this.string.slice(this.pos).match(e);return ii&&ii.index>0?null:(ii&&t!==!1&&(this.pos+=ii[0].length),ii)}var n=function(e){return r?e.toLowerCase():e},l=this.string.substr(this.pos,e.length);return n(l)==n(e)?(t!==!1&&(this.pos+=e.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}};var yo=e.TextMarker=function(e,t){this.lines=[],this.type=t,this.doc=e};jn(yo),yo.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&Ue(e),Fn(this,"clear")){var r=this.find();r&&Nn(this,"clear",r.from,r.to)}for(var n=null,l=null,o=0;o<this.lines.length;++o){var i=this.lines[o],a=pr(i.markedSpans,this);e&&!this.collapsed?tt(e,gn(i),"text"):e&&(null!=a.to&&(l=gn(i)),null!=a.from&&(n=gn(i))),i.markedSpans=vr(i.markedSpans,a),null==a.from&&this.collapsed&&!Pr(this.doc,i)&&e&&fn(i,Ge(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var o=0;o<this.lines.length;++o){var s=Ar(this.lines[o]),c=h(s);c>e.display.maxLineLength&&(e.display.maxLine=s,e.display.maxLineLength=c,e.display.maxLineChanged=!0)}null!=n&&e&&this.collapsed&&et(e,n,l+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&ce(e.doc)),e&&Nn(e,"markerCleared",e,this),t&&Je(e)}},yo.prototype.find=function(e,t){null==e&&"bookmark"==this.type&&(e=1);for(var r,n,l=0;l<this.lines.length;++l){var o=this.lines[l],i=pr(o.markedSpans,this);if(null!=i.from&&(r=zl(t?o:gn(o),i.from),-1==e))return r;if(null!=i.to&&(n=zl(t?o:gn(o),i.to),1==e))return n}return r&&{from:r,to:n}},yo.prototype.changed=function(){var e=this.find(-1,!0),t=this,r=this.doc.cm;e&&r&&Ye(r,function(){var n=e.line,l=gn(e.line),o=Ee(r,l);if(o&&(Re(o),r.curOp.selectionChanged=r.curOp.forceUpdate=!0),r.curOp.updateMaxLine=!0,!Pr(t.doc,n)&&null!=t.height){var i=t.height;t.height=null;var a=Hr(t)-i;a&&fn(n,n.height+a)}})},yo.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=Gn(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},yo.prototype.detachLine=function(e){if(this.lines.splice(Gn(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}};var _o=0,wo=e.SharedTextMarker=function(e,t){this.markers=e,this.primary=t;for(var r=0,n=this;r<e.length;++r)e[r].parent=this,Do(e[r],"clear",function(){n.clear()})};jn(wo),wo.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();Nn(this,"clear")}},wo.prototype.find=function(e,t){return this.primary.find(e,t)};var xo=e.LineWidget=function(e,t,r){if(r)for(var n in r)r.hasOwnProperty(n)&&(this[n]=r[n]);this.cm=e,this.node=t};jn(xo),xo.prototype.clear=function(){var e=this.cm,t=this.line.widgets,r=this.line,n=gn(r);if(null!=n&&t){for(var l=0;l<t.length;++l)t[l]==this&&t.splice(l--,1);t.length||(r.widgets=null);var o=Hr(this);Ye(e,function(){jr(e,r,-o),tt(e,n,"widget"),fn(r,Math.max(0,r.height-o))})}},xo.prototype.changed=function(){var e=this.height,t=this.cm,r=this.line;this.height=null;var n=Hr(this)-e;n&&Ye(t,function(){t.curOp.forceUpdate=!0,jr(t,r,n),fn(r,r.height+n)})};var ko=e.Line=function(e,t,r){this.text=e,Mr(this,t),this.height=r?r(this):1};jn(ko),ko.prototype.lineNo=function(){return gn(this)};var Co={},Mo={};ln.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var r=e,n=e+t;n>r;++r){var l=this.lines[r];this.height-=l.height,qr(l),Nn(l,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,r){this.height+=r,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var n=0;n<t.length;++n)t[n].parent=this},iterN:function(e,t,r){for(var n=e+t;n>e;++e)if(r(this.lines[e]))return!0}},on.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var r=0;r<this.children.length;++r){var n=this.children[r],l=n.chunkSize();if(l>e){var o=Math.min(t,l-e),i=n.height;if(n.removeInner(e,o),this.height-=i-n.height,l==o&&(this.children.splice(r--,1),n.parent=null),0==(t-=o))break;e=0}else e-=l}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof ln))){var a=[];this.collapse(a),this.children=[new ln(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,r){this.size+=t.length,this.height+=r;for(var n=0;n<this.children.length;++n){var l=this.children[n],o=l.chunkSize();if(o>=e){if(l.insertInner(e,t,r),l.lines&&l.lines.length>50){for(;l.lines.length>50;){var i=l.lines.splice(l.lines.length-25,25),a=new ln(i);l.height-=a.height,this.children.splice(n+1,0,a),a.parent=this}this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=e.children.splice(e.children.length-5,5),r=new on(t);if(e.parent){e.size-=r.size,e.height-=r.height;var n=Gn(e.parent.children,e);e.parent.children.splice(n+1,0,r)}else{var l=new on(e.children);l.parent=e,e.children=[l,r],e=l}r.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,r){for(var n=0;n<this.children.length;++n){var l=this.children[n],o=l.chunkSize();if(o>e){var i=Math.min(t,o-e);if(l.iterN(e,i,r))return!0;if(0==(t-=i))break;e=0}else e-=o}}};var So=0,Eo=e.Doc=function(e,t,r){if(!(this instanceof Eo))return new Eo(e,t,r);null==r&&(r=0),on.call(this,[new ln([new ko("",null)])]),this.first=r,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.frontier=r;var n=zl(r,0);this.sel=J(n),this.history=new mn(null),this.id=++So,this.modeOption=t,"string"==typeof e&&(e=ei(e)),nn(this,{from:n,to:n,text:e}),ie(this,J(n),Ho)};Eo.prototype=Un(on.prototype,{constructor:Eo,iter:function(e,t,r){r?this.iterN(e-this.first,t-e,r):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var r=0,n=0;n<t.length;++n)r+=t[n].height;this.insertInner(e-this.first,t,r)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=hn(this,this.first,this.first+this.size);return e===!1?t:t.join(e||"\n")},setValue:Qe(function(e){var t=zl(this.first,0),r=this.first+this.size-1;Gt(this,{from:t,to:zl(r,cn(this,r).text.length),text:ei(e),origin:"setValue"},!0),ie(this,J(t))}),replaceRange:function(e,t,r,n){t=K(this,t),r=r?K(this,r):t,Xt(this,e,t,r,n)},getRange:function(e,t,r){var n=un(this,K(this,e),K(this,t));return r===!1?n:n.join(r||"\n")},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){return Q(this,e)?cn(this,e):void 0},getLineNumber:function(e){return gn(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=cn(this,e)),Ar(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return K(this,e)},getCursor:function(e){var t,r=this.sel.primary();return t=null==e||"head"==e?r.head:"anchor"==e?r.anchor:"end"==e||"to"==e||e===!1?r.to():r.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Qe(function(e,t,r){ne(this,K(this,"number"==typeof e?zl(e,t||0):e),null,r)}),setSelection:Qe(function(e,t,r){ne(this,K(this,e),K(this,t||e),r)}),extendSelection:Qe(function(e,t,r){ee(this,K(this,e),t&&K(this,t),r)}),extendSelections:Qe(function(e,t){te(this,$(this,e,t))}),extendSelectionsBy:Qe(function(e,t){te(this,Vn(this.sel.ranges,e),t)}),setSelections:Qe(function(e,t,r){if(e.length){for(var n=0,l=[];n<e.length;n++)l[n]=new V(K(this,e[n].anchor),K(this,e[n].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),ie(this,U(l,t),r)}}),addSelection:Qe(function(e,t,r){var n=this.sel.ranges.slice(0);n.push(new V(K(this,e),K(this,t||e))),ie(this,U(n,n.length-1),r)}),getSelection:function(e){for(var t,r=this.sel.ranges,n=0;n<r.length;n++){var l=un(this,r[n].from(),r[n].to());t=t?t.concat(l):l}return e===!1?t:t.join(e||"\n")},getSelections:function(e){for(var t=[],r=this.sel.ranges,n=0;n<r.length;n++){var l=un(this,r[n].from(),r[n].to());e!==!1&&(l=l.join(e||"\n")),t[n]=l}return t},replaceSelection:Qe(function(e,t,r){for(var n=[],l=0;l<this.sel.ranges.length;l++)n[l]=e;this.replaceSelections(n,t,r||"+input")}),replaceSelections:function(e,t,r){for(var n=[],l=this.sel,o=0;o<l.ranges.length;o++){var i=l.ranges[o];n[o]={from:i.from(),to:i.to(),text:ei(e[o]),origin:r}}for(var a=t&&"end"!=t&&zt(this,n,t),o=n.length-1;o>=0;o--)Gt(this,n[o]);a?oe(this,a):this.cm&&rr(this.cm)},undo:Qe(function(){Ut(this,"undo")}),redo:Qe(function(){Ut(this,"redo")}),undoSelection:Qe(function(){Ut(this,"undo",!0)}),redoSelection:Qe(function(){Ut(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,r=0,n=0;n<e.done.length;n++)e.done[n].ranges||++t;for(var n=0;n<e.undone.length;n++)e.undone[n].ranges||++r;return{undo:t,redo:r}},clearHistory:function(){this.history=new mn(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Ln(this.history.done),undone:Ln(this.history.undone)}},setHistory:function(e){var t=this.history=new mn(this.history.maxGeneration);t.done=Ln(e.done.slice(0),null,!0),t.undone=Ln(e.undone.slice(0),null,!0)},markText:function(e,t,r){return fr(this,K(this,e),K(this,t),r,"range")},setBookmark:function(e,t){var r={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared};return e=K(this,e),fr(this,e,e,r,"bookmark")},findMarksAt:function(e){e=K(this,e);var t=[],r=cn(this,e.line).markedSpans;if(r)for(var n=0;n<r.length;++n){var l=r[n];(null==l.from||l.from<=e.ch)&&(null==l.to||l.to>=e.ch)&&t.push(l.marker.parent||l.marker)}return t},findMarks:function(e,t){e=K(this,e),t=K(this,t);var r=[],n=e.line;return this.iter(e.line,t.line+1,function(l){var o=l.markedSpans;if(o)for(var i=0;i<o.length;i++){var a=o[i];n==e.line&&e.ch>a.to||null==a.from&&n!=e.line||n==t.line&&a.from>t.ch||r.push(a.marker.parent||a.marker)}++n}),r},getAllMarks:function(){var e=[];return this.iter(function(t){var r=t.markedSpans;if(r)for(var n=0;n<r.length;++n)null!=r[n].from&&e.push(r[n].marker)}),e},posFromIndex:function(e){var t,r=this.first;return this.iter(function(n){var l=n.text.length+1;return l>e?(t=e,!0):(e-=l,void++r)}),K(this,zl(r,t))},indexFromPos:function(e){e=K(this,e);var t=e.ch;return e.line<this.first||e.ch<0?0:(this.iter(this.first,e.line,function(e){t+=e.text.length+1}),t)},copy:function(e){var t=new Eo(hn(this,this.first,this.first+this.size),this.modeOption,this.first);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,r=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<r&&(r=e.to);var n=new Eo(hn(this,t,r),e.mode||this.modeOption,t);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],n},unlinkDoc:function(t){if(t instanceof e&&(t=t.doc),this.linked)for(var r=0;r<this.linked.length;++r){var n=this.linked[r];if(n.doc==t){this.linked.splice(r,1),t.unlinkDoc(this);break}}if(t.history==this.history){var l=[t.id];an(t,function(e){l.push(e.id)},!0),t.history=new mn(null),t.history.done=Ln(this.history.done,l),t.history.undone=Ln(this.history.undone,l)}},iterLinkedDocs:function(e){an(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),Eo.prototype.eachLine=Eo.prototype.iter;var Lo="iter insert remove copy getEditor".split(" ");for(var To in Eo.prototype)Eo.prototype.hasOwnProperty(To)&&Gn(Lo,To)<0&&(e.prototype[To]=function(e){return function(){return e.apply(this.doc,arguments)}}(Eo.prototype[To]));jn(Eo);var Io,Ro=e.e_preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},Oo=e.e_stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},Ao=e.e_stop=function(e){Ro(e),Oo(e)},Do=e.on=function(e,t,r){if(e.addEventListener)e.addEventListener(t,r,!1);else if(e.attachEvent)e.attachEvent("on"+t,r);else{var n=e._handlers||(e._handlers={}),l=n[t]||(n[t]=[]);l.push(r)}},No=e.off=function(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,!1);else if(e.detachEvent)e.detachEvent("on"+t,r);else{var n=e._handlers&&e._handlers[t];if(!n)return;for(var l=0;l<n.length;++l)if(n[l]==r){n.splice(l,1);break}}},Bo=e.signal=function(e,t){var r=e._handlers&&e._handlers[t];if(r)for(var n=Array.prototype.slice.call(arguments,2),l=0;l<r.length;++l)r[l].apply(null,n)},Po=0,Fo=30,jo=e.Pass={toString:function(){return"CodeMirror.Pass"}},Ho={scroll:!1},Wo={origin:"*mouse"},zo={origin:"+move"};Hn.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var qo=e.countColumn=function(e,t,r,n,l){null==t&&(t=e.search(/[^\s\u00a0]/),-1==t&&(t=e.length));for(var o=n||0,i=l||0;;){var a=e.indexOf("	",o);if(0>a||a>=t)return i+(t-o);i+=a-o,i+=r-i%r,o=a+1}},Go=[""],Vo=function(e){e.select()};Al?Vo=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:kl&&(Vo=function(e){try{e.select()}catch(t){}}),[].indexOf&&(Gn=function(e,t){return e.indexOf(t)}),[].map&&(Vn=function(e,t){return e.map(t)});var Uo,Jo=/[\u00df\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Yo=e.isWordChar=function(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Jo.test(e))},Ko=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;Uo=document.createRange?function(e,t,r){var n=document.createRange();return n.setEnd(e,r),n.setStart(e,t),n}:function(e,t,r){var n=document.body.createTextRange();return n.moveToElementText(e.parentNode),n.collapse(!0),n.moveEnd("character",r),n.moveStart("character",t),n},bl&&(tl=function(){try{return document.activeElement}catch(e){return document.body}});var Xo,Qo,$o,Zo=function(){if(_l)return!1;var e=Qn("div");return"draggable"in e||"dragDrop"in e}(),ei=e.splitLines=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,r=[],n=e.length;n>=t;){var l=e.indexOf("\n",t);-1==l&&(l=e.length);var o=e.slice(t,"\r"==e.charAt(l-1)?l-1:l),i=o.indexOf("\r");-1!=i?(r.push(o.slice(0,i)),t+=i+1):(r.push(o),t=l+1)}return r}:function(e){return e.split(/\r\n?|\n/)},ti=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(r){}return t&&t.parentElement()==e?0!=t.compareEndPoints("StartToEnd",t):!1},ri=function(){var e=Qn("div");return"oncopy"in e?!0:(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),ni={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};e.keyNames=ni,function(){for(var e=0;10>e;e++)ni[e+48]=ni[e+96]=String(e);for(var e=65;90>=e;e++)ni[e]=String.fromCharCode(e);for(var e=1;12>=e;e++)ni[e+111]=ni[e+63235]="F"+e}();var li,oi=function(){function e(e){return 247>=e?r.charAt(e):e>=1424&&1524>=e?"R":e>=1536&&1773>=e?n.charAt(e-1536):e>=1774&&2220>=e?"r":e>=8192&&8203>=e?"w":8204==e?"b":"L"}function t(e,t,r){this.level=e,this.from=t,this.to=r}var r="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",n="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",l=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,i=/[LRr]/,a=/[Lb1n]/,s=/[1n]/,c="L";return function(r){if(!l.test(r))return!1;for(var n,u=r.length,h=[],f=0;u>f;++f)h.push(n=e(r.charCodeAt(f)));for(var f=0,g=c;u>f;++f){var n=h[f];"m"==n?h[f]=g:g=n}for(var f=0,d=c;u>f;++f){var n=h[f];"1"==n&&"r"==d?h[f]="n":i.test(n)&&(d=n,"r"==n&&(h[f]="R"))}for(var f=1,g=h[0];u-1>f;++f){var n=h[f];"+"==n&&"1"==g&&"1"==h[f+1]?h[f]="1":","!=n||g!=h[f+1]||"1"!=g&&"n"!=g||(h[f]=g),g=n}for(var f=0;u>f;++f){var n=h[f];if(","==n)h[f]="N";else if("%"==n){for(var p=f+1;u>p&&"%"==h[p];++p);for(var v=f&&"!"==h[f-1]||u>p&&"1"==h[p]?"1":"N",m=f;p>m;++m)h[m]=v;f=p-1}}for(var f=0,d=c;u>f;++f){var n=h[f];"L"==d&&"1"==n?h[f]="L":i.test(n)&&(d=n)}for(var f=0;u>f;++f)if(o.test(h[f])){for(var p=f+1;u>p&&o.test(h[p]);++p);for(var b="L"==(f?h[f-1]:c),y="L"==(u>p?h[p]:c),v=b||y?"L":"R",m=f;p>m;++m)h[m]=v;f=p-1}for(var _,w=[],f=0;u>f;)if(a.test(h[f])){var x=f;for(++f;u>f&&a.test(h[f]);++f);w.push(new t(0,x,f))}else{var k=f,C=w.length;for(++f;u>f&&"L"!=h[f];++f);for(var m=k;f>m;)if(s.test(h[m])){m>k&&w.splice(C,0,new t(1,k,m));var M=m;for(++m;f>m&&s.test(h[m]);++m);w.splice(C,0,new t(2,M,m)),k=m}else++m;f>k&&w.splice(C,0,new t(1,k,f))}return 1==w[0].level&&(_=r.match(/^\s+/))&&(w[0].from=_[0].length,w.unshift(new t(0,0,_[0].length))),1==qn(w).level&&(_=r.match(/\s+$/))&&(qn(w).to-=_[0].length,w.push(new t(0,u-_[0].length,u))),w[0].level!=qn(w).level&&w.push(new t(w[0].level,u,u)),w}}();return e.version="4.0.3",e};t["default"]=r(),e.exports=t["default"]},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={1:"mastersystem",2:"gameboycolour",3:"amiga",4:"arnecolors",5:"famicom",6:"atari",7:"pastel",8:"ega",9:"amstrad",10:"proteus_mellow",11:"proteus_rich",12:"proteus_night",13:"c64",14:"whitingjp"};t.colorPalettesAliases=r;var n={mastersystem:{black:"#000000",white:"#FFFFFF",grey:"#555555",darkgrey:"#555500",lightgrey:"#AAAAAA",gray:"#555555",
darkgray:"#555500",lightgray:"#AAAAAA",red:"#FF0000",darkred:"#AA0000",lightred:"#FF5555",brown:"#AA5500",darkbrown:"#550000",lightbrown:"#FFAA00",orange:"#FF5500",yellow:"#FFFF55",green:"#55AA00",darkgreen:"#005500",lightgreen:"#AAFF00",blue:"#5555AA",lightblue:"#AAFFFF",darkblue:"#000055",purple:"#550055",pink:"#FFAAFF"},gameboycolour:{black:"#000000",white:"#FFFFFF",grey:"#7F7F7C",darkgrey:"#3E3E44",lightgrey:"#BAA7A7",gray:"#7F7F7C",darkgray:"#3E3E44",lightgray:"#BAA7A7",red:"#A7120C",darkred:"#880606",lightred:"#BA381F",brown:"#57381F",darkbrown:"#3E2519",lightbrown:"#8E634B",orange:"#BA4B32",yellow:"#C0BA6F",green:"#517525",darkgreen:"#385D12",lightgreen:"#6F8E44",blue:"#5D6FA7",lightblue:"#8EA7A7",darkblue:"#4B575D",purple:"#3E3E44",pink:"#BA381F"},amiga:{black:"#000000",white:"#FFFFFF",grey:"#BBBBBB",darkgrey:"#333333",lightgrey:"#FFEEDD",gray:"#BBBBBB",darkgray:"#333333",lightgray:"#FFEEDD",red:"#DD1111",darkred:"#990000",lightred:"#FF4422",brown:"#663311",darkbrown:"#331100",lightbrown:"#AA6644",orange:"#FF6644",yellow:"#FFDD66",green:"#448811",darkgreen:"#335500",lightgreen:"#88BB77",blue:"#8899DD",lightblue:"#BBDDEE",darkblue:"#666688",purple:"#665555",pink:"#997788"},arnecolors:{black:"#000000",white:"#FFFFFF",grey:"#9d9d9d",darkgrey:"#697175",lightgrey:"#cccccc",gray:"#9d9d9d",darkgray:"#697175",lightgray:"#cccccc",red:"#be2633",darkred:"#732930",lightred:"#e06f8b",brown:"#a46422",darkbrown:"#493c2b",lightbrown:"#eeb62f",orange:"#eb8931",yellow:"#f7e26b",green:"#44891a",darkgreen:"#2f484e",lightgreen:"#a3ce27",blue:"#1d57f7",lightblue:"#B2DCEF",darkblue:"#1B2632",purple:"#342a97",pink:"#de65e2"},famicom:{black:"#000000",white:"#ffffff",grey:"#7c7c7c",darkgrey:"#080808",lightgrey:"#bcbcbc",gray:"#7c7c7c",darkgray:"#080808",lightgray:"#bcbcbc",red:"#f83800",darkred:"#881400",lightred:"#f87858",brown:"#AC7C00",darkbrown:"#503000",lightbrown:"#FCE0A8",orange:"#FCA044",yellow:"#F8B800",green:"#00B800",darkgreen:"#005800",lightgreen:"#B8F8B8",blue:"#0058F8",lightblue:"#3CBCFC",darkblue:"#0000BC",purple:"#6644FC",pink:"#F878F8"},atari:{black:"#000000",white:"#FFFFFF",grey:"#909090",darkgrey:"#404040",lightgrey:"#b0b0b0",gray:"#909090",darkgray:"#404040",lightgray:"#b0b0b0",red:"#A03C50",darkred:"#700014",lightred:"#DC849C",brown:"#805020",darkbrown:"#703400",lightbrown:"#CB9870",orange:"#CCAC70",yellow:"#ECD09C",green:"#58B06C",darkgreen:"#006414",lightgreen:"#70C484",blue:"#1C3C88",lightblue:"#6888C8",darkblue:"#000088",purple:"#3C0080",pink:"#B484DC"},pastel:{black:"#000000",white:"#FFFFFF",grey:"#3e3e3e",darkgrey:"#313131",lightgrey:"#9cbcbc",gray:"#3e3e3e",darkgray:"#313131",lightgray:"#9cbcbc",red:"#f56ca2",darkred:"#a63577",lightred:"#ffa9cf",brown:"#b58c53",darkbrown:"#787562",lightbrown:"#B58C53",orange:"#EB792D",yellow:"#FFe15F",green:"#00FF4F",darkgreen:"#2b732c",lightgreen:"#97c04f",blue:"#0f88d3",lightblue:"#00fffe",darkblue:"#293a7b",purple:"#ff6554",pink:"#eb792d"},ega:{black:"#000000",white:"#ffffff",grey:"#555555",darkgrey:"#555555",lightgrey:"#aaaaaa",gray:"#555555",darkgray:"#555555",lightgray:"#aaaaaa",red:"#ff5555",darkred:"#aa0000",lightred:"#ff55ff",brown:"#aa5500",darkbrown:"#aa5500",lightbrown:"#ffff55",orange:"#ff5555",yellow:"#ffff55",green:"#00aa00",darkgreen:"#00aaaa",lightgreen:"#55ff55",blue:"#5555ff",lightblue:"#55ffff",darkblue:"#0000aa",purple:"#aa00aa",pink:"#ff55ff"},proteus_mellow:{black:"#3d2d2e",white:"#ddf1fc",grey:"#9fb2d4",darkgrey:"#7b8272",lightgrey:"#a4bfda",gray:"#9fb2d4",darkgray:"#7b8272",lightgray:"#a4bfda",red:"#9d5443",darkred:"#8c5b4a",lightred:"#94614c",brown:"#89a78d",darkbrown:"#829e88",lightbrown:"#aaae97",orange:"#d1ba86",yellow:"#d6cda2",green:"#75ac8d",darkgreen:"#8fa67f",lightgreen:"#8eb682",blue:"#88a3ce",lightblue:"#a5adb0",darkblue:"#5c6b8c",purple:"#d39fac",pink:"#c8ac9e"},proteus_night:{black:"#010912",white:"#fdeeec",grey:"#051d40",darkgrey:"#091842",lightgrey:"#062151",gray:"#051d40",darkgray:"#091842",lightgray:"#062151",red:"#ad4576",darkred:"#934765",lightred:"#ab6290",brown:"#61646b",darkbrown:"#3d2d2d",lightbrown:"#8393a0",orange:"#0a2227",yellow:"#0a2541",green:"#75ac8d",darkgreen:"#0a2434",lightgreen:"#061f2e",blue:"#0b2c79",lightblue:"#809ccb",darkblue:"#08153b",purple:"#666a87",pink:"#754b4d"},proteus_rich:{black:"#6f686f",white:"#d1b1e2",grey:"#b9aac1",darkgrey:"#8e8b84",lightgrey:"#c7b5cd",gray:"#b9aac1",darkgray:"#8e8b84",lightgray:"#c7b5cd",red:"#a11f4f",darkred:"#934765",lightred:"#c998ad",brown:"#89867d",darkbrown:"#797f75",lightbrown:"#ab9997",orange:"#ce8c5c",yellow:"#f0d959",green:"#75bc54",darkgreen:"#599d79",lightgreen:"#90cf5c",blue:"#8fd0ec",lightblue:"#bcdce7",darkblue:"#0b2c70",purple:"#9b377f",pink:"#cd88e5"},amstrad:{black:"#000000",white:"#ffffff",grey:"#7f7f7f",darkgrey:"#636363",lightgrey:"#afafaf",gray:"#7f7f7f",darkgray:"#636363",lightgray:"#afafaf",red:"#ff0000",darkred:"#7f0000",lightred:"#ff7f7f",brown:"#ff7f00",darkbrown:"#7f7f00",lightbrown:"#ffff00",orange:"#ff007f",yellow:"#ffff7f",green:"#01ff00",darkgreen:"#007f00",lightgreen:"#7fff7f",blue:"#0000ff",lightblue:"#7f7fff",darkblue:"#00007f",purple:"#7f007f",pink:"#ff7fff"},c64:{black:"#000000",white:"#ffffff",grey:"#6C6C6C",darkgrey:"#444444",lightgrey:"#959595",gray:"#6C6C6C",darkgray:"#444444",lightgray:"#959595",red:"#68372B",darkred:"#3f1e17",lightred:"#9A6759",brown:"#433900",darkbrown:"#221c02",lightbrown:"#6d5c0d",orange:"#6F4F25",yellow:"#B8C76F",green:"#588D43",darkgreen:"#345129",lightgreen:"#9AD284",blue:"#6C5EB5",lightblue:"#70A4B2",darkblue:"#352879",purple:"#6F3D86",pink:"#b044ac"},whitingjp:{black:"#202527",white:"#eff8fd",grey:"#7b7680",darkgrey:"#3c3b44",lightgrey:"#bed0d7",gray:"#7b7680",darkgray:"#3c3b44",lightgray:"#bed0d7",red:"#bd194b",darkred:"#6b1334",lightred:"#ef2358",brown:"#b52e1c",darkbrown:"#681c12",lightbrown:"#e87b45",orange:"#ff8c10",yellow:"#fbd524",green:"#36bc3c",darkgreen:"#317610",lightgreen:"#8ce062",blue:"#3f62c6",lightblue:"#57bbe0",darkblue:"#2c2fa0",purple:"#7037d9",pink:"#ec2b8f"}},l=/(black|white|gray|darkgray|lightgray|grey|darkgrey|lightgrey|red|darkred|lightred|brown|darkbrown|lightbrown|orange|yellow|green|darkgreen|lightgreen|blue|lightblue|darkblue|purple|pink|transparent|#(?:[0-9a-f]{3}){1,2})\s*/;t.reg_color=l,t.colorPalettes=n},function(e,t,r){function n(){var e={};return e.wave_type=p,e.p_env_attack=0,e.p_env_sustain=.3,e.p_env_punch=0,e.p_env_decay=.4,e.p_base_freq=.3,e.p_freq_limit=0,e.p_freq_ramp=0,e.p_freq_dramp=0,e.p_vib_strength=0,e.p_vib_speed=0,e.p_arp_mod=0,e.p_arp_speed=0,e.p_duty=0,e.p_duty_ramp=0,e.p_repeat_speed=0,e.p_pha_offset=0,e.p_pha_ramp=0,e.p_lpf_freq=1,e.p_lpf_ramp=0,e.p_lpf_resonance=0,e.p_hpf_freq=0,e.p_hpf_ramp=0,e.sound_vol=.5,e.sample_rate=44100,e.bit_depth=8,e}function l(e){return C?x.uniform()*e:Math.random()*e}function o(e){return C?Math.floor(x.uniform()*(e+1)):Math.floor(Math.random()*(e+1))}function i(e,t){this._buffer=c.createBuffer(1,e,t)}function a(e){if(e in P)return P[e];var t=B(e);t.sound_vol=f,t.sample_rate=g,t.bit_depth=d;var r=i.generate(t);for(P[e]=r,F.push(e);F.length>j;){var n=F[0];F=F.slice(1),delete P[n]}return r}function s(e){if(!h.globals.unitTesting){var t=a(e);t.play()}}Object.defineProperty(t,"__esModule",{value:!0}),t.playSound=s;var c,u=r(7),h=r(4),f=.25,g=5512,d=8,p=0,v=1,m=2,b=3,y=4,_=5,w=["square","sawtooth","sine","noise","triangle","breaker"];"undefined"!=typeof AudioContext?c=new AudioContext:"undefined"!=typeof webkitAudioContext&&(c=new webkitAudioContext);var x,k=1,C=!1,M=function(){var e=n();if(e.wave_type=Math.floor(l(w.length)),3===e.wave_type&&(e.wave_type=0),e.p_base_freq=.4+l(.5),e.p_env_attack=0,e.p_env_sustain=l(.1),e.p_env_decay=.1+l(.4),e.p_env_punch=.3+l(.3),o(1)){e.p_arp_speed=.5+l(.2);var t=(1|l(7))+1,r=t+(1|l(7))+2;e.p_arp_mod=+t/+r}return e},S=function(){var e=n();return e.wave_type=o(2),e.wave_type===m&&o(1)&&(e.wave_type=o(1)),e.wave_type=Math.floor(l(w.length)),3===e.wave_type&&(e.wave_type=p),e.p_base_freq=.5+l(.5),e.p_freq_limit=e.p_base_freq-.2-l(.6),e.p_freq_limit<.2&&(e.p_freq_limit=.2),e.p_freq_ramp=-.15-l(.2),0===o(2)&&(e.p_base_freq=.3+l(.6),e.p_freq_limit=l(.1),e.p_freq_ramp=-.35-l(.3)),o(1)?(e.p_duty=l(.5),e.p_duty_ramp=l(.2)):(e.p_duty=.4+l(.5),e.p_duty_ramp=-l(.7)),e.p_env_attack=0,e.p_env_sustain=.1+l(.2),e.p_env_decay=l(.4),o(1)&&(e.p_env_punch=l(.3)),0===o(2)&&(e.p_pha_offset=l(.2),e.p_pha_ramp=-l(.2)),o(1)&&(e.p_hpf_freq=l(.3)),e},E=function(){var e=n();return o(1)?(e.p_base_freq=.1+l(.4),e.p_freq_ramp=-.1+l(.4)):(e.p_base_freq=.2+l(.7),e.p_freq_ramp=-.2-l(.2)),e.p_base_freq*=e.p_base_freq,0===o(4)&&(e.p_freq_ramp=0),0===o(2)&&(e.p_repeat_speed=.3+l(.5)),e.p_env_attack=0,e.p_env_sustain=.1+l(.3),e.p_env_decay=l(.5),0===o(1)&&(e.p_pha_offset=-.3+l(.9),e.p_pha_ramp=-l(.3)),e.p_env_punch=.2+l(.6),o(1)&&(e.p_vib_strength=l(.7),e.p_vib_speed=l(.6)),0===o(2)&&(e.p_arp_speed=.6+l(.3),e.p_arp_mod=.8-l(1.6)),e},L=function(){var e=n();return l(10)<1?(e.wave_type=Math.floor(l(w.length)),3===e.wave_type&&(e.wave_type=p),e.p_env_attack=.4304400932967592+l(.2)-.1,e.p_env_sustain=.15739346034252394+l(.2)-.1,e.p_env_punch=.004488201744871758+l(.2)-.1,e.p_env_decay=.07478075528212291+l(.2)-.1,e.p_base_freq=.9865265720147687+l(.2)-.1,e.p_freq_limit=0+l(.2)-.1,e.p_freq_ramp=-.2995018224359539+l(.2)-.1,l(1)<.5&&(e.p_freq_ramp=.1+l(.15)),e.p_freq_dramp=.004598608156964473+l(.1)-.05,e.p_vib_strength=-.2202799497929496+l(.2)-.1,e.p_vib_speed=.8084998703158364+l(.2)-.1,e.p_arp_mod=0,e.p_arp_speed=0,e.p_duty=-.9031808754347107+l(.2)-.1,e.p_duty_ramp=-.8128699999808343+l(.2)-.1,e.p_repeat_speed=.601486018931999+l(.2)-.1,e.p_pha_offset=-.9424902314367765+l(.2)-.1,e.p_pha_ramp=-.1055482222272056+l(.2)-.1,e.p_lpf_freq=.9989765717851521+l(.2)-.1,e.p_lpf_ramp=-.25051720626043017+l(.2)-.1,e.p_lpf_resonance=.32777871505494693+l(.2)-.1,e.p_hpf_freq=.0023548750981756753+l(.2)-.1,e.p_hpf_ramp=-.002375673204842568+l(.2)-.1,e):l(10)<1?(e.wave_type=Math.floor(l(w.length)),3===e.wave_type&&(e.wave_type=p),e.p_env_attack=.5277795946672003+l(.2)-.1,e.p_env_sustain=.18243733568468432+l(.2)-.1,e.p_env_punch=-.020159754546840117+l(.2)-.1,e.p_env_decay=.1561353422051903+l(.2)-.1,e.p_base_freq=.9028855606533718+l(.2)-.1,e.p_freq_limit=-.008842787837148716,e.p_freq_ramp=-.1,e.p_freq_dramp=-.012891241489551925,e.p_vib_strength=-.17923136138403065+l(.2)-.1,e.p_vib_speed=.908263385610142+l(.2)-.1,e.p_arp_mod=.41690153355414894+l(.2)-.1,e.p_arp_speed=.0010766233195860704+l(.2)-.1,e.p_duty=-.8735363011184684+l(.2)-.1,e.p_duty_ramp=-.7397985366747507+l(.2)-.1,e.p_repeat_speed=.0591789344172107+l(.2)-.1,e.p_pha_offset=-.9961184222777699+l(.2)-.1,e.p_pha_ramp=-.08234769395850523+l(.2)-.1,e.p_lpf_freq=.9412475115697335+l(.2)-.1,e.p_lpf_ramp=-.18261358925834958+l(.2)-.1,e.p_lpf_resonance=.24541438107389477+l(.2)-.1,e.p_hpf_freq=-.01831940280978611+l(.2)-.1,e.p_hpf_ramp=-.03857383633171346+l(.2)-.1,e):l(10)<1?(e.wave_type=Math.floor(l(w.length)),3===e.wave_type&&(e.wave_type=p),e.p_env_attack=.4304400932967592+l(.2)-.1,e.p_env_sustain=.15739346034252394+l(.2)-.1,e.p_env_punch=.004488201744871758+l(.2)-.1,e.p_env_decay=.07478075528212291+l(.2)-.1,e.p_base_freq=.9865265720147687+l(.2)-.1,e.p_freq_limit=0+l(.2)-.1,e.p_freq_ramp=-.2995018224359539+l(.2)-.1,e.p_freq_dramp=.004598608156964473+l(.2)-.1,e.p_vib_strength=-.2202799497929496+l(.2)-.1,e.p_vib_speed=.8084998703158364+l(.2)-.1,e.p_arp_mod=-.46410459213693644+l(.2)-.1,e.p_arp_speed=-.10955361249587248+l(.2)-.1,e.p_duty=-.9031808754347107+l(.2)-.1,e.p_duty_ramp=-.8128699999808343+l(.2)-.1,e.p_repeat_speed=.7014860189319991+l(.2)-.1,e.p_pha_offset=-.9424902314367765+l(.2)-.1,e.p_pha_ramp=-.1055482222272056+l(.2)-.1,e.p_lpf_freq=.9989765717851521+l(.2)-.1,e.p_lpf_ramp=-.25051720626043017+l(.2)-.1,e.p_lpf_resonance=.32777871505494693+l(.2)-.1,e.p_hpf_freq=.0023548750981756753+l(.2)-.1,e.p_hpf_ramp=-.002375673204842568+l(.2)-.1,e):l(5)>1?(e.wave_type=Math.floor(l(w.length)),3===e.wave_type&&(e.wave_type=p),o(1)?(e.p_arp_mod=.2697849293151393+l(.2)-.1,e.p_arp_speed=-.3131172257760948+l(.2)-.1,e.p_base_freq=.8090588299313949+l(.2)-.1,e.p_duty=-.6210022920964955+l(.2)-.1,e.p_duty_ramp=-.00043441813553182567+l(.2)-.1,e.p_env_attack=.004321877246874195+l(.2)-.1,e.p_env_decay=.1+l(.2)-.1,e.p_env_punch=.061737781504416146+l(.2)-.1,e.p_env_sustain=.4987252564798832+l(.2)-.1,e.p_freq_dramp=.31700340314222614+l(.2)-.1,e.p_freq_limit=0+l(.2)-.1,e.p_freq_ramp=-.163380391341416+l(.2)-.1,e.p_hpf_freq=.4709005021145149+l(.2)-.1,e.p_hpf_ramp=.6924667290539194+l(.2)-.1,e.p_lpf_freq=.8351398631384511+l(.2)-.1,e.p_lpf_ramp=.36616557192873134+l(.2)-.1,e.p_lpf_resonance=-.08685777111664439+l(.2)-.1,e.p_pha_offset=-.036084571580025544+l(.2)-.1,e.p_pha_ramp=-.014806445085568108+l(.2)-.1,e.p_repeat_speed=-.8094368475518489+l(.2)-.1,e.p_vib_speed=.4496665457171294+l(.2)-.1,e.p_vib_strength=.23413762515532424+l(.2)-.1):(e.p_arp_mod=-.35697118026766184+l(.2)-.1,e.p_arp_speed=.3581140690559588+l(.2)-.1,e.p_base_freq=1.3260897696157528+l(.2)-.1,e.p_duty=-.30984900436710694+l(.2)-.1,e.p_duty_ramp=-.0014374759133411626+l(.2)-.1,e.p_env_attack=.3160357835682254+l(.2)-.1,e.p_env_decay=.1+l(.2)-.1,e.p_env_punch=.24323114016870148+l(.2)-.1,e.p_env_sustain=.4+l(.2)-.1,e.p_freq_dramp=.2866475886237244+l(.2)-.1,e.p_freq_limit=0+l(.2)-.1,e.p_freq_ramp=-.10956352368742976+l(.2)-.1,e.p_hpf_freq=.20772718017889846+l(.2)-.1,e.p_hpf_ramp=.1564090637378835+l(.2)-.1,e.p_lpf_freq=.6021372770637031+l(.2)-.1,e.p_lpf_ramp=.24016227139979027+l(.2)-.1,e.p_lpf_resonance=-.08787383821160144+l(.2)-.1,e.p_pha_offset=-.381597686151701+l(.2)-.1,e.p_pha_ramp=-.0002481687661373495+l(.2)-.1,e.p_repeat_speed=.07812112809425686+l(.2)-.1,e.p_vib_speed=-.13648848579133943+l(.2)-.1,e.p_vib_strength=.0018874158972302657+l(.2)-.1),e):(e.wave_type=Math.floor(l(w.length)),(1===e.wave_type||3===e.wave_type)&&(e.wave_type=2),e.p_base_freq=.85+l(.15),e.p_freq_ramp=.3+l(.15),e.p_env_attack=0+l(.09),e.p_env_sustain=.2+l(.3),e.p_env_decay=0+l(.1),e.p_duty=l(2)-1,e.p_duty_ramp=Math.pow(l(2)-1,3),e.p_repeat_speed=.5+l(.1),e.p_pha_offset=-.3+l(.9),e.p_pha_ramp=-l(.3),e.p_arp_speed=.4+l(.6),e.p_arp_mod=.8+l(.1),e.p_lpf_resonance=l(2)-1,e.p_lpf_freq=1-Math.pow(l(1),3),e.p_lpf_ramp=Math.pow(l(2)-1,3),e.p_lpf_freq<.1&&e.p_lpf_ramp<-.05&&(e.p_lpf_ramp=-e.p_lpf_ramp),e.p_hpf_freq=Math.pow(l(1),5),e.p_hpf_ramp=Math.pow(l(2)-1,5),e)},T=function(){var e=n();return e.wave_type=Math.floor(l(w.length)),2===e.wave_type&&e.wave_type++,0===e.wave_type&&(e.wave_type=b),e.p_base_freq=.1+l(.4),e.p_freq_ramp=.05+l(.2),e.p_env_attack=.01+l(.09),e.p_env_sustain=.01+l(.09),e.p_env_decay=.01+l(.09),e.p_repeat_speed=.3+l(.5),e.p_pha_offset=-.3+l(.9),e.p_pha_ramp=-l(.3),e.p_arp_speed=.6+l(.3),e.p_arp_mod=.8-l(1.6),e},I=function(){var e=n();return o(1)?e.wave_type=v:e.p_duty=l(.6),e.wave_type=Math.floor(l(w.length)),3===e.wave_type&&(e.wave_type=p),o(1)?(e.p_base_freq=.2+l(.3),e.p_freq_ramp=.1+l(.4),e.p_repeat_speed=.4+l(.4)):(e.p_base_freq=.2+l(.3),e.p_freq_ramp=.05+l(.2),o(1)&&(e.p_vib_strength=l(.7),e.p_vib_speed=l(.6))),e.p_env_attack=0,e.p_env_sustain=l(.4),e.p_env_decay=.1+l(.4),e},R=function(){var e=n();return e.wave_type=o(2),e.wave_type===m&&(e.wave_type=b),e.wave_type===p&&(e.p_duty=l(.6)),e.wave_type=Math.floor(l(w.length)),e.p_base_freq=.2+l(.6),e.p_freq_ramp=-.3-l(.4),e.p_env_attack=0,e.p_env_sustain=l(.1),e.p_env_decay=.1+l(.2),o(1)&&(e.p_hpf_freq=l(.3)),e},O=function(){var e=n();return e.wave_type=p,e.wave_type=Math.floor(l(w.length)),3===e.wave_type&&(e.wave_type=p),e.p_duty=l(.6),e.p_base_freq=.3+l(.3),e.p_freq_ramp=.1+l(.2),e.p_env_attack=0,e.p_env_sustain=.1+l(.3),e.p_env_decay=.1+l(.2),o(1)&&(e.p_hpf_freq=l(.3)),o(1)&&(e.p_lpf_freq=1-l(.6)),e},A=function(){var e=n();return e.wave_type=o(1),e.wave_type=Math.floor(l(w.length)),3===e.wave_type&&(e.wave_type=o(1)),e.wave_type===p&&(e.p_duty=l(.6)),e.p_base_freq=.2+l(.4),e.p_env_attack=0,e.p_env_sustain=.1+l(.1),e.p_env_decay=l(.2),e.p_hpf_freq=.1,e},D=function(){var e=n();return e.wave_type=Math.floor(l(w.length)),e.p_base_freq=Math.pow(l(2)-1,2),o(1)&&(e.p_base_freq=Math.pow(l(2)-1,3)+.5),e.p_freq_limit=0,e.p_freq_ramp=Math.pow(l(2)-1,5),e.p_base_freq>.7&&e.p_freq_ramp>.2&&(e.p_freq_ramp=-e.p_freq_ramp),e.p_base_freq<.2&&e.p_freq_ramp<-.05&&(e.p_freq_ramp=-e.p_freq_ramp),e.p_freq_dramp=Math.pow(l(2)-1,3),e.p_duty=l(2)-1,e.p_duty_ramp=Math.pow(l(2)-1,3),e.p_vib_strength=Math.pow(l(2)-1,3),e.p_vib_speed=l(2)-1,e.p_env_attack=Math.pow(l(2)-1,3),e.p_env_sustain=Math.pow(l(2)-1,2),e.p_env_decay=l(2)-1,e.p_env_punch=Math.pow(l(.8),2),e.p_env_attack+e.p_env_sustain+e.p_env_decay<.2&&(e.p_env_sustain+=.2+l(.3),e.p_env_decay+=.2+l(.3)),e.p_lpf_resonance=l(2)-1,e.p_lpf_freq=1-Math.pow(l(1),3),e.p_lpf_ramp=Math.pow(l(2)-1,3),e.p_lpf_freq<.1&&e.p_lpf_ramp<-.05&&(e.p_lpf_ramp=-e.p_lpf_ramp),e.p_hpf_freq=Math.pow(l(1),5),e.p_hpf_ramp=Math.pow(l(2)-1,5),e.p_pha_offset=Math.pow(l(2)-1,3),e.p_pha_ramp=Math.pow(l(2)-1,3),e.p_repeat_speed=l(2)-1,e.p_arp_speed=l(2)-1,e.p_arp_mod=l(2)-1,e},N=[M,S,E,I,R,O,A,T,D,L],B=function(e){x=new u.RNG(e/100|0);var t=e%100,r=N[t%N.length];C=!0;var n=r();return n.seed=e,C=!1,n};i.prototype.getBuffer=function(){return this._buffer.getChannelData(0)},i.prototype.play=function(){var e=c.createBufferSource(),t=c.createBiquadFilter(),r=c.createBiquadFilter(),n=c.createBiquadFilter();e.buffer=this._buffer,e.connect(t),t.frequency.value=1600,r.frequency.value=1600,n.frequency.value=1600,t.connect(r),r.connect(n),n.connect(c.destination);var l=c.currentTime;"undefined"!=typeof e.start?e.start(l):e.noteOn(l)},i.MIN_SAMPLE_RATE=22050,"undefined"==typeof c&&(i=function(e,t){this._sample_rate=t,this._buffer=new Array(e),this._audioElement=null},i.prototype.getBuffer=function(){return this._audioElement=null,this._buffer},i.prototype.play=function(){if(this._audioElement)this._audioElement.cloneNode(!1).play();else{for(var e=0;e<this._buffer.length;e++)this._buffer[e]=255&Math.floor(128*Math.max(0,Math.min(this._buffer[e]+1,2)));var t=MakeRiff(this._sample_rate,d,this._buffer);this._audioElement=new Audio,this._audioElement.src=t.dataURI,this._audioElement.play()}},i.MIN_SAMPLE_RATE=1),i.generate=function(e){function t(){r=0,n=100/(e.p_base_freq*e.p_base_freq+.001),l=Math.floor(n),o=100/(e.p_freq_limit*e.p_freq_limit+.001),a=1-.01*Math.pow(e.p_freq_ramp,3),s=1e-6*-Math.pow(e.p_freq_dramp,3),c=.5-.5*e.p_duty,u=5e-5*-e.p_duty_ramp,h=e.p_arp_mod>=0?1-.9*Math.pow(e.p_arp_mod,2):1+10*Math.pow(e.p_arp_mod,2),f=0,g=Math.floor(2e4*Math.pow(1-e.p_arp_speed,2)+32),1==e.p_arp_speed&&(g=0)}var r,n,l,o,a,s,c,u,h,f,g;t();var d=0,w=0,x=.1*Math.pow(e.p_lpf_freq,3),C=1+1e-4*e.p_lpf_ramp,M=5/(1+20*Math.pow(e.p_lpf_resonance,2))*(.01+x);M>.8&&(M=.8);var S=0,E=.1*Math.pow(e.p_hpf_freq,2),L=1+3e-4*e.p_hpf_ramp,T=0,I=.01*Math.pow(e.p_vib_speed,2),R=.5*e.p_vib_strength,O=0,A=0,D=0,N=[Math.floor(e.p_env_attack*e.p_env_attack*1e5),Math.floor(e.p_env_sustain*e.p_env_sustain*1e5),Math.floor(e.p_env_decay*e.p_env_decay*1e5)],B=N[0]+N[1]+N[2],P=0,F=1020*Math.pow(e.p_pha_offset,2);e.p_pha_offset<0&&(F=-F);var j=1*Math.pow(e.p_pha_ramp,2);e.p_pha_ramp<0&&(j=-j);for(var H=Math.abs(Math.floor(F)),W=0,z=[],q=0;1024>q;++q)z[q]=0;for(var G=[],q=0;32>q;++q)G[q]=2*Math.random()-1;var V=Math.floor(2e4*Math.pow(1-e.p_repeat_speed,2)+32);0==e.p_repeat_speed&&(V=0);var U,J=2*e.sound_vol,J=Math.exp(e.sound_vol)-1,Y=0,K=0,X=Math.floor(44100/e.sample_rate),Q=0,$=Math.ceil(B/X),Z=!1;U=e.sample_rate<i.MIN_SAMPLE_RATE?new i(4*$,i.MIN_SAMPLE_RATE):new i($,e.sample_rate);for(var ee=U.getBuffer(),te=0;;++te){0!=V&&++r>=V&&t(),0!=g&&te>=g&&(g=0,n*=h),a+=s,n*=a,n>o&&(n=o,e.p_freq_limit>0&&(Z=!0));var re=n;R>0&&(T+=I,re=n*(1+Math.sin(T)*R)),l=Math.floor(re),8>l&&(l=8),c+=u,0>c&&(c=0),c>.5&&(c=.5),D++,D>N[A]&&(D=0,A++,3===A&&(Z=!0)),O=0===A?D/N[0]:1===A?1+2*Math.pow(1-D/N[1],1)*e.p_env_punch:1-D/N[2],F+=j,H=Math.abs(Math.floor(F)),H>1023&&(H=1023),0!=L&&(E*=L,1e-5>E&&(E=1e-5),E>.1&&(E=.1));for(var ne=0,le=0;8>le;++le){var oe=0;if(P++,P>=l&&(P%=l,e.wave_type===b))for(var q=0;32>q;++q)G[q]=2*Math.random()-1;var ie=P/l;if(e.wave_type===p)oe=c>ie?.5:-.5;else if(e.wave_type===v)oe=1-2*ie;else if(e.wave_type===m)oe=Math.sin(2*ie*Math.PI);else if(e.wave_type===b)oe=G[Math.floor(32*P/l)];else if(e.wave_type===y)oe=Math.abs(1-2*ie)-1;else{if(e.wave_type!==_)throw new Exception("bad wave type! "+e.wave_type);oe=Math.abs(1-ie*ie*2)-1}var ae=d;x*=C,0>x&&(x=0),x>.1&&(x=.1),1!=e.p_lpf_freq?(w+=(oe-d)*x,w-=w*M):(d=oe,w=0),d+=w,S+=d-ae,S-=S*E,oe=S,z[1023&W]=oe,oe+=z[W-H+1024&1023],W=W+1&1023,ne+=oe*O}if(Y+=ne,++K>=X&&(K=0,ne=Y/X,Y=0,ne=ne/8*k,ne*=J,ee[Q++]=ne,e.sample_rate<i.MIN_SAMPLE_RATE&&(ee[Q++]=ne,ee[Q++]=ne,ee[Q++]=ne),Z)){for(;$>Q;Q++)e.sample_rate<i.MIN_SAMPLE_RATE&&(ee[Q++]=0,ee[Q++]=0,ee[Q++]=0),ee[Q]=0;break}}return U};var P={},F=[],j=50},function(e,t,r){function n(e){return e&&e.__esModule?e:{"default":e}}function l(e){return e=e.trim(),e in ae.colorPalettes.arnecolors?!0:/^#([0-9A-F]{3}){1,2}$/i.test(e)?!0:"transparent"===e?!0:!1}function o(e,t){return t=t.trim(),t in e?e[t]:t}function i(e){for(var t=[],r=0;r<e.length;r++){for(var n=[],l=0;l<e.length;l++){var o=e[r].charAt(l);"."==o?n.push(-1):n.push(o)}t.push(n)}return t}function a(e){0===e.collisionLayers.length&&logError("No collision layers defined.  All objects need to be in collision layers."),e.idDict={};for(var t=0,r=0;r<e.collisionLayers.length;r++)for(var n=0;n<e.collisionLayers[r].length;n++){var a=e.collisionLayers[r][n];if(a in e.objects){var s=e.objects[a];s.layer=r,s.id=t,e.idDict[t]=a,t++}}e.objectCount=t;for(var c=e.collisionLayers.length,u=[],h=0;c>h;h++)u.push(-1);te.globals.STRIDE_OBJ=0|Math.ceil(e.objectCount/32),te.globals.STRIDE_MOV=0|Math.ceil(c/5),e.STRIDE_OBJ=te.globals.STRIDE_OBJ,e.STRIDE_MOV=te.globals.STRIDE_MOV,Z=!1,ie.globals.verbose_logging=!1,ie.globals.throttle_movement=!1,ee=ae.colorPalettes.arnecolors;for(var h=0;h<e.metadata.length;h+=2){var f=e.metadata[h],g=e.metadata[h+1];"color_palette"===f?(g in ae.colorPalettesAliases&&(g=ae.colorPalettesAliases[g]),void 0===ae.colorPalettes[g]?logError('Palette "'+g+'" not found, defaulting to arnecolors.',0):ee=ae.colorPalettes[g]):"debug"===f?(Z=!0,ie.globals.cache_console_messages=!0):"GAME.verbose_logging"===f?(ie.globals.verbose_logging=!0,ie.globals.cache_console_messages=!0):"GAME.throttle_movement"===f&&(ie.globals.throttle_movement=!0)}for(var a in e.objects)if(e.objects.hasOwnProperty(a)){var s=e.objects[a];s.colors.length>10&&logError("a sprite cannot have more than 10 colors.  Why you would want more than 10 is beyond me.",s.lineNumber+1);for(var h=0;h<s.colors.length;h++){var d=s.colors[h];l(d)?(d=o(ee,d),s.colors[h]=d):(logError('Invalid color specified for object "'+a+'", namely "'+s.colors[h]+'".',s.lineNumber+1),s.colors[h]="#ff00ff")}}for(var a in e.objects)if(e.objects.hasOwnProperty(a)){var s=e.objects[a];0==s.colors.length&&(logError('color not specified for object "'+a+'".',s.lineNumber),s.colors=["#ff00ff"]),0===s.spritematrix.length?s.spritematrix=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]:s.spritematrix=i(s.spritematrix)}var p={};for(var a in e.objects)if(e.objects.hasOwnProperty(a)){var s=e.objects[a],v=u.concat([]);v[s.layer]=s.id,p[a]=v}for(var m=!0;m;){m=!1;for(var h=0;h<e.legend_synonyms.length;h++){var b=e.legend_synonyms[h],f=b[0],g=b[1];f in p&&void 0!==p[f]||void 0===p[g]||(m=!0,p[f]=p[g])}for(var h=0;h<e.legend_aggregates.length;h++){for(var b=e.legend_aggregates[h],f=b[0],y=b.slice(1),_=!0,n=0;n<y.length;n++){var w=y[n];if(void 0===p[w]){_=!1;break}}if((!(f in p)||void 0===p[f])&&_){for(var v=u.concat([]),n=1;n<b.length;n++){var a=b[n],s=e.objects[a];void 0==s&&logError("Object not found with name "+a,e.lineNumber),-1==v[s.layer]?v[s.layer]=s.id:void 0===s.layer?logError('Object "'+a.toUpperCase()+'" has been defined, but not assigned to a layer.',b.lineNumber):logError('Trying to create an aggregate object (defined in the legend) with both "'+a.toUpperCase()+'" and "'+e.idDict[v[s.layer]].toUpperCase()+"\", which are on the same layer and therefore can't coexist.",b.lineNumber)}m=!0,p[b[0]]=v}}}e.glyphDict=p;for(var x={},h=0;h<e.legend_aggregates.length;h++){var k=e.legend_aggregates[h];x[k[0]]=k.slice(1)}e.aggregatesDict=x;for(var C={},h=0;h<e.legend_properties.length;h++){var k=e.legend_properties[h];C[k[0]]=k.slice(1)}e.propertiesDict=C;for(var M={},h=0;h<e.legend_synonyms.length;h++){var k=e.legend_synonyms[h],f=k[0],S=k[1];S in x?x[f]=x[S]:S in C?C[f]=C[S]:f!==S&&(M[f]=S)}e.synonymsDict=M;for(var E=!0;E;){E=!1;for(var a in M)if(M.hasOwnProperty(a)){var S=M[a];S in C?(delete M[a],C[a]=C[S],E=!0):S in x?(delete x[a],x[a]=x[S],E=!0):S in M&&(M[a]=M[S])}for(var a in C)if(C.hasOwnProperty(a))for(var L=C[a],h=0;h<L.length;h++){var S=L[h];if(S in M)L[h]=M[S],E=!0;else if(S in C){L.splice(h,1);for(var T=C[S],n=0;n<T.length;n++){var I=T[n];-1===L.indexOf(I)&&L.push(I)}E=!0}S in x&&logError('Trying to define property "'+a.toUpperCase()+'" in terms of aggregate "'+S.toUpperCase()+'".')}for(var a in x)if(x.hasOwnProperty(a))for(var L=x[a],h=0;h<L.length;h++){var S=L[h];if(S in M)L[h]=M[S],E=!0;else if(S in x){L.splice(h,1);for(var T=x[S],n=0;n<T.length;n++){var I=T[n];-1===L.indexOf(I)&&L.push(I)}E=!0}S in C&&logError('Trying to define aggregate "'+a.toUpperCase()+'" in terms of property "'+S.toUpperCase()+'".')}}e.propertiesSingleLayer={};for(var f in C)if(C.hasOwnProperty(f)){for(var L=C[f],R=!0,h=1;h<L.length;h++)if(e.objects[L[h-1]].layer!==e.objects[L[h]].layer){R=!1;break}R&&(e.propertiesSingleLayer[f]=e.objects[L[0]].layer)}void 0===e.idDict[0]&&e.collisionLayers.length>0&&logError("You need to have some objects defined");var O,A;if(void 0===e.objects.background)if("background"in e.synonymsDict){var a=e.synonymsDict.background,s=e.objects[a];O=s.id,A=s.layer}else if("background"in e.propertiesDict){var a=e.propertiesDict.background[0],s=e.objects[a];O=s.id,A=s.layer}else if("background"in e.aggregatesDict){var s=e.idDict[0];O=s.id,A=s.layer,logError("background cannot be an aggregate (declared with 'and'), it has to be a simple type, or property (declared in terms of others using 'or').")}else{var s=e.idDict[0];O=s.id,A=s.layer,logError("you have to define something to be the background")}else O=e.objects.background.id,A=e.objects.background.layer;e.backgroundid=O,e.backgroundlayer=A}function s(e,t){var r=e.backgroundlayer,n=(e.backgroundid,e.layerMasks[r]),l=new re.Level(t[0],t[1].length,t.length-1,e.collisionLayers.length,null);l.objects=new Int32Array(l.width*l.height*te.globals.STRIDE_OBJ);for(var o=0;o<l.width;o++)for(var i=0;i<l.height;i++){var a=t[i+1].charAt(o);0==a.length&&(a=t[i+1].charAt(t[i+1].length-1));var s=e.glyphDict[a];void 0==s&&(void 0===e.propertiesDict[a]?logError('Error, symbol "'+a+'", used in map, not found.',t[0]+i):logError('Error, symbol "'+a+"\" is defined using 'or', and therefore ambiguous - it cannot be used in a map. Did you mean to define it in terms of 'and'?",ie.globals.level[0]+i));var c=new re.BitVec(te.globals.STRIDE_OBJ);s=s.concat([]);for(var u=0;u<l.layerCount;u++)s[u]>=0&&c.ibitset(s[u]);for(var h=0;h<te.globals.STRIDE_OBJ;++h)l.objects[te.globals.STRIDE_OBJ*(o*l.height+i)+h]=c.data[h]}for(var f=l.calcBackgroundMask(e),o=0;o<l.n_tiles;o++){var g=l.getCell(o);n.anyBitsInCommon(g)||g.ior(f),l.setCell(o,g)}return l}function c(e){for(var t=e.levels,r=[],n=0;n<t.length;n++){var l=t[n];if(0!=l.length)if("\n"==l[0]){var o={message:l[1]};r.push(o)}else{var o=s(e,l);r.push(o)}}e.levels=r}function u(e){for(var t=0;t<e.lhs.length;t++){var r=e.lhs[t];if(r.length>1)return!0;for(var n=0;n<r.length;n++)for(var l=r[n],o=0;o<l.length;o+=2)if(he.indexOf(l[o])>=0)return!0}for(var t=0;t<e.rhs.length;t++){var r=e.rhs[t];if(r.length>1)return!0;for(var n=0;n<r.length;n++)for(var l=r[n],o=0;o<l.length;o+=2)if(he.indexOf(l[o])>=0)return!0}return!1}function h(e,t,r){var n=e[0],l=e[1],o=e[2];n=n.replace(/\[/g," [ ").replace(/\]/g," ] ").replace(/\|/g," | ").replace(/\-\>/g," -> ");var i=n.split(/\s/).filter(function(e){return""!==e});0==i.length&&logError("Spooky error!  Empty line passed to rule function.",l);var a=0,s=[],c=null,h=[],f=!1,g=[],d=[],p=!1,v=!1,m=l,b=[],y=!1;if(1===i.length){if("startloop"===i[0])return k={bracket:1};if("endloop"===i[0])return k={bracket:-1}}-1==i.indexOf("->")&&logError("A rule has to have an arrow in it.  There's no arrow here! Consider reading up about rules - you're clearly doing something weird",l);for(var _=0;_<i.length;_++){var w=i[_];switch(a){case 0:"+"===w?m===l?(0==r.length&&logError('The "+" symbol, for joining a rule with the group of the previous rule, needs a previous rule to be applied to.'),0!==_&&logError('The "+" symbol, for joining a rule with the group of the previous rule, must be the first symbol on the line '),m=r[r.length-1].groupNumber):logError('Two "+"s ("append to previous rule group" symbol)applied to the same rule.',l):w in ue?s=s.concat(ue[w]):"late"===w?p=!0:"rigid"===w?v=!0:"random"===w?y=!0:fe.indexOf(w)>=0?s.push(w):ge.indexOf(w)>=0?logError('You cannot use relative directions ("^v<>") to indicate in which direction(s) a rule applies.  Use absolute directions indicators (Up, Down, Left, Right, Horizontal, or Vertical, for instance), or, if you want the rule to apply in all four directions, do not specify directions',l):"["==w?(0==s.length&&(s=s.concat(ue.orthogonal)),a=1,_--):logError("The start of a rule must consist of some number of directions (possibly 0), before the first bracket, specifying in what directions to look (with no direction specified, it applies in all four directions).  It seems you've just entered \""+w.toUpperCase()+'".',l);break;case 1:if("["==w)h.length>0&&logError('Error, malformed cell rule - encountered a "["" before previous bracket was closed',l),c=[];else if(de.exec(w))c.length%2==1?logError("Error, an item can't move in multiple directions.",l):c.push(w);else if("|"==w)c.length%2==1?logError("In a rule, if you specify a force, it has to act on an object.",l):(h.push(c),c=[]);else if("]"===w)c.length%2==1?"..."===c[0]?logError("Cannot end a rule with ellipses.",l):logError("In a rule, if you specify a force, it has to act on an object.",l):(h.push(c),c=[]),f?d.push(h):g.push(h),h=[];else if("->"===w)f&&logError('Error, you can only use "->" once in a rule; it\'s used to separate before and after states.',l),h.length>0?logError('Encountered an unexpected "->" inside square brackets.  It\'s used to separate states, it has no place inside them >:| .',l):f=!0;else if(t.names.indexOf(w)>=0)c.length%2==0?(c.push(""),c.push(w)):c.length%2==1&&c.push(w);else if("..."===w)c.push(w),c.push(w);else if(pe.indexOf(w)>=0)if(f===!1&&logError("Commands cannot appear on the left-hand side of the arrow.",l),"message"===w){var x=o.match(/message (.*)/i);null===x?logError("invalid message string",l):(b.push([w,x[1].trim()]),_=i.length)}else b.push([w]);else logError('Error, malformed cell rule - was looking for cell contents, but found "'+w+'".  What am I supposed to do with this, eh, please tell me that.',l)}}if(g.length!=d.length)b.length>0&&0==d.length||logError("Error, when specifying a rule, the number of matches (square bracketed bits) on the left hand side of the arrow must equal the number on the right",l);else for(var _=0;_<g.length;_++)g[_].length!=d[_].length&&logError("In a rule, each pattern to match on the left must have a corresponding pattern on the right of equal length (number of cells).",l),0==g[_].length&&logError("You have an totally empty pattern on the left-hand side.  This will match *everything*.  You certianly don't want this.");0==g.length&&logError("This rule refers to nothing.  What the heck? :O",l);var k={directions:s,lhs:g,rhs:d,lineNumber:l,late:p,rigid:v,groupNumber:m,commands:b,randomRule:y};u(k)===!1&&(k.directions=["up"]);for(var _=0;_<b.length;_++){var C=b[_][0];"restart"===C?(b.length>1||d.length>0)&&logError("The RESTART command can only appear by itself on the right hand side of the arrow.",l):"cancel"===C&&(b.length>1||d.length>0)&&logError("The CANCEL command can only appear by itself on the right hand side of the arrow.",l);
}return k}function f(e){var t=e.map(function(e){return e.map(function(e){return e.slice()})});return t}function g(e){var t={direction:e.direction,lhs:f(e.lhs),rhs:f(e.rhs),lineNumber:e.lineNumber,late:e.late,rigid:e.rigid,groupNumber:e.groupNumber,commands:e.commands,randomRule:e.randomRule};return t}function d(e){for(var t=e.rules,r=[],n=[],l=0;l<t.length;l++){var o=t[l][1],i=h(t[l],e,r);void 0===i.bracket?r.push(i):n.push([o,i.bracket])}e.loops=n;for(var a=[],l=0;l<r.length;l++)for(var s=r[l],c=s.directions,f=0;f<c.length;f++){var d=c[f];if(d in ue&&u(s))for(var p=ue[d],m=0;m<p.length;m++){var b=g(s);b.direction=p[m],a.push(b)}else{var b=g(s);b.direction=d,a.push(b)}}for(var l=0;l<a.length;l++){var s=a[l];L(s),v(s),S(e,s),M(e,s)}for(var y=[],l=0;l<a.length;l++){var s=a[l];y=y.concat(C(e,s,s.lineNumber))}for(var _=[],l=0;l<y.length;l++){var s=y[l];_=_.concat(k(e,s,s.lineNumber))}e.rules=_}function p(e){for(var t=0;t<e.lhs.length;t++)for(var r=0;r<e.lhs[t].length;r++)if("..."===e.lhs[t][r][1])return!0;return!1}function v(e){if(!p(e)){if("up"==e.direction)e.direction="down";else{if("left"!=e.direction)return;e.direction="right"}for(var t=0;t<e.lhs.length;t++)e.lhs[t].reverse(),e.rhs.length>0&&e.rhs[t].reverse()}}function m(e,t){for(var r=[],n=0;n<t.length;n+=2){var l=t[n],o=t[n+1];"random"!=l&&o in e.propertiesDict&&r.push(o)}return r}function b(e,t){for(var r=[],n=0;n<t.length;n+=2){var l=t[n],o=t[n+1];l in ue&&r.push([o,l])}return r}function y(e,t,r){for(var n=0;n<e.length;n+=2)e[n+1]===t&&"random"!==e[n]&&(e[n+1]=r)}function _(e,t,r,n){for(var l=0;l<e.length;l+=2)e[l]===t&&e[l+1]===r&&(e[l]=n)}function w(e,t,r){for(var n=0;n<e.length;n+=2)e[n]===t&&(e[n]=r)}function x(e,t){for(var r=[],n=0;n<t.length;n+=2){var l=t[n],o=t[n+1];if("no"===l&&o in e.propertiesDict)for(var i=e.propertiesDict[o],a=0;a<i.length;a++){var s=i[a];r.push(l),r.push(s)}else r.push(l),r.push(o)}return r}function k(e,t,r){for(var n=0;n<t.lhs.length;n++)for(var l=t.lhs[n],o=0;o<l.length;o++)l[o]=x(e,l[o]),t.rhs.length>0&&(t.rhs[n][o]=x(e,t.rhs[n][o]));for(var i={},o=0;o<t.rhs.length;o++)for(var a=t.lhs[o],s=t.rhs[o],c=0;c<s.length;c++)for(var u=m(e,a[c]),h=m(e,s[c]),f=0;f<h.length;f++){var d=h[f];-1==u.indexOf(d)&&(i[d]=!0)}for(var p,v=[t],b=!0;b;){b=!1;for(var n=0;n<v.length;n++){var _=v[n];p=!1;for(var o=0;o<_.lhs.length&&!p;o++)for(var w=_.lhs[o],c=0;c<w.length&&!p;c++)for(var k=w[c],C=m(e,k),f=0;f<C.length;++f){var d=C[f];if(!e.propertiesSingleLayer.hasOwnProperty(d)||i[d]===!0){var M=e.propertiesDict[d];p=!0,b=!0;for(var S=0;S<M.length;S++){var E=M[S],L=g(_);L.propertyReplacement={};for(var T in _.propertyReplacement)if(_.propertyReplacement.hasOwnProperty(T)){var I=_.propertyReplacement[T];L.propertyReplacement[T]=[I[0],I[1]]}y(L.lhs[o][c],d,E),L.rhs.length>0&&y(L.rhs[o][c],d,E),void 0===L.propertyReplacement[d]?L.propertyReplacement[d]=[E,1]:L.propertyReplacement[d][1]=L.propertyReplacement[d][1]+1,v.push(L)}break}}p&&(v.splice(n,1),n--)}}for(var n=0;n<v.length;n++){var _=v[n];if(void 0!==_.propertyReplacement)for(var d in _.propertyReplacement)if(_.propertyReplacement.hasOwnProperty(d)){var R=_.propertyReplacement[d],E=R[0],O=R[1];if(1===O)for(var o=0;o<_.rhs.length;o++)for(var A=_.rhs[o],c=0;c<A.length;c++){var D=A[c];y(D,d,E)}}}for(var N="",n=0;n<v.length;n++){var _=v[n];delete v.propertyReplacement;for(var o=0;o<_.rhs.length;o++)for(var w=_.rhs[o],c=0;c<w.length;c++)for(var k=w[c],C=m(e,k),f=0;f<C.length;f++)i.hasOwnProperty(C[f])&&(N=C[f])}return N.length>0&&logError('This rule has a property on the right-hand side, "'+N+"\", that can't be inferred from the left-hand side.  (either for every property on the right there has to be a corresponding one on the left in the same cell, OR, if there's a single occurrence of a particular property name on the left, all properties of the same name on the right are assumed to be the same).",r),v}function C(e,t,r){for(var n,l=[t],o=!0;o;){o=!1;for(var i=0;i<l.length;i++){var a=l[i];n=!1;for(var s=0;s<a.lhs.length;s++)for(var c=a.lhs[s],u=0;u<c.length;u++){var h=c[u],f=b(e,h);if(f.length>0){n=!0,o=!0;for(var d=f[0][0],p=f[0][1],v=ue[p],m=0;m<v.length;m++){var y=v[m],x=g(a);x.movingReplacement={};for(var k in a.movingReplacement)if(a.movingReplacement.hasOwnProperty(k)){var C=a.movingReplacement[k];x.movingReplacement[k]=[C[0],C[1],C[3]]}_(x.lhs[s][u],p,d,y),x.rhs.length>0&&_(x.rhs[s][u],p,d,y),void 0===x.movingReplacement[d]?x.movingReplacement[d]=[y,1,p]:x.movingReplacement[d][1]=x.movingReplacement[d][1]+1,l.push(x)}}}n&&(l.splice(i,1),i--)}}for(var i=0;i<l.length;i++){var a=l[i];if(void 0!==a.movingReplacement){var M={};for(var d in a.movingReplacement)if(a.movingReplacement.hasOwnProperty(d)){var S=a.movingReplacement[d],E=S[0],L=S[1],T=S[2];if(T in M||1!==L?M[T]="INVALID":M[T]=E,1===L)for(var s=0;s<a.rhs.length;s++)for(var I=a.rhs[s],u=0;u<I.length;u++){var R=I[u];_(R,T,d,E)}}for(var T in M)if(M.hasOwnProperty(T)&&"INVALID"!==T){E=M[T];for(var s=0;s<a.rhs.length;s++)for(var I=a.rhs[s],u=0;u<I.length;u++){var R=I[u];w(R,T,E)}}}}for(var O="",i=0;i<l.length;i++){var a=l[i];delete l.movingReplacement;for(var s=0;s<a.rhs.length;s++)for(var c=a.rhs[s],u=0;u<c.length;u++){var h=c[u],f=b(e,h);f.length>0&&(O=f[0][1])}}return O.length>0&&logError('This rule has an ambiguous movement on the right-hand side, "'+O+"\", that can't be inferred from the left-hand side.  (either for every ambiguous movement associated to an entity on the right there has to be a corresponding one on the left attached to the same entity, OR, if there's a single occurrence of a particular ambiguous movement on the left, all properties of the same movement attached to the same object on the right are assumed to be the same (or something like that)).",r),l}function M(e,t){for(var r=0;r<t.lhs.length;r++)for(var n=t.lhs[r],l=t.rhs[r],o=0;o<n.length;o++){for(var i=n[o],a=1;a<i.length;a+=2){var s=i[a];s in e.synonymsDict&&(i[a]=e.synonymsDict[i[a]])}if(t.rhs.length>0)for(var c=l[o],a=1;a<c.length;a+=2){var s=c[a];s in e.synonymsDict&&(c[a]=e.synonymsDict[c[a]])}}}function S(e,t){for(var r=0;r<t.lhs.length;r++)for(var n=t.lhs[r],l=0;l<n.length;l++){var o=n[l];E(e,o,t.lineNumber)}for(var r=0;r<t.rhs.length;r++)for(var n=t.rhs[r],l=0;l<n.length;l++){var o=n[l];E(e,o,t.lineNumber)}}function E(e,t,r){for(var n=0;n<t.length;n+=2){var l=t[n],o=t[n+1];if(o in e.aggregatesDict){"no"===l&&logError("You cannot use 'no' to exclude the aggregate object "+o.toUpperCase()+" (defined using 'AND'), only regular objects, or properties (objects defined using 'OR').  If you want to do this, you'll have to write it out yourself the long way.",r);var i=e.aggregatesDict[o];t[n+1]=i[0];for(var a=1;a<i.length;a++)t.push(t[n]),t.push(i[a])}}}function L(e){for(var t=e.direction,r=0;r<e.lhs.length;r++)for(var n=e.lhs[r],l=0;l<n.length;l++){var o=n[l];T(t,o)}for(var r=0;r<e.rhs.length;r++)for(var n=e.rhs[r],l=0;l<n.length;l++){var o=n[l];T(t,o)}}function T(e,t){for(var r=0;r<t.length;r+=2){var n=t[r],l=ve.indexOf(n);l>=0&&(t[r]=me[e][l])}}function I(e){for(var t=e.collisionLayers.length,r=[],n=0;t>n;n++)r.push(null);for(var n=0;n<e.rules.length;n++)for(var l=e.rules[n],o=0;o<l.lhs.length;o++)for(var i=l.lhs[o],a=l.rhs[o],s=0;s<i.length;s++){for(var c=i[s],u=r.concat([]),h=new re.BitVec(te.globals.STRIDE_OBJ),f=new re.BitVec(te.globals.STRIDE_OBJ),g=[],d=new re.BitVec(te.globals.STRIDE_MOV),p=new re.BitVec(te.globals.STRIDE_MOV),v=new re.BitVec(te.globals.STRIDE_MOV),m=0;m<c.length;m+=2){var b=c[m];if("..."===b){if(h=re.ellipsisPattern,2!==c.length)logError("You can't have anything in with an ellipsis. Sorry.",l.lineNumber);else if(0===s||s===i.length-1)logError("There's no point in putting an ellipsis at the very start or the end of a rule",l.lineNumber);else if(l.rhs.length>0){var y=a[s];(2!==y.length||"..."!==y[0])&&logError("An ellipsis on the left must be matched by one in the corresponding place on the right.",l.lineNumber)}break}if("random"!==b){var _=c[m+1],w=e.objects[_],x=e.objectMasks[_];if(w)var k=0|w.layer;else var k=e.propertiesSingleLayer[_];if("undefined"==typeof k&&logError("Oops!  "+_.toUpperCase()+" not assigned to a layer.",l.lineNumber),"no"===b)f.ior(x);else{var C=u[k];null!==C&&logError("Rule matches object types that can't overlap: \""+_.toUpperCase()+'" and "'+C.toUpperCase()+'".',l.lineNumber),u[k]=_,w?(h.ior(x),v.ishiftor(31,5*k)):g.push(x),"stationary"===b?p.ishiftor(31,5*k):d.ishiftor(be[b],5*k)}}else logError("'random' cannot be matched on the left-hand side, it can only appear on the right",l.lineNumber)}if(l.rhs.length>0){var y=a[s],M=i[s];"..."===y[0]&&"..."!==M[0]&&logError("An ellipsis on the right must be matched by one in the corresponding place on the left.",l.lineNumber);for(var m=0;m<y.length;m+=2){var S=y[m];"..."===S&&2!==y.length&&logError("You can't have anything in with an ellipsis. Sorry.",l.lineNumber)}}if(h!==re.ellipsisPattern){if(i[s]=new re.CellPattern([h,f,g,d,p,null]),0!==l.rhs.length){for(var E=a[s],L=r.concat([]),T=new re.BitVec(te.globals.STRIDE_OBJ),I=new re.BitVec(te.globals.STRIDE_OBJ),R=new re.BitVec(te.globals.STRIDE_MOV),O=new re.BitVec(te.globals.STRIDE_MOV),A=new re.BitVec(te.globals.STRIDE_MOV),D=new re.BitVec(te.globals.STRIDE_OBJ),N=new re.BitVec(te.globals.STRIDE_MOV),B=new re.BitVec(te.globals.STRIDE_MOV),m=0;m<E.length;m+=2){var b=E[m],_=E[m+1];if("..."===b){logError("spooky ellipsis found! (should never hit this)");break}if("random"!==b){var w=e.objects[_],x=e.objectMasks[_];if(w)var k=0|w.layer;else var k=e.propertiesSingleLayer[_];if("no"==b)T.ior(x);else{var C=L[k];null!==C&&logError("Rule matches object types that can't overlap: \""+_.toUpperCase()+'" and "'+C.toUpperCase()+'".',l.lineNumber),L[k]=_,b.length>0&&N.ishiftor(31,5*k);var P=e.layerMasks[k];w&&(I.ibitset(w.id),T.ior(P),A.ishiftor(31,5*k)),"stationary"===b&&R.ishiftor(31,5*k),"randomdir"===b?B.ishiftor(be[b],5*k):O.ishiftor(be[b],5*k)}}else if(_ in e.objectMasks){var F=e.objectMasks[_];D.ior(F)}else logError('You want to spawn a random "'+_.toUpperCase()+"\", but I don't know how to do that",l.lineNumber)}h.bitsSetInArray(I.data)||T.ior(h),d.bitsSetInArray(O.data)||R.ior(d);for(var m=0;t>m;m++)null!==u[m]&&null===L[m]&&(T.ior(e.layerMasks[m]),N.ishiftor(31,5*m));v.iclear(A),N.ior(v),(T||I||R||O||N)&&(i[s].replacement=new re.CellReplacement([T,I,R,O,N,D,B]))}}else i[s]=re.ellipsisPattern}}function R(e){for(var t=[],r=e[1],n=0;n<r.length;n++){for(var l=r[n],o=new re.BitVec(te.globals.STRIDE_OBJ),i=0;i<l.length;i++)l[i]!==re.ellipsisPattern&&o.ior(l[i].objectsPresent);t.push(o)}return t}function O(e){for(var t=0;t<e.length;t++)for(var r=e[t],n=0;n<r.length;n++){for(var l=r[n],o=[0,[],l.rhs.length>0,l.lineNumber],i=[],a=0;a<l.lhs.length;a++)i.push(!1);o[0]=be[l.direction];for(var a=0;a<l.lhs.length;a++){for(var s=l.lhs[a],c=0;c<s.length;c++)s[c]===re.ellipsisPattern&&(i[a]&&logError("You can't use two ellipses in a single cell match pattern.  If you really want to, please implement it yourself and send me a patch :) ",l.lineNumber),i[a]=!0);o[1][a]=s}o.push(i),o.push(l.groupNumber),o.push(l.rigid),o.push(l.commands),o.push(l.randomRule),o.push(R(o)),r[n]=new re.Rule(o)}te.globals.matchCache={}}function A(e){if(0!==e.length)for(var t=e[0].lineNumber,r=1;r<e.length;r++){var n=e[r];n.lineNumber!==t&&n.randomRule&&logError("A rule-group can only be marked random by the first rule",n.lineNumber)}}function D(e){for(var t={},r={},n=0;n<e.rules.length;n++){var l=e.rules[n],o=t;l.late&&(o=r),void 0==o[l.groupNumber]&&(o[l.groupNumber]=[]),o[l.groupNumber].push(l)}var i=[];for(var a in t)if(t.hasOwnProperty(a)){var s=t[a];A(s),i.push(s)}var c=[];for(var a in r)if(r.hasOwnProperty(a)){var s=r[a];A(s),c.push(s)}e.rules=i,e.lateRules=c}function N(e){for(var t=0;t<e.lateRules.length;t++)for(var r=e.lateRules[t],n=0;n<r.length;n++)for(var l=r[n],o=0;o<l.patterns.length;o++)for(var i=l.patterns[o],a=0;a<i.length;a++){var s=i[a];if(s!==re.ellipsisPattern){var c=s.movementsMissing,u=s.movementsPresent;if(!c.iszero()||!u.iszero())return void logError("Movements cannot appear in late rules.",l.lineNumber);if(null!=s.replacement){var h=s.replacement.movementsClear,f=s.replacement.movementsSet;if(!h.iszero()||!f.iszero())return void logError("Movements cannot appear in late rules.",l.lineNumber)}}}}function B(e){for(var t=[],r=[],n=[],l=[],o=[],i=0;i<e.rules.length;i++){for(var a=e.rules[i],s=!1,c=0;c<a.length;c++){var u=a[c];u.isRigid&&(s=!0)}if(o[i]=s,s){var h=a[0].groupNumber;n[h]=i;var f=t.length;r[i]=f,l[h]=f,t.push(i)}}t.length>30&&logError("There can't be more than 30 rigid groups (rule groups containing rigid members).",rules[0][0][3]),e.rigidGroups=o,e.rigidGroupIndex_to_GroupIndex=t,e.groupNumber_to_RigidGroupIndex=l,e.groupIndex_to_RigidGroupIndex=r}function P(e,t){var r=new re.BitVec(te.globals.STRIDE_OBJ);if(t in e.objects){var n=e.objects[t];r.ibitset(n.id)}if(t in e.aggregatesDict)for(var l=e.aggregatesDict[t],o=0;o<l.length;o++){var i=l[o],n=e.objects[i];r.ibitset(n.id)}if(t in e.propertiesDict)for(var l=e.propertiesDict[t],o=0;o<l.length;o++){var i=l[o],n=e.objects[i];r.ibitset(n.id)}if(t in e.synonymsDict){var i=e.synonymsDict[t],n=e.objects[i];r.ibitset(n.id)}return r.iszero()&&logErrorNoLine("error, didn't find any object called player, either in the objects section, or the legends section. there must be a player!"),r}function F(e){e.playerMask=P(e,"player");for(var t=[],r=e.collisionLayers.length,n=0;r>n;n++){for(var l=new re.BitVec(te.globals.STRIDE_OBJ),o=0;o<e.objectCount;o++){var i=e.idDict[o],a=e.objects[i];a.layer==n&&l.ibitset(a.id)}t.push(l)}e.layerMasks=t;var s={};for(var i in e.objects)if(e.objects.hasOwnProperty(i)){var a=e.objects[i];s[i]=new re.BitVec(te.globals.STRIDE_OBJ),s[i].ibitset(a.id)}var c=e.legend_synonyms.concat(e.legend_properties);c.sort(function(e,t){return e.lineNumber-t.lineNumber});for(var u=0;u<c.length;u++){var h=c[u];if(2==h.length)s[h[0]]=s[h[1]];else{for(var f=new re.BitVec(te.globals.STRIDE_OBJ),o=1;o<h.length;o++){var i=h[o];f.ior(s[i])}s[h[0]]=f}}e.objectMasks=s}function j(e){for(var t in e.objects)if(e.objects.hasOwnProperty(t)){for(var r=!1,n=0;n<e.collisionLayers.length;n++){for(var l=e.collisionLayers[n],o=0;o<l.length;o++)if(l[o]===t){r=!0;break}if(r)break}if(r===!1){var i=e.objects[t];logError('Object "'+t.toUpperCase()+'" has been defined, but not assigned to a layer.',i.lineNumber)}}}function H(e){for(var t={},r=0;r<e.metadata.length;r+=2){var n=e.metadata[r],l=e.metadata[r+1];t[n]=l}if(void 0!==t.flickscreen){var l=t.flickscreen,o=l.split("x"),i=[parseInt(o[0]),parseInt(o[1])];t.flickscreen=i}if(void 0!==t.zoomscreen){var l=t.zoomscreen,o=l.split("x"),i=[parseInt(o[0]),parseInt(o[1])];t.zoomscreen=i}e.metadata=t}function W(e){for(var t=[],r=0;r<e.winconditions.length;r++){var n=e.winconditions[r];if(0==n.length)return;var l=0;switch(n[0]){case"no":l=-1;break;case"all":l=1}var o,i=n[n.length-1],a=n[1];o=5==n.length?n[3]:"background";var s=0,c=0;a in e.objectMasks?s=e.objectMasks[a]:logError('unwelcome term "'+a+'" found in win condition. Win conditions objects have to be objects or properties (defined using "or", in terms of other properties)',i),o in e.objectMasks?c=e.objectMasks[o]:logError('unwelcome term "'+o+'" found in win condition. Win conditions objects have to be objects or properties (defined using "or", in terms of other properties)',i);var u=[l,s,c,i];t.push(u)}e.winconditions=t}function z(e){for(var t="[ ",r=0;r<e.length;r++){r>0&&(t+="| ");for(var n=e[r],l=0;l<n.length;l+=2){var o=n[l],i=n[l+1];t+="..."===o?o+" ":o+" "+i+" "}}return t+="] "}function q(e){var t="(<a onclick=\"jumpToLine('"+e.lineNumber.toString()+'\');"  href="javascript:void(0);">'+e.groupNumber+"</a>) "+e.direction.toString().toUpperCase()+" ";e.rigid&&(t="RIGID "+t+" "),e.randomRule&&(t="RANDOM "+t+" "),e.late&&(t="LATE "+t+" ");for(var r=0;r<e.lhs.length;r++){var n=e.lhs[r];t+=z(n)}t+="-> ";for(var r=0;r<e.rhs.length;r++){var n=e.rhs[r];t+=z(n)}for(var r=0;r<e.commands.length;r++){var l=e.commands[r];1===l.length?t+=l[0].toString():t=t+"("+l[0].toString()+", "+l[1].toString()+") "}return t}function G(e){for(var t="<br>Rule Assembly : ("+e.rules.length+" rules )<br>===========<br>",r=0,n=-1,l=0;l<e.rules.length;l++){var o=e.rules[l];r<e.loops.length&&e.loops[r][0]<o.lineNumber&&(t+="STARTLOOP<br>",r++,r<e.loops.length&&(n=e.loops[r][0],r++)),-1!==n&&n<o.lineNumber&&(t+="ENDLOOP<br>",n=-1),t+=q(o)+"<br>"}-1!==n&&(t+="ENDLOOP<br>"),t+="===========<br>",(0,ne.consolePrint)(t)}function V(e){console.log("rule count before = "+e.rules.length);for(var t={},r=-1,n=e.rules.length-1;n>=0;n--){var l=e.rules[n],o=l.groupNumber;o!==r&&(t={});var i=q(l);t.hasOwnProperty(i)?e.rules.splice(n,1):t[i]=!0,r=o}console.log("rule count after = "+e.rules.length)}function U(e){var t={},r=!0,n=0,l=0;e.loops.length%2===1&&logErrorNoLine("have to have matching number of  'startLoop' and 'endLoop' loop points.");for(var o=0;o<e.loops.length;o++)for(var i=e.loops[o],a=0;a<e.rules.length;a++){var s=e.rules[a],c=s[0],u=s[s.length-1],h=c.lineNumber;u.lineNumber;if(r){if(h>=i[0]){l=a,r=!1,-1===i[1]&&logErrorNoLine("Need have to have matching number of  'startLoop' and 'endLoop' loop points.");break}}else if(h>=i[0]){n=a-1,t[n]=l,r=!0,1===i[1]&&logErrorNoLine("Need have to have matching number of  'startLoop' and 'endLoop' loop points.");break}}if(r===!1){var n=e.rules.length;t[n]=l}e.loopPoint=t,t={},r=!0;for(var o=0;o<e.loops.length;o++)for(var i=e.loops[o],a=0;a<e.lateRules.length;a++){var s=e.lateRules[a],c=s[0],u=s[s.length-1],h=c.lineNumber;u.lineNumber;if(r){if(h>=i[0]){l=a,r=!1,-1===i[1]&&logErrorNoLine("Need have to have matching number of  'startLoop' and 'endLoop' loop points.");break}}else if(h>=i[0]){n=a-1,t[n]=l,r=!0,1===i[1]&&logErrorNoLine("Need have to have matching number of  'startLoop' and 'endLoop' loop points.");break}}if(r===!1){var n=e.lateRules.length;t[n]=l}e.lateLoopPoint=t}function J(e){return null!==/^\s*\d+\s*$/.exec(e)}function Y(e){for(var t={},r=[],n=[],l=[],o=[],i=0;i<e.sounds.length;i++){var a=e.sounds[i];if(!(a.length<=1)){var s=a[a.length-1];if(2!==a.length)if(ye.indexOf(a[0])>=0){a.length>4&&logError("too much stuff to define a sound event",s);var c=a[1];J(c)?(void 0!==t[a[0]]&&logError(a[0].toUpperCase()+" already declared.",s),t[a[0]]=a[1]):logError('Expecting sfx data, instead found "'+a[1]+'".',s)}else{var u=a[0].trim(),h=a[1].trim(),f=a.slice(2,a.length-2);f.length>0&&"move"!==h&&"cantmove"!==h&&logError("incorrect sound declaration.",s),"action"===h&&(h="move",f=["___action____"]),0==f.length&&(f=["orthogonal"]);var c=a[a.length-2];u in e.aggregatesDict?logError('cannot assign sound fevents to aggregate objects (declared with "and"), only to regular objects, or properties, things defined in terms of "or" ("'+u+'").',s):u in e.objectMasks||logError('Object "'+u+'" not found.',s);for(var g=e.objectMasks[u],d=0,p=0;p<f.length;p++){f[p]=f[p].trim();var v=f[p];if(-1===xe.indexOf(v))logError('Was expecting a direction, instead found "'+v+'".',s);else{var m=we[v];d|=m}}for(var b=[u],y=!0;y;){y=!1;for(var _=0;_<b.length;_++){var w=b[_];if(w in e.synonymsDict)b[_]=e.synonymsDict[w],y=!0;else if(w in e.propertiesDict){y=!0;var x=e.propertiesDict[w];b.splice(_,1),_--;for(var k=0;k<x.length;k++)b.push(x[k])}}}if("move"===h||"cantmove"===h)for(var p=0;p<b.length;p++){var C=b[p],M=e.objects[C],S=M.layer,E=new re.BitVec(te.globals.STRIDE_MOV);E.ishiftor(d,5*S);var L={objectMask:g,directionMask:E,seed:c};"move"===h?l.push(L):o.push(L)}J(c)||logError('Expecting sfx data, instead found "'+c+'".',s);switch(h){case"create":var L={objectMask:g,seed:c};r.push(L);break;case"destroy":var L={objectMask:g,seed:c};n.push(L)}}else logError("incorrect sound declaration.",s)}}e.sfx_Events=t,e.sfx_CreationMasks=r,e.sfx_DestructionMasks=n,e.sfx_MovementMasks=l,e.sfx_MovementFailureMasks=o}function K(e){if("background_color"in e.metadata?e.bgcolor=o(ee,e.metadata.background_color):e.bgcolor="#000000","text_color"in e.metadata?e.fgcolor=o(ee,e.metadata.text_color):e.fgcolor="#FFFFFF",l(e.fgcolor)===!1&&logError("text_color in incorrect format - found "+e.fgcolor+", but I expect a color name (like 'pink') or hex-formatted color (like '#1412FA')."),l(e.bgcolor)===!1&&logError("background_color in incorrect format - found "+e.bgcolor+", but I expect a color name (like 'pink') or hex-formatted color (like '#1412FA')."),ne.globals.canSetHTMLColors&&("background_color"in e.metadata&&(document.body.style.backgroundColor=e.bgcolor),"text_color"in e.metadata)){var t=document.getElementById("separator");null!=t&&(t.style.color=e.fgcolor);for(var r=document.getElementsByTagName("a"),n=0;n<r.length;n++)r[n].style.color=e.fgcolor;for(var r=document.getElementsByTagName("h1"),n=0;n<r.length;n++)r[n].style.color=e.fgcolor}if("homepage"in e.metadata){var i=e.metadata.homepage;i=i.replace("http://",""),i=i.replace("https://",""),e.metadata.homepage=i}}function X(e){for(var t=new le.codeMirrorFn,r=t.startState(),n=e.split("\n"),l=0;l<n.length;l++){var o=n[l];r.lineNumber=l+1;var i=new ce["default"].StringStream(o,4);do if(t.token(i,r),le.errorCount[0]>ke)return void(0,ne.consolePrint)("too many errors, aborting compilation");while(i.eol()===!1)}return delete r.lineNumber,a(r),F(r),c(r),d(r),V(r),I(r),D(r),O(r.rules),O(r.lateRules),N(r),B(r),W(r),j(r),H(r),U(r),Y(r),K(r),delete r.commentLevel,delete r.names,delete r.abbrevNames,delete r.objects_candname,delete r.objects_section,delete r.objects_spritematrix,delete r.section,delete r.subsection,delete r.tokenIndex,delete r.visitedSections,delete r.loops,r}function Q(e,t,r){te.globals.matchCache={},oe.globals.forceRegenImages=!0,void 0===e&&(e=["restart"]),void 0===r&&(r=null),oe.globals.lastDownTarget=oe.globals.canvas,ne.globals.canDump===!0&&(compiledText=t),le.errorCount[0]=0,le.compiling[0]=!0,le.errorStrings.splice(0,le.errorStrings.length),(0,ne.consolePrint)("=================================");try{var n=X(t)}finally{le.compiling[0]=!1}if(!(le.errorCount[0]>ke)){if(le.errorCount[0]>0){(0,ne.consoleError)('<span class="systemMessage">Errors detected during compilation, the game may not work correctly.</span>');for(var l in le.errorStrings)(0,ne.consoleError)(le.errorStrings[l])}else{for(var o=0,i=0;i<n.rules.length;i++)o+=n.rules[i].length;for(var i=0;i<n.lateRules.length;i++)o+=n.lateRules[i].length;"restart"==e[0]?(0,ne.consolePrint)('<span class="systemMessage">Successful Compilation, generated '+o+" instructions.</span>"):(0,ne.consolePrint)('<span class="systemMessage">Successful live recompilation, generated '+o+" instructions.</span>")}(0,re.setGameState)(n,e,r),(0,ne.clearInputHistory)(),(0,ne.consoleCacheDump)()}}function $(e){var t=document.createElement("a");return t.href=e,t.href}Object.defineProperty(t,"__esModule",{value:!0}),t.isColor=l,t.colorToHex=o,t.generateSpriteMatrix=i,t.generateExtraMembers=a,t.levelFromString=s,t.levelsToArray=c,t.directionalRule=u,t.processRuleString=h,t.deepCloneHS=f,t.deepCloneRule=g,t.rulesToArray=d,t.containsEllipsis=p,t.rewriteUpLeftRules=v,t.getPropertiesFromCell=m,t.getMovings=b,t.concretizePropertyInCell=y,t.concretizeMovingInCell=_,t.concretizeMovingInCellByAmbiguousMovementName=w,t.expandNoPrefixedProperties=x,t.concretizePropertyRule=k,t.concretizeMovingRule=C,t.rephraseSynonyms=M,t.atomizeAggregates=S,t.atomizeCellAggregates=E,t.convertRelativeDirsToAbsolute=L,t.absolutifyRuleCell=T,t.rulesToMask=I,t.cellRowMasks=R,t.collapseRules=O,t.ruleGroupRandomnessTest=A,t.arrangeRulesByGroupNumber=D,t.checkNoLateRulesHaveMoves=N,t.generateRigidGroupList=B,t.getMaskFromName=P,t.generateMasks=F,t.checkObjectsAreLayered=j,t.twiddleMetaData=H,t.processWinConditions=W,t.printCellRow=z,t.printRule=q,t.printRules=G,t.removeDuplicateRules=V,t.generateLoopPoints=U,t.validSeed=J,t.generateSoundData=Y,t.formatHomePage=K,t.loadFile=X,t.compile=Q,t.qualifyURL=$;var Z,ee,te=r(5),re=r(6),ne=r(3),le=r(10),oe=r(2),ie=r(4),ae=r(12),se=r(11),ce=n(se);re.Level.prototype.calcBackgroundMask=function(e){void 0===e.backgroundlayer&&logError("you have to have a background layer");for(var t=e.layerMasks[e.backgroundlayer],r=0;r<this.n_tiles;r++){var n=this.getCell(r);if(n.iand(t),!n.iszero())return n}return n=new re.BitVec(te.globals.STRIDE_OBJ),n.ibitset(e.backgroundid),n};var ue={horizontal:["left","right"],vertical:["up","down"],moving:["up","down","left","right","action"],orthogonal:["up","down","left","right"],perpendicular:["^","v"],parallel:["<",">"]},he=["^","v","<",">","horizontal","vertical"],fe=["up","down","left","right"],ge=["^","v","<",">"],de=/^(\>|\<|\^|v|up|down|left|right|moving|stationary|no|randomdir|random|horizontal|vertical|orthogonal|perpendicular|parallel|action)$/,pe=["sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10","cancel","checkpoint","restart","win","message","again"],ve=["^","v","<",">","parallel","perpendicular"],me={right:["up","down","left","right","horizontal","vertical"],up:["left","right","down","up","vertical","horizontal"],down:["right","left","up","down","vertical","horizontal"],left:["down","up","right","left","horizontal","vertical"]},be={up:parseInt("00001",2),down:parseInt("00010",2),left:parseInt("00100",2),right:parseInt("01000",2),moving:parseInt("01111",2),no:parseInt("00011",2),randomdir:parseInt("00101",2),random:parseInt("10010",2),action:parseInt("10000",2),"":parseInt("00000",2)},ye=["titlescreen","startgame","endgame","startlevel","undo","restart","endlevel","showmessage","closemessage","sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10"],_e=["create","destroy","move","cantmove","action"],we=(ye.concat(_e),{up:parseInt("00001",2),down:parseInt("00010",2),left:parseInt("00100",2),right:parseInt("01000",2),horizontal:parseInt("01100",2),vertical:parseInt("00011",2),orthogonal:parseInt("01111",2),___action____:parseInt("10000",2)}),xe=["up","down","left","right","horizontal","vertical","orthogonal","___action____"],ke=5},function(e,t){function r(e,t,r){function n(){var e;return i+=t,i>=1&&(e=!0,i=1),r(i),e}function o(){var e;return i-=t,0>=i&&(e=!0,i=0),r(i),e}var i,a;return a={animateUp:function(){l.getInstance().animate(e,n)},animateDown:function(){l.getInstance().animate(e,o)}},i=0,a}Object.defineProperty(t,"__esModule",{value:!0});var n={};n.hasTouch=function(){var e;return("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&(e=!0),e},n.enable=function(e){return(e||n.hasTouch()&&!n._instance)&&(n._instance=new n.GestureHandler,n._instance.bindEvents(),n._instance.bootstrap()),n._instance},n.GestureHandler=function(){this.initialize.apply(this,arguments)},n.log=function(e){var t;t=document.getElementsByTagName("h1")[0],t.innerHTML=""+Math.random().toString().substring(4,1)+"-"+e},n.debugDot=function(e){var t,r,n;n="border-radius: 50px;width: 5px;height: 5px;background: red;position: absolute;left: "+e.touches[0].clientX+"px;top: "+e.touches[0].clientY+"px;",t=document.createElement("div"),t.setAttribute("style",n),r=document.getElementsByTagName("body")[0],r.appendChild(t)},function(e){"use strict";var t=10,n=50,l=1e3,o=150,i={action:88,left:37,right:39,up:38,down:40,undo:85,restart:82,quit:27},a=['<div class="tab">','  <div class="tab-affordance"></div>','  <div class="tab-icon">','    <div class="slice"></div>','    <div class="slice"></div>',"  </div>","</div>"].join("\n");e.initialize=function(){this.firstPos={x:0,y:0},this.setTabAnimationRatio=this.setTabAnimationRatio.bind(this),this.setMenuAnimationRatio=this.setMenuAnimationRatio.bind(this),this.repeatTick=this.repeatTick.bind(this),this.isFocused=!0},e.setFocusElement=function(e){this.focusElement=e,this.isFocused=!1,this.buildFocusIndicator()},e.bindEvents=function(){window.addEventListener("touchstart",this.onTouchStart.bind(this)),window.addEventListener("touchend",this.onTouchEnd.bind(this)),window.addEventListener("touchmove",this.onTouchMove.bind(this))},e.bootstrap=function(){this.showTab(),this.isAudioSupported()||this.disableAudio(),this.disableSelection()},e.onTouchStart=function(e){this.isTouching||(this.handleFocusChange(e),this.isFocused&&"A"!==e.target.tagName.toUpperCase()&&(this.isTouching=!0,this.mayBeSwiping=!0,this.gestured=!1,this.swipeDirection=void 0,this.swipeDistance=0,this.startTime=(new Date).getTime(),this.firstPos.x=e.touches[0].clientX,this.firstPos.y=e.touches[0].clientY))},e.onTouchEnd=function(e){this.isFocused&&this.isTouching&&(this.gestured||0===e.touches.length&&this.handleTap(),0===e.touches.length&&(this.isTouching=!1,this.endRepeatWatcher()))},e.onTouchMove=function(e){return this.isFocused?(this.isSuccessfulSwipe()?(this.handleSwipe(this.swipeDirection,this.touchCount),this.gestured=!0,this.mayBeSwiping=!1,this.beginRepeatWatcher(e)):this.mayBeSwiping?this.swipeStep(e):this.isRepeating&&this.repeatStep(e),prevent(e),!1):void 0},e.handleFocusChange=function(e){this.focusElement&&(this.isFocused=this.isTouchInsideFocusElement(e),this.setFocusIndicatorVisibility(this.isFocused))},e.isTouchInsideFocusElement=function(e){var t;return e.touches&&e.touches[0]?(t=this.absoluteElementPosition(this.focusElement),e.touches[0].clientX<t.left||e.touches[0].clientY<t.top?!1:e.touches[0].clientX>t.left+this.focusElement.clientWidth||e.touches[0].clientY>t.top+this.focusElement.clientHeight?!1:!0):!1},e.setFocusIndicatorVisibility=function(e){var t;t="visible",e||(t="hidden"),this.focusIndicator.setAttribute("style","visibility: "+t+";")},e.absoluteElementPosition=function(e){var t,r;for(t={top:e.offsetTop||0,left:e.offsetLeft||0},r=document.getElementsByTagName("body")[0],t.top-=r.scrollTop||0;;){if(e=e.offsetParent,!e)break;t.top+=e.offsetTop||0,t.left+=e.offsetLeft||0}return t},e.beginRepeatWatcher=function(e){var t;this.repeatInterval||(this.isRepeating=!0,t=1e3*state.metadata.key_repeat_interval,(isNaN(t)||!t)&&(t=o),this.repeatInterval=setInterval(this.repeatTick,t),this.recenter(e))},e.endRepeatWatcher=function(){this.repeatInterval&&(clearInterval(this.repeatInterval),delete this.repeatInterval,this.isRepeating=!1)},e.repeatTick=function(){this.isTouching&&this.handleSwipe(this.direction,this.touchCount)},e.recenter=function(e){this.firstPos.x=e.touches[0].clientX,this.firstPos.y=e.touches[0].clientY},e.isSuccessfulSwipe=function(){var e;return this.mayBeSwiping&&void 0!==this.swipeDirection&&this.swipeDistance>=n&&(e=!0),e},e.swipeStep=function(e){var r,o,i,a;this.mayBeSwiping&&(r={x:e.touches[0].clientX,y:e.touches[0].clientY},i=(new Date).getTime(),a=e.touches.length,this.swipeDistance=this.cardinalDistance(this.firstPos,r),this.swipeDirection?n>o?(direction=this.dominantDirection(this.firstPos,r),direction!==this.swipeDirection&&(this.mayBeSwiping=!1),a<this.touchCount&&(this.mayBeSwiping=!1)):i-this.startTime>l&&(this.mayBeSwiping=!1):this.swipeDistance>t&&(this.swipeDirection=this.dominantDirection(this.firstPos,r),this.touchCount=a))},e.repeatStep=function(e){var t,r;t={x:e.touches[0].clientX,y:e.touches[0].clientY},r=this.cardinalDistance(this.firstPos,t),r>=n&&(this.swipeDirection=this.dominantDirection(this.firstPos,t),this.recenter(e))},e.cardinalDistance=function(e,t){var r,n;return r=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y),Math.max(r,n)},e.dominantDirection=function(e,t){var r,n,l,o;return r=t.x-e.x,n=t.y-e.y,l="x",Math.abs(n)>Math.abs(r)&&(l="y"),o="x"===l?r>0?"right":"left":n>0?"down":"up"},e.handleSwipe=function(e,t){1===t?this.emitKeydown(this.swipeDirection):t>1&&this.toggleMenu()},e.handleTap=function(){this.emitKeydown("action")},e.emitKeydown=function(e){var t;t={keyCode:i[e]},this.fakeCanvasFocus(),onKeyDown(t),onKeyUp(t)},e.fakeCanvasFocus=function(){var e;e=document.getElementById("gameCanvas"),onMouseDown({button:0,target:e})},e.toggleMenu=function(){this.isMenuVisible?this.hideMenu():this.showMenu()},e.showMenu=function(){this.menuElem||this.buildMenu(),this.getAnimatables().menu.animateUp(),this.isMenuVisible=!0,this.hideTab()},e.hideMenu=function(){this.menuElem&&this.getAnimatables().menu.animateDown(),
this.isMenuVisible=!1,this.showTab()},e.getAnimatables=function(){var e=this;return this._animatables||(this._animatables={tab:r("tab",.1,e.setTabAnimationRatio),menu:r("menu",.1,e.setMenuAnimationRatio)}),this._animatables},e.showTab=function(){this.tabElem||this.buildTab(),this.getAnimatables().tab.animateDown()},e.hideTab=function(){this.tabElem&&this.tabElem.setAttribute("style","display: none;"),this.getAnimatables().tab.animateUp()},e.buildTab=function(){var e,t,r,n,l=this;e=document.createElement("div"),e.innerHTML=a,n=e.children[0],r=function(e){e.stopPropagation(),l.showMenu()},this.tabAffordance=n.getElementsByClassName("tab-affordance")[0],this.tabElem=n.getElementsByClassName("tab-icon")[0],this.tabAffordance.addEventListener("touchstart",r),this.tabElem.addEventListener("touchstart",r),t=document.getElementsByTagName("body")[0],t.appendChild(n)},e.buildMenu=function(){var e,t,r,n,l,o,i,a=this;e=document.createElement("div"),e.innerHTML=this.buildMenuString(state),this.menuElem=e.children[0],this.closeElem=this.menuElem.getElementsByClassName("close")[0],i=function(e){e.stopPropagation(),a.hideMenu()},this.closeAffordance=this.menuElem.getElementsByClassName("close-affordance")[0],o=this.menuElem.getElementsByClassName("close")[0],this.closeAffordance.addEventListener("touchstart",i),o.addEventListener("touchstart",i),r=this.menuElem.getElementsByClassName("undo")[0],r&&r.addEventListener("touchstart",function(e){e.stopPropagation(),a.emitKeydown("undo")}),n=this.menuElem.getElementsByClassName("restart")[0],n&&n.addEventListener("touchstart",function(e){e.stopPropagation(),a.emitKeydown("restart")}),l=this.menuElem.getElementsByClassName("quit")[0],l.addEventListener("touchstart",function(e){e.stopPropagation(),a.emitKeydown("quit")}),t=document.getElementsByTagName("body")[0],t.appendChild(this.menuElem)},e.buildMenuString=function(e){var t,r,n,l;return n=e.metadata.noundo,l=e.metadata.norestart,t=3,n&&(t-=1),l&&(t-=1),r=['<div class="mobile-menu item-count-'+t+'">','  <div class="close-affordance"></div>','  <div class="close">','    <div class="slice"></div>','    <div class="slice"></div>',"  </div>"],n||r.push('  <div class="undo button">Undo</div>'),l||r.push('  <div class="restart button">Restart</div>'),r=r.concat(['  <div class="quit button">Quit to Menu</div>','  <div class="clear"></div>',"</div>"]),r.join("\n")},e.buildFocusIndicator=function(){var e;this.focusIndicator=document.createElement("DIV"),this.focusIndicator.setAttribute("class","tapFocusIndicator"),this.focusIndicator.setAttribute("style","visibility: hidden;"),e=this.focusElement.parentNode,e.appendChild(this.focusIndicator)},e.setTabAnimationRatio=function(e){var t,r,n,l=18,o=66;e=Math.round(1e3*e)/1e3,e>=.999?this.tabAffordance.setAttribute("style","display: none;"):this.tabAffordance.setAttribute("style","display: block;"),t=o*e+l*(1-e),r="opacity: "+(1-e)+";",n=r+" width: "+t+"px;",this.tabElem.setAttribute("style",n)},e.setMenuAnimationRatio=function(e){var t,r,n,l=-66,o=-18;e=Math.round(1e3*e)/1e3,.001>=e?this.closeAffordance.setAttribute("style","display: none;"):this.closeAffordance.setAttribute("style","display: block;"),t=o*e+l*(1-e),r="opacity: "+e+";",n="left: "+(t-4)+"px; "+r+" width: "+-t+"px;",this.closeElem.setAttribute("style",n),this.menuElem.setAttribute("style",r)},e.disableAudio=function(){window.playSeed=function(){}},e.isAudioSupported=function(){var e=!0;return webkitAudioContext&&(e=!1),e},e.disableSelection=function(){var e;e=document.getElementsByTagName("body")[0],e.setAttribute("class",e.getAttribute("class")+" disable-select")}}(n.GestureHandler.prototype);var l=function(){this.initialize.apply(this,arguments)};!function(e){e.initialize=function(){this._animations={},this.tick=this.tick.bind(this)},e.animate=function(e,t){this._animations[e]=t,this.wakeup()},e.wakeup=function(){this._isAnimating||(this._isAnimating=!0,this.tick())},e.tick=function(){var e,t,r,n,l;n=[],r=!0;for(e in this._animations){if(!this._animations.hasOwnProperty(e))return;t=this._animations[e](),t?n.push(e):r=!1}if(r){for(l=0;l<n.length;n++)delete this._isAnimating[n[l]];this._isAnimating=!1}else requestAnimationFrame(this.tick)}}(l.prototype),l.getInstance=function(){return l._instance||(window.Animator._instance=new window.Animator),window.Animator._instance},function(){"use strict";var e,t,r=["ms","moz","webkit","o"];for(e=0;e<r.length&&!window.requestAnimationFrame;e++)window.requestAnimationFrame=window[r[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r[e]+"CancelAnimationFrame"],window.cancelAnimationFrame||(window.cancelAnimationFrame=window[r[e]+"CancelRequestAnimationFrame"]);window.requestAnimationFrame||(t=0,window.requestAnimationFrame=function(e,r){var n,l,o;return n=(new Date).getTime(),l=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+l)},l),t=n+l,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),t["default"]=n,e.exports=t["default"]},function(e,t,r){function n(e,t,r){backups.push(backupLevel());var n=e.clone();e.width+=t,e.height+=r,e.n_tiles=e.width*e.height,e.objects=new Int32Array(e.n_tiles*N.globals.STRIDE_OBJ);var l=new BitVec(N.globals.STRIDE_OBJ);l.ibitset(N.globals.state.backgroundid);for(var o=0;o<e.n_tiles;++o)e.setCell(o,l);return e.movements=new Int32Array(e.objects.length),q=!0,RebuildLevelArrays(),n}function l(){for(var e=n(B.globals.level,1,0),t=1;t<B.globals.level.width;++t)for(var r=0;r<B.globals.level.height;++r){var l=t*B.globals.level.height+r;B.globals.level.setCell(l,e.getCell(l-B.globals.level.height))}}function o(){for(var e=n(B.globals.level,1,0),t=0;t<B.globals.level.width-1;++t)for(var r=0;r<B.globals.level.height;++r){var l=t*B.globals.level.height+r;B.globals.level.setCell(l,e.getCell(l))}}function i(){for(var e=n(B.globals.level,0,1),t=0;t<B.globals.level.width;++t)for(var r=1;r<B.globals.level.height;++r){var l=t*B.globals.level.height+r;B.globals.level.setCell(l,e.getCell(l-t-1))}}function a(){for(var e=n(B.globals.level,0,1),t=0;t<B.globals.level.width;++t)for(var r=0;r<B.globals.level.height-1;++r){var l=t*B.globals.level.height+r;B.globals.level.setCell(l,e.getCell(l-t))}}function s(){if(!(B.globals.level.width<=1))for(var e=n(B.globals.level,-1,0),t=0;t<B.globals.level.width;++t)for(var r=0;r<B.globals.level.height;++r){var l=t*B.globals.level.height+r;B.globals.level.setCell(l,e.getCell(l+B.globals.level.height))}}function c(){if(!(B.globals.level.width<=1))for(var e=n(B.globals.level,-1,0),t=0;t<B.globals.level.width;++t)for(var r=0;r<B.globals.level.height;++r){var l=t*B.globals.level.height+r;B.globals.level.setCell(l,e.getCell(l))}}function u(){if(!(B.globals.level.height<=1))for(var e=n(B.globals.level,0,-1),t=0;t<B.globals.level.width;++t)for(var r=0;r<B.globals.level.height;++r){var l=t*B.globals.level.height+r;B.globals.level.setCell(l,e.getCell(l+t+1))}}function h(){if(!(B.globals.level.height<=1))for(var e=n(B.globals.level,0,-1),t=0;t<B.globals.level.width;++t)for(var r=0;r<B.globals.level.height;++r){var l=t*B.globals.level.height+r;B.globals.level.setCell(l,e.getCell(l+t))}}function f(e,t){for(var r,n=-1,l=0;l<t.length;++l){var o=t[l][0],i=t[l][1];if(i.bitsSetInArray(e.data)){for(var a=0,s=0;s<32*N.globals.STRIDE_OBJ;++s)i.get(s)&&e.get(s)&&a++;a>n&&(n=a,r=o)}}return n>0?r:(logErrorNoLine("Wasn't able to approximate a glyph value for some tiles, using '.' as a placeholder.",!0),".")}function g(){var e=[];for(var t in N.globals.state.glyphDict)if(N.globals.state.glyphDict.hasOwnProperty(t)&&1===t.length){for(var r=N.globals.state.glyphDict[t],n=new BitVec(N.globals.STRIDE_OBJ),l=0;l<r.length;l++){var o=r[l];o>=0&&n.ibitset(o)}e.push([t,n.clone()]);var i=N.globals.state.layerMasks[N.globals.state.backgroundlayer];n.iclear(i),e.push([t,n.clone()]);for(var l=0;32>l;l++){i.get(l)&&(n.ibitset(l),e.push([t,n.clone()]),n.ibitclear(l))}}V++;var a="selectable"+V,s='Printing GAME.level contents:<br><br><span id="'+a+'" onclick="selectText(\''+a+"',event)\">";B.globals.cache_console_messages=!1;for(var c=0;c<B.globals.level.height;c++){for(var l=0;l<B.globals.level.width;l++){var u=c+l*B.globals.level.height,h=B.globals.level.getCell(u),r=f(h,e);r in G&&(r=G[r]),s+=r}c<B.globals.level.height-1&&(s+="<br>")}s+="</span><br>",consolePrint(s,!0)}function d(e,t){if(-2>=Y){var r=editorRowCount-(-Y-2)-1,n=J+(N.globals.screenwidth-1)*r;-1===J?g():J>=0&&n<glyphImages.length&&(glyphSelectedIndex=n,(0,O.redraw)())}else if(J>-1&&Y>-1&&J<N.globals.screenwidth-2&&Y<N.globals.screenheight-2-editorRowCount){for(var s=glyphImagesCorrespondance[glyphSelectedIndex],c=N.globals.state.glyphDict[s],u=new BitVec(N.globals.STRIDE_OBJ),h=0;h<c.length;h++){var f=c[h];f>=0&&u.ibitset(f)}var d=N.globals.state.layerMasks[N.globals.state.backgroundlayer];u.bitsClearInArray(d)&&u.ibitset(state.backgroundid);var p=Y+J*B.globals.level.height,v=B.globals.level.getCell(p);if(v.equals(u))return;U===!1&&(U=!0,backups.push(backupLevel())),B.globals.level.setCell(p,u),(0,O.redraw)()}else t&&(-1===J?(l(),(0,O.canvasResize)()):J===N.globals.screenwidth-2&&(o(),(0,O.canvasResize)()),-1===Y?(i(),(0,O.canvasResize)()):Y===N.globals.screenheight-2-editorRowCount&&(a(),(0,O.canvasResize)()))}function p(e,t){if(-2===Y)J<=glyphImages.length&&(glyphSelectedIndex=J,(0,O.redraw)());else if(J>-1&&Y>-1&&J<N.globals.screenwidth-2&&Y<N.globals.screenheight-2-editorRowCount){var r=Y+J*B.globals.level.height,n=new BitVec(N.globals.STRIDE_OBJ);n.ibitset(state.backgroundid),B.globals.level.setCell(r,n),(0,O.redraw)()}else t&&(-1===J?(s(),(0,O.canvasResize)()):J===N.globals.screenwidth-2&&(c(),(0,O.canvasResize)()),-1===Y?(u(),(0,O.canvasResize)()):Y===N.globals.screenheight-2-editorRowCount&&(h(),(0,O.canvasResize)()))}function v(e){if(0!==e.button||e.ctrlKey||e.metaKey){if((2===e.button||0===e.button&&(e.ctrlKey||e.metaKey))&&"gameCanvas"===e.target.id&&(W=!1,z=!0,B.globals.levelEditorOpened))return p(e,!0)}else{if(D.globals.lastDownTarget=e.target,B.globals.keybuffer=[],e.target===D.globals.canvas&&(k(e),W=!0,z=!1,B.globals.levelEditorOpened))return U=!1,d(e,!0);W=!1,z=!1}}function m(e){W=!1,z=!1}function b(e){e=e||window.event,!A.globals.IDE&&[32,37,38,39,40].indexOf(e.keyCode)>-1&&C(e),B.globals.keybuffer.indexOf(e.keyCode)>=0||(D.globals.lastDownTarget===D.globals.canvas&&-1===B.globals.keybuffer.indexOf(e.keyCode)&&(B.globals.keybuffer.splice(F,0,e.keyCode),P=0,M(e,!0)),A.globals.canDump===!0&&(74===e.keyCode&&(e.ctrlKey||e.metaKey)?(dumpTestCase(),C(e)):75===e.keyCode&&(e.ctrlKey||e.metaKey)&&(makeGIF(),C(e))))}function y(e){var t=0,r=0,n=0,l=0,o=this;do t+=o.offsetLeft-o.scrollLeft,r+=o.offsetTop-o.scrollTop;while(o=o.offsetParent);return n=e.pageX-t,l=e.pageY-r,{x:n,y:l}}function _(e){e=e||window.event;var t=B.globals.keybuffer.indexOf(e.keyCode);t>=0&&(B.globals.keybuffer.splice(t,1),F>=t&&F--)}function w(e){B.globals.keybuffer=[],F=0,P=0}function x(e){B.globals.keybuffer=[],F=0,P=0}function k(e){var t=D.globals.canvas.relMouseCoords(e);J=t.x-N.globals.xoffset,Y=t.y-N.globals.yoffset,J=Math.floor(J/N.globals.cellwidth),Y=Math.floor(Y/N.globals.cellheight)}function C(e){return e.preventDefault&&e.preventDefault(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.stopPropagation&&e.stopPropagation(),e.returnValue=!1,!1}function M(e,t){if(!B.globals.winning){var r=-1;switch(e.keyCode){case 65:case 37:r=1;break;case 38:case 87:r=0;break;case 68:case 39:r=3;break;case 83:case 40:r=2;break;case 13:case 32:case 67:case 88:if(B.globals.norepeat_action!==!1&&!t)return;r=4;break;case 85:case 90:if(N.globals.textMode===!1)return(0,A.pushInput)("undo"),(0,R.DoUndo)(),(0,O.canvasResize)(),C(e);break;case 82:if(N.globals.textMode===!1&&t)return(0,A.pushInput)("restart"),(0,R.DoRestart)(),(0,O.canvasResize)(),C(e);break;case 27:if(N.globals.titleScreen===!1)return N.globals.goToTitleScreen(),tryPlayTitleSound(),(0,O.canvasResize)(),C(e);break;case 69:if(canOpenEditor)return t&&(B.globals.levelEditorOpened=!B.globals.levelEditorOpened,restartTarget=backupLevel(),(0,O.canvasResize)()),C(e);break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:if(B.globals.levelEditorOpened&&t){var n=9;return e.keyCode>=49&&(n=e.keyCode-49),n<glyphImages.length?glyphSelectedIndex=n:consolePrint("Trying to select tile outside of range in GAME.level editor.",!0),(0,O.canvasResize)(),C(e)}}if(B.globals.throttle_movement&&r>=0&&3>=r){if(H==r&&j<B.globals.repeatinterval)return;H=r,j=0}if(N.globals.textMode){if(0===N.globals.state.levels.length);else if(N.globals.titleScreen)0===N.globals.titleMode?4===r&&t&&N.globals.titleSelected===!1&&((0,R.tryPlayStartGameSound)(),N.globals.titleSelected=!0,B.globals.messageselected=!1,B.globals.timer=0,B.globals.quittingTitleScreen=!0,(0,R.generateTitleScreen)(),(0,O.canvasResize)()):4==r&&t?N.globals.titleSelected===!1&&((0,R.tryPlayStartGameSound)(),N.globals.titleSelected=!0,B.globals.messageselected=!1,B.globals.timer=0,B.globals.quittingTitleScreen=!0,(0,R.generateTitleScreen)(),(0,O.redraw)()):(0===r||2===r)&&(N.globals.titleSelection=1-N.globals.titleSelection,(0,R.generateTitleScreen)(),(0,O.redraw)());else if(4==r&&t){if(B.globals.unitTesting)return void(0,R.nextLevel)();B.globals.messageselected===!1&&(B.globals.messageselected=!0,B.globals.timer=0,B.globals.quittingMessageScreen=!0,(0,R.tryPlayCloseMessageSound)(),N.globals.titleScreen=!1,(0,R.drawMessageScreen)())}}else if(!B.globals.againing&&r>=0)return 4===r&&"noaction"in N.globals.state.metadata||((0,A.pushInput)(r),(0,R.processInput)(r)&&(0,O.redraw)()),C(e)}}function S(){if(B.globals.timer+=B.globals.deltatime,j+=B.globals.deltatime,B.globals.quittingTitleScreen&&B.globals.timer/1e3>.3&&(B.globals.quittingTitleScreen=!1,(0,R.nextLevel)()),B.globals.againing&&B.globals.timer>B.globals.againinterval&&0==N.globals.messagetext.length&&(0,R.processInput)(-1)&&((0,O.redraw)(),P=0,B.globals.autotick=0),B.globals.quittingMessageScreen&&B.globals.timer/1e3>.15&&(B.globals.quittingMessageScreen=!1,""===N.globals.messagetext?(0,R.nextLevel)():(N.globals.messagetext="",N.globals.textMode=!1,N.globals.titleScreen=!1,N.globals.titleMode=B.globals.curlevel>0||null!==B.globals.curlevelTarget?1:0,N.globals.titleSelected=!1,N.globals.titleSelection=0,(0,O.canvasResize)(),(0,R.checkWin)())),B.globals.winning&&B.globals.timer/1e3>.5&&(B.globals.winning=!1,(0,R.nextLevel)()),B.globals.keybuffer.length>0){P+=B.globals.deltatime;var e=B.globals.throttle_movement?B.globals.repeatinterval:B.globals.repeatinterval/Math.sqrt(B.globals.keybuffer.length);if(P>e){P=0,F=(F+1)%B.globals.keybuffer.length;var t=B.globals.keybuffer[F];M({keyCode:t},!1)}}!(B.globals.autotickinterval>0)||N.globals.textMode||B.globals.levelEditorOpened||B.globals.againing||B.globals.winning||(B.globals.autotick+=B.globals.deltatime,B.globals.autotick>B.globals.autotickinterval&&(B.globals.autotick=0,(0,A.pushInput)("tick"),(0,R.processInput)(-1)&&(0,O.redraw)()))}function E(){K=setInterval(function(){S()},B.globals.deltatime)}function L(){clearInterval(K)}function T(e){document.addEventListener("mousedown",v,!1),document.addEventListener("mouseup",m,!1),document.addEventListener("keydown",b,!1),document.addEventListener("keyup",_,!1),e.addEventListener("focus",w,!1),e.addEventListener("blur",x,!1)}function I(e){document.removeEventListener("mousedown",v),document.removeEventListener("mouseup",m),document.removeEventListener("keydown",b),document.removeEventListener("keyup",_),e.removeEventListener("focus",w),e.removeEventListener("blur",x)}Object.defineProperty(t,"__esModule",{value:!0}),t.relMouseCoords=y,t.startGameLoop=E,t.stopGameLoop=L,t.addListeners=T,t.removeListeners=I;var R=r(6),O=r(8),A=r(3),D=r(2),N=r(5),B=r(4),P=0,F=0,j=0,H=-100,W=!1,z=!1,q=!1,G={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},V=0,U=!1;HTMLCanvasElement.prototype.relMouseCoords=y;var J=0,Y=0,K=null}])})}});